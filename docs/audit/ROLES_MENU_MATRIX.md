# –ú–∞—Ç—Ä–∏—Ü–∞ "–†–æ–ª–∏ √ó –ö–Ω–æ–ø–∫–∏ √ó –°—Ü–µ–Ω–∞—Ä–∏–∏"

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ –∫–Ω–æ–ø–∫–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é –¥–æ—Å—Ç—É–ø–Ω—ã –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏/—Å—Ç–∞—Ç—É—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–æ—Ç–µ.

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-16  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-16  
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç—É–∞–ª—å–Ω–æ

---

## –†–æ–ª–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã

### –ë–∞–∑–æ–≤—ã–µ —Ä–æ–ª–∏:
- **Guest** - –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (`user=None`)
- **User Unverified** - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –Ω–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (`user.is_verified=False`)
- **User Verified** - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (`user.is_verified=True`)

### –°—Ç–∞—Ç—É—Å—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫:
- **User BLOCKED** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (`blacklist.action_type=BLOCKED`, `is_active=True`)
- **User TERMINATED** - –∞–∫–∫–∞—É–Ω—Ç —Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω (`blacklist.action_type=TERMINATED`, `is_active=True`)

### –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ä–æ–ª–∏:
- **Admin** - –æ–±—ã—á–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (`is_admin=True`, `role=admin`)
- **Extended Admin** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (`is_admin=True`, `role=extended_admin`)
- **Super Admin** - —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (`is_admin=True`, `role=super_admin`)

---

## –ú–∞—Ç—Ä–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–Ω–æ–ø–æ–∫

| –†–æ–ª—å/–°—Ç–∞—Ç—É—Å | üí∞ –î–µ–ø–æ–∑–∏—Ç | üí∏ –í—ã–≤–æ–¥ | üì¶ –ú–æ–∏ –¥–µ–ø–æ–∑–∏—Ç—ã | üë• –†–µ—Ñ–µ—Ä–∞–ª—ã | üìä –ë–∞–ª–∞–Ω—Å | üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ | ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ | üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ | üìú –ò—Å—Ç–æ—Ä–∏—è | ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è | üîë –§–∏–Ω–ø–∞—Ä–æ–ª—å | üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | üìù –ê–ø–µ–ª–ª—è—Ü–∏—è | üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å |
|-------------|:----------:|:--------:|:---------------:|:-----------:|:---------:|:------------:|:-----------:|:-------------:|:---------:|:-------------:|:------------:|:--------------:|:------------:|:---------------:|
| **Guest** | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | ‚ùå | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | ‚ùå | ‚ùå |
| **User Unverified** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| **User Verified** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| **User BLOCKED** | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | ‚ùå |
| **User TERMINATED** | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| **Admin** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ/‚ùå* | ‚úÖ | ‚ùå | ‚ùå | ‚úÖ |
| **Extended Admin** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ/‚ùå* | ‚úÖ | ‚ùå | ‚ùå | ‚úÖ |
| **Super Admin** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ/‚ùå* | ‚úÖ | ‚ùå | ‚ùå | ‚úÖ |

\* –ö–Ω–æ–ø–∫–∞ "‚úÖ –ü—Ä–æ–π—Ç–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `user.is_verified=False`

---

## –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ —Ä–æ–ª—è–º

### Guest (user=None)

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- ‚úÖ **üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
- ‚úÖ **üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ **üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ

**–ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- ‚ùå –í—Å–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–¥–µ–ø–æ–∑–∏—Ç—ã, –≤—ã–≤–æ–¥—ã, –±–∞–ª–∞–Ω—Å)
- ‚ùå –†–µ—Ñ–µ—Ä–∞–ª—ã (–Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞)
- ‚ùå –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞)
- ‚ùå –ò—Å—Ç–æ—Ä–∏—è (–Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞)
- ‚ùå –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (–Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞)
- ‚ùå –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–Ω–µ—Ç –ø—Ä–∞–≤)

**–õ–æ–≥–∏–∫–∞:** `main_menu_reply_keyboard(user=None)` ‚Üí reduced menu

---

### User Unverified (user, is_verified=False)

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- ‚úÖ **üí∞ –î–µ–ø–æ–∑–∏—Ç** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ **üí∏ –í—ã–≤–æ–¥** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ **üì¶ –ú–æ–∏ –¥–µ–ø–æ–∑–∏—Ç—ã** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ **üë• –†–µ—Ñ–µ—Ä–∞–ª—ã** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ **üìä –ë–∞–ª–∞–Ω—Å** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ **üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ **‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ **üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ **üìú –ò—Å—Ç–æ—Ä–∏—è** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ **‚úÖ –ü—Ä–æ–π—Ç–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é** - –¥–æ—Å—Ç—É–ø–Ω–æ, —Ç.–∫. `is_verified=False`
- ‚úÖ **üîë –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∏–Ω–ø–∞—Ä–æ–ª—å** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

**–ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- ‚ùå **üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** - —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
- ‚ùå **üìù –ü–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é** - –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- ‚ùå **üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** - –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞

**–õ–æ–≥–∏–∫–∞:** `main_menu_reply_keyboard(user=user, blacklist_entry=None, is_admin=False)` ‚Üí standard menu

---

### User Verified (user, is_verified=True)

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- ‚úÖ –í—Å–µ –∫–Ω–æ–ø–∫–∏ –∏–∑ **User Unverified**, –∫—Ä–æ–º–µ:
- ‚ùå **‚úÖ –ü—Ä–æ–π—Ç–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é** - —É–∂–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω (`is_verified=True`)

**–õ–æ–≥–∏–∫–∞:** `main_menu_reply_keyboard(user=user, blacklist_entry=None, is_admin=False)` ‚Üí standard menu –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

### User BLOCKED (blacklist.action_type=BLOCKED, is_active=True)

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- ‚úÖ **üìù –ü–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é** - –¢–û–õ–¨–ö–û —ç—Ç–∞ –∫–Ω–æ–ø–∫–∞

**–ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- ‚ùå –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

**–õ–æ–≥–∏–∫–∞:** 
```python
if (user and blacklist_entry and blacklist_entry.is_active 
    and blacklist_entry.action_type == BlacklistActionType.BLOCKED):
    # –¢–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∞ –∞–ø–µ–ª–ª—è—Ü–∏–∏
```

**–í–∞–∂–Ω–æ:** 
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –∏ –Ω–∞–∂–∞—Ç—å "üìù –ü–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é"
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è `BanMiddleware` –Ω–∞ —É—Ä–æ–≤–Ω–µ middleware
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é

---

### User TERMINATED (blacklist.action_type=TERMINATED, is_active=True)

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- ‚ùå **–ù–ï–¢ –î–û–°–¢–£–ü–ê –ö –ú–ï–ù–Æ** - `BanMiddleware` –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ –∞–ø–¥–µ–π—Ç—ã –î–û —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤

**–õ–æ–≥–∏–∫–∞:**
- `BanMiddleware` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `TERMINATED` —Å—Ç–∞—Ç—É—Å
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω –∞–∫—Ç–∏–≤–Ω—ã–π `TERMINATED` ‚Üí –∞–ø–¥–µ–π—Ç –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, —Ö—ç–Ω–¥–ª–µ—Ä—ã –ù–ï –≤—ã–∑—ã–≤–∞—é—Ç—Å—è
- –ú–µ–Ω—é –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ–æ–±—â–µ
- –í –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è: `[SECURITY] Terminated user attempted to use bot`

**–í–∞–∂–Ω–æ:** –≠—Ç–æ —Å–∞–º–∞—è –∂—ë—Å—Ç–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Ä–µ–∑–∞–Ω –æ—Ç –±–æ—Ç–∞.

---

### Admin (is_admin=True, role=admin)

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- ‚úÖ –í—Å–µ –∫–Ω–æ–ø–∫–∏ –∏–∑ **User Verified**
- ‚úÖ **üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** - –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É

**–£—Å–ª–æ–≤–∏—è:**
- `is_admin=True` (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `AdminAuthMiddleware` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `admins`)
- –ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `admins` —Å `role=admin`

**–õ–æ–≥–∏–∫–∞:**
```python
if is_admin:
    builder.row(KeyboardButton(text="üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"))
```

**–í–∞–∂–Ω–æ:** 
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ `is_admin=True`
- –≠—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –±–µ—Ä—ë—Ç—Å—è –∏–∑ `data["is_admin"]`, –∫–æ—Ç–æ—Ä—ã–π —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `AdminAuthMiddleware`
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `user.is_admin` (—ç—Ç–æ –ø–æ–ª–µ deprecated)

---

### Extended Admin (is_admin=True, role=extended_admin)

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- ‚úÖ –í—Å–µ –∫–Ω–æ–ø–∫–∏ –∏–∑ **Admin**
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤ `admin_keyboard()`)

**–£—Å–ª–æ–≤–∏—è:**
- `is_admin=True`
- –ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `admins` —Å `role=extended_admin`

---

### Super Admin (is_admin=True, role=super_admin)

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- ‚úÖ –í—Å–µ –∫–Ω–æ–ø–∫–∏ –∏–∑ **Admin**
- ‚úÖ –ü–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏, –≤–∫–ª—é—á–∞—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏

**–£—Å–ª–æ–≤–∏—è:**
- `is_admin=True`
- –ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `admins` —Å `role=super_admin`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –¢–æ–ª—å–∫–æ `super_admin` –º–æ–∂–µ—Ç:
- –î–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–æ–≤
- –í—ã–ø–æ–ª–Ω—è—Ç—å —ç–∫—Å—Ç—Ä–µ–Ω–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∞–¥–º–∏–Ω–æ–≤
- –í–∏–¥–µ—Ç—å –∫–Ω–æ–ø–∫—É "üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏" –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

---

## –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. Guest (user=None)
- **–ü—Ä–∞–≤–∏–ª–æ:** –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ (–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –ü–æ–¥–¥–µ—Ä–∂–∫–∞, –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
- **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞, –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ–ø–µ—Ä–∞—Ü–∏—è–º

### 2. BLOCKED (action_type=BLOCKED)
- **–ü—Ä–∞–≤–∏–ª–æ:** –¢–û–õ–¨–ö–û –∫–Ω–æ–ø–∫–∞ "üìù –ü–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é"
- **–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –Ω–æ –º–æ–∂–µ—Ç –ø–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ `main_menu_reply_keyboard()` –Ω–∞ `blacklist_entry.action_type == BLOCKED`

### 3. TERMINATED (action_type=TERMINATED)
- **–ü—Ä–∞–≤–∏–ª–æ:** –ù–ï–¢ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–Ω—é –≤–æ–æ–±—â–µ
- **–ü—Ä–∏—á–∏–Ω–∞:** –°–∞–º–∞—è –∂—ë—Å—Ç–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ - –ø–æ–ª–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `BanMiddleware` –±–ª–æ–∫–∏—Ä—É–µ—Ç –∞–ø–¥–µ–π—Ç—ã –î–û –≤—ã–∑–æ–≤–∞ —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤

### 4. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
- **–ü—Ä–∞–≤–∏–ª–æ:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ `is_admin=True` –ò –Ω–∞–ª–∏—á–∏–∏ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `admins`
- **–ü—Ä–∏—á–∏–Ω–∞:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞ –±–µ—Ä—É—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `admins`, –Ω–µ –∏–∑ `user.is_admin`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `AdminAuthMiddleware` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `data["is_admin"]` –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ `AdminRepository`

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏

### Unit-—Ç–µ—Å—Ç—ã
–§–∞–π–ª: `tests/unit/test_main_menu_keyboard.py`

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
- ‚úÖ Guest –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ 3 –∫–Ω–æ–ø–∫–∏
- ‚úÖ Verified user –≤–∏–¥–∏—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏, –Ω–æ –ù–ï–¢ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- ‚úÖ BLOCKED user –≤–∏–¥–∏—Ç –¢–û–õ–¨–ö–û –∞–ø–µ–ª–ª—è—Ü–∏—é
- ‚úÖ Admin –≤–∏–¥–∏—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø—Ä–∏ `is_admin=True`
- ‚úÖ –û–±—ã—á–Ω—ã–π user –ù–ï –≤–∏–¥–∏—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø—Ä–∏ `is_admin=False`

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- ‚úÖ `BanMiddleware` –±–ª–æ–∫–∏—Ä—É–µ—Ç TERMINATED –¥–æ —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤
- ‚úÖ `BanMiddleware` –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç BLOCKED —Ç–æ–ª—å–∫–æ –¥–ª—è `/start` –∏ –∞–ø–µ–ª–ª—è—Ü–∏–∏
- ‚úÖ `AdminAuthMiddleware` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `is_admin` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `admins`

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `bot/keyboards/reply.py` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `main_menu_reply_keyboard()`
- `bot/middlewares/auth.py` - `AdminAuthMiddleware` –∏ `AuthMiddleware`
- `bot/middlewares/ban.py` - `BanMiddleware`
- `tests/unit/test_main_menu_keyboard.py` - unit-—Ç–µ—Å—Ç—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- `tests/security/test_ban_middleware.py` - —Ç–µ—Å—Ç—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- `docs/audit/SECURITY_SCENARIOS.md` - —Å—Ü–µ–Ω–∞—Ä–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

**–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** 2025-01-16  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–¥—É –≤ `bot/keyboards/reply.py`


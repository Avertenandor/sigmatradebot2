# –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º–∏

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º–∏ —Å —Ä–æ–ª–µ–≤—ã–º –¥–æ—Å—Ç—É–ø–æ–º, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–µ–π—Å—Ç–≤–∏–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–ª–æ–≥–∏–Ω–æ–º –ø—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á

- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –í—Å–µ –∞–¥–º–∏–Ω—ã –¥–æ–ª–∂–Ω—ã –≤–≤–µ—Å—Ç–∏ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–ª–æ–≥–∏–Ω**: –°–µ—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏ –±–æ–ª–µ–µ 15 –º–∏–Ω—É—Ç
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏**: –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∞–¥–º–∏–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏

### 2. –†–æ–ª–∏ –∞–¥–º–∏–Ω–æ–≤

- **admin**: –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- **extended_admin**: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- **super_admin**: –ü–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞, –≤–∫–ª—é—á–∞—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏–º–∏ –∞–¥–º–∏–Ω–∞–º–∏

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è super_admin)

- **–°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∞**: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞ —Å –≤—ã–±–æ—Ä–æ–º —Ä–æ–ª–∏
- **–°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤**: –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤ —Å –∏—Ö —Ä–æ–ª—è–º–∏
- **–£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞**: –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ super_admin)

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–æ–≤ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `admin_actions`:
- –°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û–¥–æ–±—Ä–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤—ã–≤–æ–¥–æ–≤
- –†–∞—Å—Å—ã–ª–∫–∏

### 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π

- –ó–∞–¥–∞—á–∞ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–µ–∫—à–∏—Ö —Å–µ—Å—Å–∏–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∏—Å—Ç–µ–∫—à–∏–µ –∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

1. –ê–¥–º–∏–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É `/admin`
2. –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á
3. –ê–¥–º–∏–Ω –≤–≤–æ–¥–∏—Ç –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á
4. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞ (super_admin)

1. –í–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∫–∞–∫ super_admin
2. –ù–∞–∂–∞—Ç—å "üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏"
3. –ù–∞–∂–∞—Ç—å "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∞"
4. –í–≤–µ—Å—Ç–∏ Telegram ID –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞
5. –í—ã–±—Ä–∞—Ç—å —Ä–æ–ª—å (1, 2 –∏–ª–∏ 3)
6. –ú–∞—Å—Ç–µ—Ä-–∫–ª—é—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–æ–º—É –∞–¥–º–∏–Ω—É –≤ Telegram

### –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ (super_admin)

1. –í–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∫–∞–∫ super_admin
2. –ù–∞–∂–∞—Ç—å "üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏"
3. –ù–∞–∂–∞—Ç—å "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∞"
4. –í–≤–µ—Å—Ç–∏ Telegram ID –∞–¥–º–∏–Ω–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ

**–ó–∞—â–∏—Ç–∞:**
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ super_admin

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

- **Admin**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–¥–º–∏–Ω–µ (telegram_id, username, role, master_key)
- **AdminSession**: –°–µ—Å—Å–∏–∏ –∞–¥–º–∏–Ω–æ–≤ (session_token, is_active, last_activity, expires_at)
- **AdminAction**: –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–æ–≤ (admin_id, action_type, target_user_id, details, ip_address, created_at)

### Middleware

- **AdminAuthMiddleware**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Å—Å–∏—é –∞–¥–º–∏–Ω–∞ –∏ —Ç—Ä–µ–±—É–µ—Ç –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏

### –°–µ—Ä–≤–∏—Å—ã

- **AdminService**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏ –∏ —Å–µ—Å—Å–∏—è–º–∏
- **AdminLogService**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–æ–≤

### –ó–∞–¥–∞—á–∏

- **cleanup_expired_admin_sessions**: –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ú–∞—Å—Ç–µ—Ä-–∫–ª—é—á**: –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (bcrypt)
2. **–°–µ—Å—Å–∏–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞ –∏–ª–∏ –ø—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏ > 15 –º–∏–Ω—É—Ç
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–æ–≤ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞
4. **–†–æ–ª–∏**: –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º

## –ú–∏–≥—Ä–∞—Ü–∏—è

–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
alembic upgrade head
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—É `admin_actions` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–æ–≤ –º–æ–∂–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ `admin_actions`:

```sql
SELECT * FROM admin_actions 
ORDER BY created_at DESC 
LIMIT 100;
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è**: –í—Å–µ –∞–¥–º–∏–Ω—ã –¥–æ–ª–∂–Ω—ã –±—É–¥—É—Ç –≤–≤–µ—Å—Ç–∏ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ
2. **–ú–∞—Å—Ç–µ—Ä-–∫–ª—é—á**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–æ–º—É –∞–¥–º–∏–Ω—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
3. **–ë–µ–∑–¥–µ–π—Å—Ç–≤–∏–µ**: –°–µ—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏ > 15 –º–∏–Ω—É—Ç
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–æ–≤ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞


# SigmaTradeBot ‚Äî –ü–æ–ª–Ω—ã–π –∫–∞—Ä–∫–∞—Å —Ä–æ–ª–µ–π –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**–¶–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–∞**: –°–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –±–∏–∑–Ω–µ—Å-—Ä–æ–ª–µ–π –∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö/–∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞, —Ç–µ—Å—Ç–æ–≤ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–µ–ª–æ–≤ –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

---

## 0. –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (R1‚ÄìR6)

–ß—Ç–æ–±—ã –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ –±—ã–ª–æ —Å–≤–µ—Å—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü—É:

### R1 ‚Äî –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–≥–æ—Å—Ç—å / —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—â–∏–π—Å—è)
–ù–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ `users` –∏–ª–∏ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è, –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –µ—â—ë –Ω–µ—Ç.

### R2 ‚Äî –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º (–±–µ–∑ –∏–ª–∏ —Å –¥–µ–ø–æ–∑–∏—Ç–∞–º–∏)
–ó–∞–ø–∏—Å—å –≤ `users` –µ—Å—Ç—å, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –≤–∏–¥–∏—Ç –ø–æ–ª–Ω–æ–µ –º–µ–Ω—é:
`üí∞ –î–µ–ø–æ–∑–∏—Ç`, `üí∏ –í—ã–≤–æ–¥`, `üì¶ –ú–æ–∏ –¥–µ–ø–æ–∑–∏—Ç—ã`, `üë• –†–µ—Ñ–µ—Ä–∞–ª—ã`, `üìä –ë–∞–ª–∞–Ω—Å`,
`üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞`, `‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏`, `üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏`, `üìú –ò—Å—Ç–æ—Ä–∏—è`,
`‚úÖ –ü—Ä–æ–π—Ç–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é`, `üîë –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∏–Ω–ø–∞—Ä–æ–ª—å`.

### R3 ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-–∏–Ω–≤–µ—Å—Ç–æ—Ä (–µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–µ–ø–æ–∑–∏—Ç)
–¢–æ –∂–µ, —á—Ç–æ R2, –Ω–æ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –¥–µ–ø–æ–∑–∏—Ç–∞–º–∏ –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è–º–∏.

### R4 ‚Äî –ü–∞—Ä—Ç–Ω—ë—Ä (–µ—Å—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—ã/—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è. –õ–æ–≥–∏–∫–∞ –≤ `ReferralService`.

### R5 ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ / —Å–∞–Ω–∫—Ü–∏—è–º–∏

* pre-registration blacklist –ø–æ —Ç–µ–ª–µ–≥—Ä–∞–º—É –∏–ª–∏ –∫–æ—à–µ–ª—å–∫—É
* `BlacklistActionType.BLOCKED` + –∞–ø–µ–ª–ª—è—Ü–∏–∏
* `BlacklistActionType.TERMINATED` (–∂—ë—Å—Ç–∫–∏–π –±–∞–Ω)
* `earnings_blocked`, –∞–∫—Ç–∏–≤–Ω—ã–π `finpass_recovery` –∏ —Ç.–ø.

### R6 ‚Äî –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

* –±–∞–∑–æ–≤—ã–π `admin`
* —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π `extended_admin`
* `super_admin` c —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∞–º–∏

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –†–æ–ª–∏ R2‚ÄìR5 –º–æ–≥—É—Ç –Ω–∞–∫–ª–∞–¥—ã–≤–∞—Ç—å—Å—è (–∏–Ω–≤–µ—Å—Ç–æ—Ä+–ø–∞—Ä—Ç–Ω—ë—Ä+–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ç.–¥.), –Ω–æ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–∑–±–∏–≤–∞–µ–º –ø–æ –¥–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π —Ä–æ–ª–∏.

---

## 1. R1 ‚Äî –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–≥–æ—Å—Ç—å / —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)

### 1.1. –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –≤ –±–æ—Ç–∞

#### R1-1: /start –±–µ–∑ —Ä–µ—Ñ–µ—Ä–∞–ª–∞, –Ω–µ –≤ blacklist

* Telegram –¥–∞—ë—Ç –∞–ø–¥–µ–π—Ç `/start`
* –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Å–∞–π—Ç `sigmatrade.org`
* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ `waiting_for_wallet`
* –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–¥–ª—è –≥–æ—Å—Ç—è ‚Äî —É—Ä–µ–∑–∞–Ω–Ω–æ–µ: `üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏`, `üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞`, `üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è`)

#### R1-2: /start —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º —Ä–µ—Ñ–µ—Ä–∞–ª–∞

* –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ R1-1, –Ω–æ –≤ `FSM state` –∫–ª–∞–¥—ë—Ç—Å—è `referrer_telegram_id`, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –ø—Ä–∏–≤—è–∑–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Ü–µ–ø–æ—á–∫—É

#### R1-3: /start, –Ω–æ telegram_id —É–∂–µ –≤ blacklist (registration_denied)

* `BlacklistService.is_blacklisted()` –ø–æ telegram_id ‚Üí true
* –°—Ü–µ–Ω–∞—Ä–∏–π: –≤–º–µ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ / –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É¬ª, **–Ω–µ—Ç** –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ FSM —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### R1-4: /start –ø—Ä–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ –ë–î

* –ù–µ—É–¥–∞—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ë–î (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ blacklist –∏–ª–∏ —Å–µ—Å—Å–∏–∏)
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Äî ¬´–°–∏—Å—Ç–µ–º–Ω–∞—è –æ—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ / –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É¬ª
* –í –ª–æ–≥–∞—Ö ‚Äî `[ERROR]` + —Å—Ç–µ–∫—Ç—Ä–µ–π—Å

### 1.2. –ö–Ω–æ–ø–∫–∞ ¬´üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏¬ª (–≥–æ—Å—Ç—å)

#### R1-5: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

* –ü–µ—Ä–µ—Ö–æ–¥ –≤ handler `instructions` –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
* –í—ã–≤–æ–¥–∏—Ç—Å—è:
  * –±–∞–∑–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
  * —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç
  * –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ, —á—Ç–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

#### R1-6: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤–æ –≤—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (FSM –∞–∫—Ç–∏–≤–Ω–æ)

* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `waiting_for_wallet` / `waiting_for_password`, –Ω–∞–∂–∏–º–∞–µ—Ç ¬´üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏¬ª
* –ß–µ—Ä–µ–∑ `is_menu_button()` —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è

### 1.3. –ö–Ω–æ–ø–∫–∞ ¬´üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞¬ª (–≥–æ—Å—Ç—å)

#### R1-7: –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

* –õ–∏–±–æ:
  * –¥–æ–ø—É—Å–∫–∞–µ–º –≥–æ—Å—Ç–µ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã: —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–∏–∫–µ—Ç —Å –ø–æ–º–µ—Ç–∫–æ–π `guest` –∏ —Ç–æ–ª—å–∫–æ telegram_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  * –ª–∏–±–æ –æ—Ç–≤–µ—á–∞–µ–º ¬´–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–π–¥–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é¬ª (–≤ –∫–æ–¥–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é ‚Äî —Å—Ü–µ–Ω–∞—Ä–∏–π –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å)

#### R1-8: –ü—Ä–æ—Å–º–æ—Ç—Ä ¬´üìã –ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è¬ª —É –≥–æ—Å—Ç—è

* –ï—Å–ª–∏ –≥–æ—Å—Ç—å ‚Äî –≤—ã–≤–æ–¥–∏–º ¬´–£ –≤–∞—Å –Ω–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π¬ª –ª–∏–±–æ –ø—Ä–∏–Ω—É–∂–¥–∞–µ–º –∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### 1.4. –ö–Ω–æ–ø–∫–∞ ¬´üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª

#### R1-9: –°—Ç–∞—Ä—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–Ω–æ–ø–∫–æ–π

* –ò–∑ —É—Ä–µ–∑–∞–Ω–Ω–æ–≥–æ –º–µ–Ω—é –≥–æ—Å—Ç—å –∂–º—ë—Ç ¬´üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª
* `menu.py`:
  * –æ–±–Ω—É–ª—è–µ—Ç FSM
  * –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ BSC, —Ñ–æ—Ä–º–∞—Ç `0x...` 42 —Å–∏–º–≤–æ–ª–∞, —Å—Å—ã–ª–∫—É –Ω–∞ —Å–∞–π—Ç
  * —Å—Ç–∞–≤–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `RegistrationStates.waiting_for_wallet`

#### R1-10: –í–≤–æ–¥ –∫–æ—à–µ–ª—å–∫–∞ ‚Äî –≤–∞–ª–∏–¥–Ω—ã–π

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∏ checksum –∞–¥—Ä–µ—Å–∞ (–≤–∞–ª–∏–¥–∞—Ç–æ—Ä BSC)
* –ü—Ä–æ–≤–µ—Ä–∫–∞ rate-limit —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `OperationRateLimiter`
* –ü—Ä–æ–≤–µ—Ä–∫–∞ blacklist –ø–æ –∞–¥—Ä–µ—Å—É –∫–æ—à–µ–ª—å–∫–∞
* –°–æ–∑–¥–∞—ë—Ç—Å—è `user`, —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è referral, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É —Ñ–∏–Ω–ø–∞—Ä–æ–ª—è

#### R1-11: –í–≤–æ–¥ –∫–æ—à–µ–ª—å–∫–∞ ‚Äî –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

* –ê–¥—Ä–µ—Å –Ω–µ 42 —Å–∏–º–≤–æ–ª–∞ / –Ω–µ `0x` / checksum –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
* –û—Ç–≤–µ—Ç: ¬´–∞–¥—Ä–µ—Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, —Ñ–æ—Ä–º–∞—Ç —Ç–∞–∫–æ–π-—Ç–æ¬ª, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å

#### R1-12: –ö–æ—à–µ–ª—ë–∫ —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

* –ü–æ–∏—Å–∫ –≤ `users` –ø–æ `wallet_address`
* –í–∞—Ä–∏–∞–Ω—Ç—ã:
  * –µ—Å–ª–∏ —ç—Ç–æ —Ç–æ—Ç –∂–µ telegram_id ‚Äî –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º `/start` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–π –∞–∫–∫–∞—É–Ω—Ç
  * –µ—Å–ª–∏ –¥—Ä—É–≥–æ–π ‚Äî –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ –∫–æ—à–µ–ª—ë–∫ –∑–∞–Ω—è—Ç, –∏ —Å—Ç–æ–ø

#### R1-13: –ö–æ—à–µ–ª—ë–∫ –∏–ª–∏ telegram_id –≤ blacklist (wallet-ban)

* `BlacklistService.is_blacklisted(telegram_id=None, wallet_address=addr)` ‚Üí true
* –°–æ–æ–±—â–µ–Ω–∏–µ: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞, –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É

#### R1-14: –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

* `OperationRateLimiter.check_registration_limit()` –≤–µ—Ä–Ω—É–ª `allowed=False`
* –°–æ–æ–±—â–µ–Ω–∏–µ ¬´–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ¬ª

#### R1-15: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ –≤—Ä–µ–º—è —à–∞–≥–∞ –∫–æ—à–µ–ª—å–∫–∞ –Ω–∞–∂–∏–º–∞–µ—Ç –ª—é–±—É—é –∫–Ω–æ–ø–∫—É –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é

* `is_menu_button()` ‚Üí —Å–±—Ä–æ—Å FSM, –ø–æ–∫–∞–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é; —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞

### 1.5. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã

#### R1-16: –í—ã–±–æ—Ä –∏ –≤–≤–æ–¥ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—è

* –ü–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ—à–µ–ª—å–∫–∞ –ø—Ä–æ—Å–∏–º –≤–≤–µ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å (`>=6` —Å–∏–º–≤–æ–ª–æ–≤)
* –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
  * —é–∑–µ—Ä –≤–≤–æ–¥–∏—Ç –ø–∞—Ä–æ–ª—å ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª—è–µ—Ç—Å—è (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
  * –ø–∞—Ä–æ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ FSM
  * –∑–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
* –û—à–∏–±–∫–∏:
  * —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –ø–∞—Ä–æ–ª—å ‚Üí ¬´–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤¬ª, –ø–æ–≤—Ç–æ—Ä –≤–≤–æ–¥–∞
  * —é–∑–µ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç –ª—é–±—É—é –º–µ–Ω—é-–∫–Ω–æ–ø–∫—É ‚Üí FSM –æ—á–∏—â–∞–µ—Ç—Å—è, –ø–µ—Ä–µ—Ö–æ–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

#### R1-17: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—è

* –°–æ–≤–ø–∞–ª ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–º–∏—Ç–∏—Ç—Å—è, —Å–æ–∑–¥–∞—ë—Ç—Å—è user + referral, —Ö—ç—à –ø–∞—Ä–æ–ª—è –ø–∏—à–µ—Ç—Å—è –≤ –ë–î
* –ù–µ —Å–æ–≤–ø–∞–ª ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–ø–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç¬ª, –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —à–∞–≥ –≤–≤–æ–¥–∞
* –°–Ω–æ–≤–∞ –≤–æ–∑–º–æ–∂–µ–Ω –≤—ã—Ö–æ–¥ –≤ –º–µ–Ω—é —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É

#### R1-18: –í–≤–æ–¥ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (—Ç–µ–ª–µ—Ñ–æ–Ω/e-mail)

* –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
  * —Å–ø—Ä–∞—à–∏–≤–∞–µ–º, —Ö–æ—á–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã (`contacts_choice_keyboard`: ¬´‚úÖ –î–∞, –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã¬ª / ¬´‚è≠ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å¬ª)
* –°—Ü–µ–Ω–∞—Ä–∏–∏:
  * —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è ‚Üí –≤–≤–æ–¥–∏—Ç —Ç–µ–ª–µ—Ñ–æ–Ω/e-mail, –≤–∞–ª–∏–¥–∞—Ü–∏—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
  * –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç ‚Üí —Å—Ä–∞–∑—É –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

#### R1-19: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∫–∞–∑ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—è

* –í —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—å –º–æ–∂–Ω–æ –µ—â—ë —Ä–∞–∑ –∑–∞–ø—Ä–æ—Å–∏—Ç—å (–ª–æ–≥–∏–∫–∞ –∏–∑ CHANGELOG/TS –≤–µ—Ä—Å–∏–∏)
* –ö–Ω–æ–ø–∫–∞ —Ç–∏–ø–∞ ¬´–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å –µ—â—ë —Ä–∞–∑¬ª –≤ —É—Å–ø–µ—Ö-—Å–æ–æ–±—â–µ–Ω–∏–∏

---

## 2. R2 ‚Äî –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç, –ª—é–±—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã/—Ä–µ—Ñ—ã, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)

–û–Ω –≤–∏–¥–∏—Ç **–ø–æ–ª–Ω–æ–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é**.

### 2.1. –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è

#### R2-1: –ö–Ω–æ–ø–∫–∞ ¬´üìä –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é¬ª / ¬´‚¨Ö –ù–∞–∑–∞–¥¬ª

* –í –ª—é–±–æ–º FSM —Å–æ—Å—Ç–æ—è–Ω–∏–∏:
  * state.clear()
  * –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–π `blacklist_entry`
  * —Å—Ç—Ä–æ–∏—Ç—Å—è `main_menu_reply_keyboard` —Å —É—á—ë—Ç–æ–º admin-—Ñ–ª–∞–≥–∞
  * –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞

#### R2-2: ¬´‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏¬ª ‚Üí settings_keyboard

* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ø–æ–¥–º–µ–Ω—é:
  * `üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å`
  * `üí≥ –ú–æ–π –∫–æ—à–µ–ª–µ–∫`
  * `üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π`
  * `üìù –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã`
  * `üìä –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é`

#### R2-3: ¬´üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏¬ª (–ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)

* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —É–∂–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–Ω—Ñ—É –ø—Ä–æ –¥–µ–ø–æ–∑–∏—Ç—ã, —É—Ä–æ–≤–Ω–∏ –∏ —Ç.–¥.)
* –ö–Ω–æ–ø–∫–∞ ¬´üìä –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é¬ª –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∑–∞–¥

#### R2-4: ¬´üìú –ò—Å—Ç–æ—Ä–∏—è¬ª

* –ü–µ—Ä–µ—Ö–æ–¥ –≤ `transaction.py`:
  * –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–µ—Ç ‚Üí ¬´–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞¬ª
  * –µ—Å–ª–∏ –µ—Å—Ç—å ‚Üí –ø–∞–≥–∏–Ω–∞—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø–∞–º: –¥–µ–ø–æ–∑–∏—Ç—ã, –≤—ã–≤–æ–¥—ã, —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ

### 2.2. –ü—Ä–æ—Ñ–∏–ª—å / –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### R2-5: ¬´üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å¬ª

* –ü–æ–∫–∞–∑:
  * –±–∞–ª–∞–Ω—Å (–¥–æ—Å—Ç—É–ø–Ω—ã–π/–≤ –æ–∂–∏–¥–∞–Ω–∏–∏/–≤—ã–ø–ª–∞—á–µ–Ω–Ω—ã–π)
  * –∞–∫—Ç–∏–≤–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤
  * —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
  * —Å—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

#### R2-6: ¬´üí≥ –ú–æ–π –∫–æ—à–µ–ª–µ–∫¬ª

* –°—Ç–∞—Ç—É—Å –∫–æ—à–µ–ª—å–∫–∞:
  * —Ç–µ–∫—É—â–∏–π –∞–¥—Ä–µ—Å
  * –≤–æ–∑–º–æ–∂–µ–Ω –ª–∏ –∑–∞–ø—Ä–æ—Å —Å–º–µ–Ω—ã –∫–æ—à–µ–ª—å–∫–∞ (—á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–æ–≤ / wallet_change_request)

#### R2-7: ¬´üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π¬ª

* –¢—Ä–∏ —Ç—É–º–±–ª–µ—Ä–∞ (–¥–µ–ø–æ–∑–∏—Ç—ã, –≤—ã–≤–æ–¥—ã, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥)
* –°—Ü–µ–Ω–∞—Ä–∏–∏:
  * –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
  * –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

#### R2-8: ¬´üìù –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã¬ª

* –í–≤–æ–¥ –Ω–æ–≤–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞/e-mail
* –í–∞–ª–∏–¥–∞—Ü–∏—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

### 2.3. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

#### R2-9: ¬´‚úÖ –ü—Ä–æ–π—Ç–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é¬ª

* –°—Ü–µ–Ω–∞—Ä–∏–∏:
  * –µ—â—ë –Ω–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω:
    * –∑–∞–ø—É—Å–∫ FSM –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–≤–≤–æ–¥ –§–ò–û/—Å—Ç—Ä–∞–Ω—ã/–ø—Ä–æ—á–∏—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¢–ó)
    * –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞–º–∏ ‚Üí —Ñ–ª–∞–≥ `is_verified=True` –≤ –ë–î
    * –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ —á–∞—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (–≤—ã–≤–æ–¥)
  * —É–∂–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω:
    * –æ—Ç–≤–µ—Ç ¬´–≤—ã —É–∂–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã¬ª

#### R2-10: –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

* –Ω–µ—Ö–≤–∞—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
* –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
* –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ (rate-limit –Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é)

---

## 3. R3 ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-–∏–Ω–≤–µ—Å—Ç–æ—Ä (–µ—Å—Ç—å –¥–µ–ø–æ–∑–∏—Ç—ã)

–¢—É—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —É–ø–æ—Ä –Ω–∞ `üí∞ –î–µ–ø–æ–∑–∏—Ç`, `üì¶ –ú–æ–∏ –¥–µ–ø–æ–∑–∏—Ç—ã`, `üìä –ë–∞–ª–∞–Ω—Å` –∏ `üí∏ –í—ã–≤–æ–¥`.

### 3.1. –ö–Ω–æ–ø–∫–∞ ¬´üí∞ –î–µ–ø–æ–∑–∏—Ç¬ª ‚Üí deposit_keyboard

#### R3-1: –û—Ç–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –¥–µ–ø–æ–∑–∏—Ç–æ–≤

* –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è `deposit_keyboard()` —Å —É—Ä–æ–≤–Ω—è–º–∏ 1‚Äì5 –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏:
  * –∞–∫—Ç–∏–≤–µ–Ω
  * –¥–æ—Å—Ç—É–ø–µ–Ω –∫ –ø–æ–∫—É–ø–∫–µ
  * –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (–Ω–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ / –Ω–µ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤)

#### R3-2: –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è

* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–º—ë—Ç ¬´üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å Level N (...)¬ª:
  * –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª (–ø—Ä–µ–¥—ã–¥—É—â–∏–µ —É—Ä–æ–≤–Ω–∏, –ª–∏–º–∏—Ç –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –∏ —Ç.–¥.)
  * –ø–æ–∫–∞–∑ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
    * —Å–∫–æ–ª—å–∫–æ USDT –Ω–∞–¥–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
    * –Ω–∞ –∫–∞–∫–æ–π –∞–¥—Ä–µ—Å
    * –≤ –∫–∞–∫–æ–π —Å–µ—Ç–∏
  * —Å–æ–∑–¥–∞—ë—Ç—Å—è `pending` –¥–µ–ø–æ–∑–∏—Ç + –æ–∂–∏–¥–∞–µ–º—ã–π –æ–±—ä—ë–º

#### R3-3: –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è

* –ö–Ω–æ–ø–∫–∞ ¬´‚úÖ Level N (...) ‚Äî –ê–∫—Ç–∏–≤–µ–Ω¬ª:
  * –ª–∏–±–æ –∑–∞–ø—Ä–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ —É—Ä–æ–≤–Ω—è
  * –ª–∏–±–æ –ø–µ—Ä–µ—Ö–æ–¥ –∫ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é (–µ—Å–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ)

#### R3-4: –ü–æ–ø—ã—Ç–∫–∞ –∫—É–ø–∏—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å

* –ö–Ω–æ–ø–∫–∞ ¬´üîí Level N ‚Äî –ù–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ/–ù–µ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤/–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω¬ª:
  * —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–∏—á–∏–Ω–æ–π (–Ω–µ—Ç Level N-1; –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤; –¥—Ä—É–≥–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)
  * –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏–µ (–Ω–∞–ø—Ä. –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å X —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤)

#### R3-5: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤ (—Ñ–æ–Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)

* Blockchain-–º–æ–Ω–∏—Ç–æ—Ä –Ω–∞—Ö–æ–¥–∏—Ç `Transfer USDT` –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∫–æ—à–µ–ª—ë–∫, —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å –æ–∂–∏–¥–∞–µ–º—ã–º –¥–µ–ø–æ–∑–∏—Ç–æ–º –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç
* –ï—Å–ª–∏ tx –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Äî –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –æ–∂–∏–¥–∞–Ω–∏–∏, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ¬´—É–º–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏¬ª –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

#### R3-6: –û—à–∏–±–∫–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤

* –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª –º–µ–Ω—å—à–µ —Å—É–º–º—ã ‚Üí –¥–µ–ø–æ–∑–∏—Ç –æ—Ç–∫–ª–æ–Ω—ë–Ω/–æ–±–Ω–æ–≤–ª—ë–Ω –Ω–∞ –º–µ–Ω—å—à–∏–π —É—Ä–æ–≤–µ–Ω—å
* –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ —á—É–∂–æ–π –∞–¥—Ä–µ—Å ‚Üí –¥–µ–ø–æ–∑–∏—Ç –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è ‚Üí —á–µ—Ä–µ–∑ `searchBlockchainForDeposit()` –ø–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
* –∏—Å—Ç—ë–∫ —Ç–∞–π–º-–∞—É—Ç –¥–µ–ø–æ–∑–∏—Ç–∞ ‚Üí –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ FAILED –∏ —É–≤–µ–¥–æ–º–ª—è–µ–º

### 3.2. ¬´üì¶ –ú–æ–∏ –¥–µ–ø–æ–∑–∏—Ç—ã¬ª

#### R3-7: –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤

* –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–µ—Ç ‚Üí ¬´–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤, —Å–æ–∑–¥–∞–π—Ç–µ —á–µ—Ä–µ–∑ "üí∞ –î–µ–ø–æ–∑–∏—Ç"¬ª
* –ï—Å–ª–∏ –µ—Å—Ç—å:
  * –ø–æ –∫–∞–∂–¥–æ–º—É –¥–µ–ø–æ–∑–∏—Ç—É:
    * —É—Ä–æ–≤–µ–Ω—å, –¥–∞—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è, —Å—É–º–º–∞
    * –ø—Ä–æ–≥—Ä–µ—Å—Å ROI (–Ω–∞–ø—Ä–∏–º–µ—Ä, `x% –∏–∑ 500%`), —Å—Ç–∞—Ç—É—Å ¬´–∞–∫—Ç–∏–≤–µ–Ω/–∑–∞–∫—Ä—ã—Ç¬ª, —ç–º–æ–¥–∑–∏ —Å—Ç–∞—Ç—É—Å–∞

#### R3-8: –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç (ROI –¥–æ—Å—Ç–∏–≥–Ω—É—Ç)

* `is_roi_completed=True` ‚Üí —Å—Ç–∞—Ç—É—Å ¬´–ó–∞–∫—Ä—ã—Ç (ROI 500%)¬ª
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç, —á—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø–æ —ç—Ç–æ–º—É –¥–µ–ø–æ–∑–∏—Ç—É –Ω–µ –∏–¥—É—Ç

### 3.3. –ë–∞–ª–∞–Ω—Å –∏ –≤—ã–≤–æ–¥

#### R3-9: ¬´üìä –ë–∞–ª–∞–Ω—Å¬ª

* –†–∞–∑–±–∏–≤–∫–∞:
  * –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å
  * –≤ –æ–∂–∏–¥–∞–Ω–∏–∏
  * –≤—ã–ø–ª–∞—á–µ–Ω–æ
  * —Å—É–º–º–∞ –ø–æ –¥–µ–ø–æ–∑–∏—Ç–∞–º, —Ä–µ—Ñ–µ—Ä–∞–ª–∫–µ –∏ —Ç.–ø.

#### R3-10: ¬´üí∏ –í—ã–≤–æ–¥¬ª ‚Üí withdrawal_keyboard

* –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–µ–Ω—é:
  * `üí∏ –í—ã–≤–µ—Å—Ç–∏ –≤—Å—é —Å—É–º–º—É`
  * `üíµ –í—ã–≤–µ—Å—Ç–∏ —É–∫–∞–∑–∞–Ω–Ω—É—é —Å—É–º–º—É`
  * `üìú –ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤`
  * `üìä –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é`

#### R3-11: ¬´üí∏ –í—ã–≤–µ—Å—Ç–∏ –≤—Å—é —Å—É–º–º—É¬ª

* –ü—Ä–æ–≤–µ—Ä–∫–∞:
  * user –µ—Å—Ç—å
  * `is_verified=True` (–∏–Ω–∞—á–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–≤—ã–≤–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏¬ª)
  * rate-limit –ø–æ –≤—ã–≤–æ–¥–∞–º (–ª–∏–º–∏—Ç—ã –≤ —á–∞—Å/–¥–µ–Ω—å)
  * —Ä–∞—Å—á—ë—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ `UserService.get_user_balance()` –≤ –∫–æ—Ä–æ—Ç–∫–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  * –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞
* –ï—Å–ª–∏ –≤—Å—ë –æ–∫:
  * —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å—É–º–º–∞ –≤ FSM
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ—Å—è—Ç –≤–≤–µ—Å—Ç–∏ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—å

#### R3-12: ¬´üíµ –í—ã–≤–µ—Å—Ç–∏ —É–∫–∞–∑–∞–Ω–Ω—É—é —Å—É–º–º—É¬ª

* –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ:
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Å—É–º–º—É
  * –ø—Ä–æ–≤–µ—Ä–∫–∞:
    * —á–∏—Å–ª–æ >0
    * –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç `available_balance`
    * –Ω–µ –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º—É–º–∞
  * –î–∞–ª–µ–µ ‚Äî —à–∞–≥ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—è

#### R3-13: –®–∞–≥ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—è –ø—Ä–∏ –≤—ã–≤–æ–¥–µ

* –ü–∞—Ä–æ–ª—å –≤–µ—Ä–µ–Ω ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥, —Å—Ç–∞—Ç—É—Å `PENDING`, –æ—Ç–≤–µ—Ç —Å ID –∑–∞—è–≤–∫–∏ –∏ —Ç–µ–∫—Å—Ç–æ–º ¬´–Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ 1‚Äì24 —á–∞—Å–∞¬ª
* –ü–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–µ–Ω:
  * —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
  * –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å—á—ë—Ç—á–∏–∫ –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Å–ª–µ N?)

#### R3-14: ¬´üìú –ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤¬ª

* –ï—Å–ª–∏ –∑–∞—è–≤–æ–∫ –Ω–µ—Ç ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤ –ø—É—Å—Ç–∞¬ª
* –ï—Å–ª–∏ –µ—Å—Ç—å:
  * —Å–ø–∏—Å–æ–∫, –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞:
    * —Å—É–º–º–∞, —Å—Ç–∞—Ç—É—Å (`PENDING/CONFIRMED/REJECTED`), –¥–∞—Ç–∞
  * –ø—Ä–æ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ –∫–Ω–æ–ø–∫–∞–º/–∫–æ–º–∞–Ω–¥–∞–º (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

#### R3-15: –û—à–∏–±–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥–µ

* –ù–µ—Ç —Å–µ—Å—Å–∏–∏ –∫ –ë–î / `session_factory` ‚Üí ¬´–°–∏—Å—Ç–µ–º–Ω–∞—è –æ—à–∏–±–∫–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /start¬ª
* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—à–∏–±–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ –≤—ã–≤–æ–¥–∞ ‚Üí ¬´–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ¬ª + –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

---

## 4. R4 ‚Äî –ü–∞—Ä—Ç–Ω—ë—Ä (—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞)

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞ –∫–Ω–æ–ø–∫–µ ¬´üë• –†–µ—Ñ–µ—Ä–∞–ª—ã¬ª + `referral_keyboard`.

### 4.1. –ú–µ–Ω—é —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

#### R4-1: –í—Ö–æ–¥ –≤ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–µ –º–µ–Ω—é

* `üë• –†–µ—Ñ–µ—Ä–∞–ª—ã` ‚Üí –ø–æ–∫–∞–∑:
  * `üë• –ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã`
  * `üí∞ –ú–æ–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫`
  * `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤`
  * `üìä –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é`

### 4.2. ¬´üë• –ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã¬ª

#### R4-2: –ù–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞

* `ReferralRepository.get_by_referrer()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
* –°–æ–æ–±—â–µ–Ω–∏–µ: ¬´–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤¬ª

#### R4-3: –ï—Å—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—ã (–ø–æ —É—Ä–æ–≤–Ω—è–º)

* –í—ã–≤–æ–¥:
  * —Å–ø–∏—Å–æ–∫ Level 1 —Å –¥–∞—Ç–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å—É–º–º–æ–π –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –Ω–∞ –∫–∞–∂–¥–æ–º
  * –≤–æ–∑–º–æ–∂–Ω–æ, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è (1‚Äì3) —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

#### R4-4: –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤

* –ü—Ä–∏ –±–æ–ª—å—à–æ–º —á–∏—Å–ª–µ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `page`/`limit` –≤ `get_referrals_by_level`
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–Ω–æ–ø–∫–∞–º–∏/–∫–æ–º–∞–Ω–¥–∞–º–∏

### 4.3. ¬´üí∞ –ú–æ–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫¬ª

#### R4-5: –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—É–º–º–∞—Ä–Ω–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞

* `ReferralEarningRepository` —Å—á–∏—Ç–∞–µ—Ç total –ø–æ unpaid/paid
* –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è:
  * –æ–±—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫
  * —Å–∫–æ–ª—å–∫–æ –µ—â—ë –Ω–µ –≤—ã–ø–ª–∞—á–µ–Ω–æ
  * —Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –Ω–∞ –∫–æ—à–µ–ª—ë–∫

#### R4-6: –ù—É–ª–µ–≤–æ–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫

* –°–æ–æ–±—â–µ–Ω–∏–µ ¬´–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π¬ª

### 4.4. ¬´üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤¬ª

#### R4-7: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º

* `ReferralRepository.count_by_level()` –¥–∞—ë—Ç —á–∏—Å–ª–∞ –ø–æ –∫–∞–∂–¥–æ–º—É —É—Ä–æ–≤–Ω—é
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç:
  * —Å–∫–æ–ª—å–∫–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —É—Ä–æ–≤–Ω—è 1/2/3
  * –≤–æ–∑–º–æ–∂–Ω–æ, –∫–æ–Ω–≤–µ—Ä—Å–∏—é –≤ –ø—Ä–æ—Ü–µ–Ω—Ç—ã

#### R4-8: –û—à–∏–±–∫–∏/edge-–∫–µ–π—Å—ã

* –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø–µ—Ç–ª—è (–µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é —Ü–µ–ø–æ—á–∫—É) ‚Äî –ª–æ–≤–∏—Ç—Å—è –≤ `create_referral_relationships` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É ¬´–ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Ü–µ–ø–æ—á–∫—É¬ª (—ç—Ç–æ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –Ω–æ —Å—Ü–µ–Ω–∞—Ä–∏–π –≤–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å)

---

## 5. R5 ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ / —Å–∞–Ω–∫—Ü–∏—è–º–∏

### 5.1. Blacklist –¥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### R5-1: –¢–µ–ª–µ–≥—Ä–∞–º –≤ blacklist (registration_denied)

* –õ—é–±–∞—è –ø–æ–ø—ã—Ç–∫–∞ `/start` –∏–ª–∏ ¬´üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª:
  * –ø—Ä–æ–≤–µ—Ä–∫–∞ `BlacklistService.is_blacklisted(telegram_id=...)`
  * –æ—Ç–≤–µ—Ç ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞¬ª + –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
  * FSM —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

#### R5-2: –ö–æ—à–µ–ª—ë–∫ –≤ blacklist

* –ù–∞ —à–∞–≥–µ –≤–≤–æ–¥–∞ –∫–æ—à–µ–ª—å–∫–∞ ‚Äî —Å–º. R1-13

### 5.2. BLOCKED –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### R5-3: –ú–µ–Ω—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

* –ü—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ `main_menu_reply_keyboard`:
  * –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π `Blacklist` —Å `action_type=BLOCKED`, —Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –∫–Ω–æ–ø–∫–∞ ¬´üìù –ü–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é¬ª

#### R5-4: –ù–∞–∂–∞—Ç–∏–µ ¬´üìù –ü–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é¬ª

* –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤ `appeal.start_appeal`:
  * –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ blacklist ‚Üí ¬´–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏¬ª
  * action_type ‚â† BLOCKED ‚Üí ¬´–∞–ø–µ–ª–ª—è—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤¬ª
  * –∏—Å—Ç—ë–∫ —Å—Ä–æ–∫ –∞–ø–µ–ª–ª—è—Ü–∏–∏ (3 –¥–Ω—è) ‚Üí ¬´—Å—Ä–æ–∫ –ø–æ–¥–∞—á–∏ –∏—Å—Ç—ë–∫¬ª
  * —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –∞–ø–µ–ª–ª—è—Ü–∏—è ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∏ –¥–∞—Ç—É, –ø—Ä–æ—Å–∏–º –∂–¥–∞—Ç—å
  * –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∞–ø–µ–ª–ª—è—Ü–∏–π ‚Üí –æ—à–∏–±–∫–∞ –∏ –ø—Ä–æ—Å—å–±–∞ –∂–¥–∞—Ç—å
  * –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö ‚Äî –∑–∞–ø—É—Å–∫–∞–µ–º FSM, –ø—Ä–æ—Å–∏–º —Ç–µ–∫—Å—Ç –∞–ø–µ–ª–ª—è—Ü–∏–∏

#### R5-5: –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ –∞–ø–µ–ª–ª—è—Ü–∏–∏

* –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç < 20 —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí ¬´—Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π, –º–∏–Ω–∏–º—É–º 20¬ª
* –ò–Ω–∞—á–µ:
  * —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `appeals`
  * —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–∏–∫–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
  * —Å—Ç–∞—Ç—É—Å `PENDING`, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

### 5.3. TERMINATED

#### R5-6: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å `BlacklistActionType.TERMINATED`

* `BanMiddleware` –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–ª–æ—Ç–∞–µ—Ç –∞–ø–¥–µ–π—Ç—ã —Ç–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ö—ç–Ω–¥–ª–µ—Ä—ã –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è (–ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–æ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö blacklist –∏ middleware; —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–æ—Ç –≤—ã–≥–ª—è–¥–∏—Ç ¬´–º—ë—Ä—Ç–≤—ã–º¬ª)

### 5.4. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—é –∏ –≤—ã–ø–ª–∞—Ç–∞–º

#### R5-7: –ê–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∏–Ω–ø–∞—Ä–æ–ª—è

* –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
  * –µ—Å–ª–∏ –µ—Å—Ç—å `pending` –∑–∞–ø—Ä–æ—Å ‚Üí ¬´—É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å, –¥–æ–∂–¥–∏—Ç–µ—Å—å —Ä–µ—à–µ–Ω–∏—è¬ª + –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

#### R5-8: –ó–∞–ø—Ä–æ—Å –æ–¥–æ–±—Ä–µ–Ω, –Ω–æ –µ—â—ë –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å

* `FinpassRecoveryService.has_active_recovery()` ‚Üí true:
  * —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
  * –≤—ã–ø–ª–∞—Ç—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –¥–æ –ø–µ—Ä–≤–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º

#### R5-9: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–µ—Ç–∫—É:
  * ¬´üîë –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∏–Ω–ø–∞—Ä–æ–ª—å¬ª ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ ‚Üí ¬´‚ùå –û—Ç–º–µ–Ω–∞ / üìä –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é¬ª –ª–∏–±–æ –≤–≤–æ–¥ –ø—Ä–∏—á–∏–Ω—ã
  * —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞ (<10) ‚Üí –ø—Ä–æ—Å–∏–º —Ä–∞—Å–ø–∏—Å–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ
  * –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞—è–≤–∫–∞, –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –≤—ã–ø–ª–∞—Ç—ã, —É–ª–µ—Ç–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º

---

## 6. R6 ‚Äî –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (admin / extended / super_admin)

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –±–µ—Ä—ë–º –∏–∑ `admin_keyboard()`:
`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞`, `üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏`, `üí∏ –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥`,
`üì¢ –†–∞—Å—Å—ã–ª–∫–∞`, `üÜò –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞`, `üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–º`,
`üö´ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–Ω—ã–º —Å–ø–∏—Å–∫–æ–º`, `‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤`,
–ø–ª—é—Å `üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏` —Ç–æ–ª—å–∫–æ –¥–ª—è super_admin.

### 6.1. –í—Ö–æ–¥ –∏ —Å–µ—Å—Å–∏–∏

#### R6-1: /admin ‚Üí –∑–∞–ø—Ä–æ—Å –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∞

* –ö–æ–º–∞–Ω–¥–∞ `/admin`:
  * –µ—Å–ª–∏ —é–∑–µ—Ä –∏–º–µ–µ—Ç —Ñ–ª–∞–≥ `is_admin` ‚Äî –ø—Ä–æ—Å–∏–º –≤–≤–µ—Å—Ç–∏ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á
  * –∏–Ω–∞—á–µ ‚Üí ¬´—ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º¬ª

#### R6-2: –í–≤–æ–¥ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∞ (—É—Å–ø–µ—Ö)

* `AdminService.login(...)`:
  * —Å–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç `AdminSession` (Redis/–ë–î)
  * –ø–∏—à–µ—Ç –ª–æ–≥
  * FSM —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
  * –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

#### R6-3: –í–≤–æ–¥ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∞ (–æ—à–∏–±–∫–∞)

* –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ / –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑¬ª
* –ù–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥—Ä—è–¥ ‚Üí –≤–æ–∑–º–æ–∂–Ω–æ, –∑–∞–ø–∏—Å—å –≤ `admin_actions` –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ (—Å–º. —Ç–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã)

#### R6-4: –ê–≤—Ç–æ-—Ä–∞–∑–ª–æ–≥–∏–Ω –ø—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏

* –ï—Å–ª–∏ `last_activity` > 15 –º–∏–Ω—É—Ç:
  * –ø—Ä–∏ –ª—é–±–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ ‚Üí –∑–∞–ø—Ä–æ—Å –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ

#### R6-5: –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π

* –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ `admin_session_cleanup` —Å–Ω–∏–º–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ —Å–µ—Å—Å–∏–∏
* –°—Ü–µ–Ω–∞—Ä–∏–π: –∞–¥–º–∏–Ω —Å–ø—É—Å—Ç—è –¥–µ–Ω—å –ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –≤ –ø–∞–Ω–µ–ª–∏ ‚Üí —Å–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞, –µ–≥–æ –ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞–µ—Ç –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

### 6.2. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–±–∞–∑–æ–≤—ã–π admin)

#### R6-6: ¬´üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª

* –ü–æ–∫–∞–∑:
  * –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –¥–µ–ø–æ–∑–∏—Ç–æ–≤, —Å—É–º–º–∞—Ä–Ω—ã–π –æ–±—ä—ë–º, —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã –∏ —Ç.–ø.

#### R6-7: ¬´üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏¬ª ‚Üí admin_users_keyboard

* –ö–Ω–æ–ø–∫–∏:
  * `üîç –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è`
  * `üë• –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`
  * `üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è`
  * `‚ö†Ô∏è –¢–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç`
  * `üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å`
* –°—Ü–µ–Ω–∞—Ä–∏–∏:
  * –ø–æ–∏—Å–∫ –ø–æ username/ID
  * –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  * –±–∞–Ω (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ blacklist —Å `BLOCKED`, –ª–∏–±–æ `TERMINATED`)
  * —Ä–∞–∑–±–∞–Ω (–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏)

#### R6-8: ¬´üí∏ –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥¬ª ‚Üí admin_withdrawals_keyboard

* –ö–Ω–æ–ø–∫–∏:
  * `‚è≥ –û–∂–∏–¥–∞—é—â–∏–µ –≤—ã–≤–æ–¥—ã`
  * `‚úÖ –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –≤—ã–≤–æ–¥—ã`
  * `‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –≤—ã–≤–æ–¥—ã`
  * `üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å`
* –°—Ü–µ–Ω–∞—Ä–∏–∏:
  * –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ `PENDING`
  * –≤—ã–±–æ—Ä –∑–∞—è–≤–∫–∏ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:
    * –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏:
      * –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ USDT —á–µ—Ä–µ–∑ blockchain-—Å–µ—Ä–≤–∏—Å
      * –ø—Ä–∏ —É—Å–ø–µ—Ö–µ —Å—Ç–∞—Ç—É—Å `CONFIRMED`, –ª–æ–≥ –≤ `admin_actions`, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
      * –ø—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî –∑–∞–ø–∏—Å—å –≤ retry/payment-DLQ
    * –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ:
      * —Å—Ç–∞—Ç—É—Å `REJECTED`, –≤–æ–∑–≤—Ä–∞—Ç —Å—É–º–º—ã –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

#### R6-9: ¬´üì¢ –†–∞—Å—Å—ã–ª–∫–∞¬ª

* –ó–∞–ø—É—Å–∫ —Å—Ü–µ–Ω–∞—Ä–∏—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏:
  * –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞/–º–µ–¥–∏–∞
  * –ø—Ä–æ–≤–µ—Ä–∫–∞ cooldown (–Ω–∞–ø—Ä–∏–º–µ—Ä, 15 –º–∏–Ω—É—Ç –º–µ–∂–¥—É —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏), –ª–∏–º–∏—Ç–∞ 15 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫
  * –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ/–æ—à–∏–±–æ–∫
  * –æ—à–∏–±–∫–∏ ‚Üí –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ retry-—Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### R6-10: ¬´üÜò –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞¬ª

* –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—á–µ—Ä–µ–¥–∏ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –∞–ø–µ–ª–ª—è—Ü–∏–π)
* –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–≤—è–∑–∞–Ω–Ω–æ–π –ø–µ—Ä–µ–ø–∏—Å–∫–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

#### R6-11: ¬´üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–º¬ª ‚Üí admin_wallet_keyboard

* –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ (–±–∞–ª–∞–Ω—Å—ã, –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª—é—á–∏)
* –°—Ü–µ–Ω–∞—Ä–∏–∏:
  * –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞/seed
  * —É–¥–∞–ª–µ–Ω–∏–µ –∫–ª—é—á–∞
  * –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ extended/super_admin)

#### R6-12: ¬´üö´ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–Ω—ã–º —Å–ø–∏—Å–∫–æ–º¬ª ‚Üí admin_blacklist_keyboard

* `‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ blacklist`, `üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∏–∑ blacklist`, `üìù –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç—ã`, `üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å`
* –°—Ü–µ–Ω–∞—Ä–∏–∏:
  * –±–∞–Ω –ø–æ telegram_id
  * –±–∞–Ω –ø–æ –∫–æ—à–µ–ª—å–∫—É (–≤–∫–ª—é—á–∞—è wallet-only –±–∞–Ω)
  * —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ —Ç–µ–∫—Å—Ç–æ–≤ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ / –∞–ø–µ–ª–ª—è—Ü–∏–∏

#### R6-13: ¬´‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤¬ª ‚Üí admin_deposit_settings_keyboard

* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–µ–Ω—è—Ç—å:
  * —Å—É–º–º—ã –ø–æ —É—Ä–æ–≤–Ω—è–º
  * –ª–∏–º–∏—Ç—ã
  * –æ–ø–∏—Å–∞–Ω–∏–µ
  * –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è

### 6.3. Super_admin-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞

#### R6-14: ¬´üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏¬ª ‚Üí admin_management_keyboard

* –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `is_super_admin=True`
* –ö–Ω–æ–ø–∫–∏:
  * `‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∞`
  * `üìã –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤`
  * `üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∞`
  * `üõë –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞–¥–º–∏–Ω–∞`
  * `üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å`
* –°—Ü–µ–Ω–∞—Ä–∏–∏:
  * —Å–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∞ —Å —Ä–æ–ª—å—é (admin/extended/super_admin), –æ—Ç–ø—Ä–∞–≤–∫–∞ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∞ –≤ Telegram
  * –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–æ–≤, –∏—Ö —Ä–æ–ª–µ–π –∏ —Å–æ–∑–¥–∞—Ç–µ–ª—è
  * —É–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è —Å–µ–±—è –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ super_admin)
  * —ç–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–¥–º–∏–Ω–∞ (—Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ blacklist/TERMINATED –∏ –≤—ã—Ä—É–±–∞–µ—Ç –≤—Å–µ –µ–≥–æ —Å–µ—Å—Å–∏–∏)

#### R6-15: –ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–æ–≤

* –õ—é–±–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∞–¥–º–∏–Ω–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞, –±–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ–¥–æ–±—Ä–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∞, —Ä–∞—Å—Å—ã–ª–∫–∞) –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ `admin_actions`
* –°—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —á–µ—Ä–µ–∑ SQL/–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

## 7. R7 ‚Äî –§–æ–Ω–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞

### 7.1. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

#### R7-1: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ ROI (2% –≤ –¥–µ–Ω—å)

* –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ 00:00 UTC)
* –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º –¥–µ–ø–æ–∑–∏—Ç–∞–º —Å `is_roi_completed=False` –∏ `status=CONFIRMED`
* –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç 2% –æ—Ç —Å—É–º–º—ã –¥–µ–ø–æ–∑–∏—Ç–∞, –Ω–∞—á–∏—Å–ª—è–µ—Ç –Ω–∞ `available_balance`
* –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ 500%:
  * –µ—Å–ª–∏ `total_earned >= deposit_amount * 5` ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `is_roi_completed=True`
* –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –≤ `transactions` —Å —Ç–∏–ø–æ–º `ROI_EARNING`
* –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–ø–æ–∑–∏—Ç–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
* –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö ‚Äî retry –º–µ—Ö–∞–Ω–∏–∑–º —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

### 7.2. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

#### R7-2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –¥–µ–ø–æ–∑–∏—Ç–∞

* –ü—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–µ–ø–æ–∑–∏—Ç–∞ —Å `PENDING` –Ω–∞ `CONFIRMED` (—Ç—Ä–∏–≥–≥–µ—Ä –∏–∑ blockchain service)
* `ReferralService.process_deposit_referral_earnings()`:
  * –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Ü–µ–ø–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `get_referral_chain(user_id, depth=3)`
  * –Ω–∞—á–∏—Å–ª—è–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏:
    * 3% —Ä–µ—Ñ–µ—Ä–µ—Ä—É —É—Ä–æ–≤–Ω—è 1
    * 2% —Ä–µ—Ñ–µ—Ä–µ—Ä—É —É—Ä–æ–≤–Ω—è 2
    * 5% —Ä–µ—Ñ–µ—Ä–µ—Ä—É —É—Ä–æ–≤–Ω—è 3
  * —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ `referral_earnings` —Å `is_paid=False`
  * –∞—Ç–æ–º–∞—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å—ã —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤
* –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∂–¥–æ–º—É —Ä–µ—Ñ–µ—Ä–µ—Ä—É –æ –Ω–æ–≤–æ–º –∑–∞—Ä–∞–±–æ—Ç–∫–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
* –õ–æ–≥–∏—Ä—É–µ—Ç –≤ `transactions` —Å —Ç–∏–ø–æ–º `REFERRAL_EARNING`

### 7.3. –¢–∞–π–º–∞—É—Ç—ã –∏ –æ—á–∏—Å—Ç–∫–∞

#### R7-3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞—é—â–∏—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤

* –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ `deposit_timeout_checker` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å
* –í—ã–±–∏—Ä–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç—ã –≤ —Å—Ç–∞—Ç—É—Å–µ `PENDING` —Å `created_at < NOW() - INTERVAL '24 hours'`
* –î–ª—è –∫–∞–∂–¥–æ–≥–æ:
  * –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ—Ç –ª–∏ –≤—Å—ë-—Ç–∞–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ (–ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ `searchBlockchainForDeposit`)
  * –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:
    * –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å `EXPIRED`
    * –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ
    * –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: ¬´–î–µ–ø–æ–∑–∏—Ç –Ω–µ –±—ã–ª –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤, —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –¥–µ–ø–æ–∑–∏—Ç¬ª
* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç—ë–∫—à–∏–º –¥–µ–ø–æ–∑–∏—Ç–∞–º —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∞–¥–º–∏–Ω–∞–º–∏

### 7.4. Blockchain error handling –∏ retry

#### R7-4: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ failed —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤—ã–≤–æ–¥–∞

* –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ `withdrawal_retry_processor` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç withdrawal requests –≤ —Å—Ç–∞—Ç—É—Å–µ `PROCESSING` –∏–ª–∏ —Å —Ñ–ª–∞–≥–æ–º `retry_needed`
* –ü—Ä–∏ blockchain –æ—à–∏–±–∫–∞—Ö (network timeout, nonce conflict, insufficient gas, RPC errors):
  * –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π: 1 –º–∏–Ω ‚Üí 5 –º–∏–Ω ‚Üí 15 –º–∏–Ω ‚Üí 1 —á–∞—Å ‚Üí 4 —á–∞—Å–∞
  * –∫–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ `withdrawal_retry_log` —Å –¥–µ—Ç–∞–ª—è–º–∏ –æ—à–∏–±–∫–∏
  * –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ gas price –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å gas)
* –ü–æ—Å–ª–µ N –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5):
  * —ç—Å–∫–∞–ª–∞—Ü–∏—è –≤ Dead Letter Queue (DLQ) –¥–ª—è —Ä—É—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–¥–º–∏–Ω–æ–º
  * –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ `REQUIRES_MANUAL_REVIEW`
  * –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É —á–µ—Ä–µ–∑ Telegram —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–æ–±–ª–µ–º—ã
  * —Å—Ä–µ–¥—Å—Ç–≤–∞ –æ—Å—Ç–∞—é—Ç—Å—è –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–æ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã

#### R7-5: –û–±—Ä–∞–±–æ—Ç–∫–∞ blockchain node –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

* –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ BSC node –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è timeout, connection error, –∏–ª–∏ HTTP 5xx
* `BlockchainService.execute_with_failover()`:
  * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π RPC endpoint –∏–∑ —Å–ø–∏—Å–∫–∞ fallback —É–∑–ª–æ–≤
  * –ø—Ä–æ–±—É–µ—Ç –¥–æ 3 —Ä–∞–∑–Ω—ã—Ö —É–∑–ª–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
* –ï—Å–ª–∏ –≤—Å–µ —É–∑–ª—ã –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã:
  * –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤/–≤—ã–≤–æ–¥–æ–≤
  * —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ `blockchain_maintenance_mode=True`
  * –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º –∞–¥–º–∏–Ω–∞–º –æ –ø—Ä–æ–±–ª–µ–º–µ —Å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–ø–µ—Ä–∞—Ü–∏–π: "–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 10-15 –º–∏–Ω—É—Ç"
* –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ `node_health_monitor`:
  * –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –ø—ã—Ç–∞–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–æ –≤—Å–µ–º–∏ —É–∑–ª–∞–º–∏
  * –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `eth_blockNumber` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
  * –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ ‚Äî —Å–Ω—è—Ç–∏–µ maintenance mode –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤
* –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ health check —Å–∏—Å—Ç–µ–º—É

#### R7-6: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ "–∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö" —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

* –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ `stuck_transaction_monitor` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
* –í—ã–±–∏—Ä–∞–µ—Ç withdrawal transactions –≤ —Å—Ç–∞—Ç—É—Å–µ `PROCESSING` —Å—Ç–∞—Ä—à–µ 15 –º–∏–Ω—É—Ç
* –î–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ —á–µ—Ä–µ–∑ `eth_getTransactionReceipt`:
  * **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è pending (–≤ mempool)**:
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ gas price –≤ —Å–µ—Ç–∏
    * –µ—Å–ª–∏ –Ω–∞—à gas price < —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π ‚Üí speed-up —á–µ—Ä–µ–∑ replacement transaction —Å higher gas
    * –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–π tx —Å —Ç–µ–º –∂–µ nonce, –Ω–æ —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º gas –Ω–∞ 20%
  * **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è failed (reverted)**:
    * –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω—ã revert –∏–∑ receipt
    * –ø–æ–º–µ—Ç–∫–∞ withdrawal –∫–∞–∫ `FAILED`
    * –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `UserService.adjust_balance()`
    * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –∞–¥–º–∏–Ω—É –æ –ø—Ä–∏—á–∏–Ω–µ –æ—Ç–∫–∞–∑–∞
  * **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è dropped (nonce –ø—Ä–æ–ø—É—â–µ–Ω)**:
    * –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º nonce
    * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `eth_getTransactionCount` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ nonce
* –í—Å–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª—è—é—Ç—Å—è –∞–¥–º–∏–Ω–∞–º –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –∏ –∞—É–¥–∏—Ç–∞
* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –º–µ—Ç—Ä–∏–∫–∞: –µ—Å–ª–∏ >3 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞—Å—Ç—Ä—è–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Üí –∞–ª–µ—Ä—Ç –æ —Å–∏—Å—Ç–µ–º–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–µ

---

## 8. R8 ‚Äî –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

### 8.1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏

#### R8-1: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (Telegram API rate limits)

* –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é Telegram API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 429 (Too Many Requests)
* `NotificationService.send_notification()`:
  * –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç TelegramAPIError —Å –∫–æ–¥–æ–º 429
  * –ø–æ–º–µ—â–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Redis queue –¥–ª—è retry —Å —Ç–∏–ø–æ–º –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
  * –∏–∑–≤–ª–µ–∫–∞–µ—Ç `retry_after` –∏–∑ –æ—Ç–≤–µ—Ç–∞ API (–æ–±—ã—á–Ω–æ 30-60 —Å–µ–∫—É–Ω–¥)
* Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å exponential backoff:
  * –ø–æ–ø—ã—Ç–∫–∞ 1: —á–µ—Ä–µ–∑ `retry_after` —Å–µ–∫—É–Ω–¥ (–∏–∑ API)
  * –ø–æ–ø—ã—Ç–∫–∞ 2: —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã
  * –ø–æ–ø—ã—Ç–∫–∞ 3: —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç
  * –ø–æ–ø—ã—Ç–∫–∞ 4: —á–µ—Ä–µ–∑ 1 —á–∞—Å
  * –ø–æ–ø—ã—Ç–∫–∞ 5: —á–µ—Ä–µ–∑ 4 —á–∞—Å–∞
* –ü–æ—Å–ª–µ –≤—Å–µ—Ö –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫:
  * –ø–æ–º–µ—Ç–∫–∞ –≤ `notification_log` –∫–∞–∫ `status=FAILED`
  * –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≤—ã–≤–æ–¥ –æ–¥–æ–±—Ä–µ–Ω, –¥–µ–ø–æ–∑–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞):
    * —ç—Å–∫–∞–ª–∞—Ü–∏—è –≤ Dead Letter Queue
    * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º –æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
    * –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–π –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
  * –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö (–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏):
    * –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ failed –±–µ–∑ —ç—Å–∫–∞–ª–∞—Ü–∏–∏
* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ failed notifications –≤ –¥–∞—à–±–æ—Ä–¥–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–±–ª–µ–º —Å API

#### R8-2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –±–æ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ —á–µ—Ä–µ–∑ Telegram (bot blocked by user)
* –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ–º Telegram error 403 "Forbidden: bot was blocked by the user"
* `NotificationService`:
  * –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
  * —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ `bot_blocked=True` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
  * —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `bot_blocked_at=NOW()`
  * –æ—Ç–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –¥–∞–ª—å–Ω–µ–π—à–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —ç—Ç–æ–º—É —é–∑–µ—Ä—É (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π)
  * –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ `user_activity_log`
* –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –±–æ—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç `/start` –∏–ª–∏ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
  * –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–ª–∞–≥ `bot_blocked=True`
  * —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ `bot_blocked=False`, `bot_blocked_at=NULL`
  * –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  * –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –≤–∞–∂–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  * –µ—Å–ª–∏ –µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ) ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–≤–æ–¥–∫–∏ "–ü–æ–∫–∞ –≤–∞—Å –Ω–µ –±—ã–ª–æ..."
* –ú–µ—Ç—Ä–∏–∫–∞: –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å `bot_blocked=True` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç—Ç–æ–∫–∞

#### R8-3: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ

* –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –Ω–∞ —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ + –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ ROI –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è)
* –û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (Redis sorted set) —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É + timestamp:
  * **P0 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ, score=1000)**: 
    * —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: –¥–µ–ø–æ–∑–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω, –≤—ã–≤–æ–¥ –æ–¥–æ–±—Ä–µ–Ω/–æ—Ç–∫–ª–æ–Ω—ë–Ω
    * –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
    * –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—è
  * **P1 (–≤—ã—Å–æ–∫–∏–µ, score=500)**:
    * –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ ROI –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
    * —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∑–∞—Ä–∞–±–æ—Ç–∫–∏
    * –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–±–∞–Ω, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–º)
  * **P2 (–Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ, score=100)**:
    * –æ—Ç–≤–µ—Ç—ã —Å–ª—É–∂–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    * –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫/–ø—Ä–æ—Ñ–∏–ª—è
    * –∞–ø–µ–ª–ª—è—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
  * **P3 (–Ω–∏–∑–∫–∏–µ, score=10)**:
    * –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏
    * –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    * –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
* Worker –ø—Ä–æ—Ü–µ—Å—Å `notification_dispatcher`:
  * –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
  * —Å–æ–±–ª—é–¥–∞–µ—Ç rate limit: 30 msg/sec (Telegram Bot API limit)
  * –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞:
    * P0-P1 –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
    * P2 –æ—Ç–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –Ω–∞ 5-15 –º–∏–Ω—É—Ç
    * P3 –º–æ–≥—É—Ç –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å—Å—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤
* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
* –ê–ª–µ—Ä—Ç –∞–¥–º–∏–Ω–∞–º –µ—Å–ª–∏ P0 –æ—á–µ—Ä–µ–¥—å > 100 —Å–æ–æ–±—â–µ–Ω–∏–π

---

## 9. R9 ‚Äî –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ race conditions

### 9.1. –ó–∞—â–∏—Ç–∞ –æ—Ç double spending

#### R9-1: –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ (double spending protection)

* –°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏/–æ—à–∏–±–∫–∏:
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã—Å—Ç—Ä–æ –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–í—ã–≤–µ—Å—Ç–∏ –≤—Å—é —Å—É–º–º—É" –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥
  * –∏–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ –≤ –¥–≤—É—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö/–±—Ä–∞—É–∑–µ—Ä–∞—Ö –∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –≤—ã–≤–æ–¥
  * –∏–ª–∏ —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä—É–µ—Ç race condition –≤ API
* –ó–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ database-level locks –≤ `WithdrawalService.create_withdrawal()`:
  * `SELECT * FROM users WHERE id = :user_id FOR UPDATE` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏ —é–∑–µ—Ä–∞
  * –∞—Ç–æ–º–∞—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: `available_balance >= withdrawal_amount`
  * –ø–µ—Ä–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ:
    * —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ `withdrawals`
    * —É–º–µ–Ω—å—à–∞–µ—Ç `available_balance` —á–µ—Ä–µ–∑ `UserService.adjust_balance()`
    * –∫–æ–º–º–∏—Ç–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
  * –≤—Ç–æ—Ä–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:
    * –∂–¥—ë—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è lock
    * –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –≤–∏–¥–∏—Ç —É–∂–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ `available_balance >= withdrawal_amount` ‚Üí False
    * –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É `insufficient funds`
    * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞"
* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ FSM state:
  * –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–≤–æ–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `WithdrawalStates.entering_amount` –∏–ª–∏ `processing`
  * –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –Ω–∞—á–∞—Ç—å –≤—ã–≤–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏–π state
  * –µ—Å–ª–∏ —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–≤–æ–¥–∞ ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥"
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö concurrent withdrawal attempts –≤ `security_log` –¥–ª—è:
  * –∞—É–¥–∏—Ç–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
  * –≤—ã—è–≤–ª–µ–Ω–∏—è abuse/attack patterns
  * –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ temporary ban –ø—Ä–∏ —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö

#### R9-2: Race condition –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ ROI –∏ –≤—ã–≤–æ–¥–µ

* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
  * —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç mass ROI distribution –≤ 00:00 UTC
  * –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ timezone –¥—Ä—É–≥–æ–π —Å—Ç—Ä–∞–Ω—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—ã–≤–æ–¥ –≤—Å–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
  * –ø—Ä–æ–±–ª–µ–º–∞: –±–∞–ª–∞–Ω—Å –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –¥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è ROI, –Ω–æ withdrawal —Å–æ–∑–¥–∞–Ω –ø–æ—Å–ª–µ
  * —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–≤–æ–¥–∏—Ç –º–µ–Ω—å—à–µ, —á–µ–º –¥–æ–ª–∂–µ–Ω –±—ã–ª
* –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ transaction isolation level:
  * –æ–±–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (ROI distribution –∏ withdrawal creation) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö —Å `REPEATABLE READ` –∏–ª–∏ `SERIALIZABLE` isolation
  * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ pessimistic locking:
    * `SELECT * FROM users WHERE id = :user_id FOR UPDATE NOWAIT`
    * –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è
  * –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –≤ withdrawal service:
    * –æ—Ç–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    * –∑–∞–¥–µ—Ä–∂–∫–∞ 1-2 —Å–µ–∫—É–Ω–¥—ã (random jitter –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è thundering herd)
    * –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Å —É—á—ë—Ç–æ–º —Ç–æ–ª—å–∫–æ —á—Ç–æ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ ROI
* –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–∏–æ–¥–æ–≤:
  * –≤—Ä–µ–º–µ–Ω–Ω–∞—è "–º—è–≥–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞" –≤—ã–≤–æ–¥–æ–≤ –Ω–∞ –≤—Ä–µ–º—è mass ROI distribution (00:00-00:05)
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è: "–ò–¥—ë—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É"
  * —ç—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç race conditions –∏ —É–ø—Ä–æ—â–∞–µ—Ç –ª–æ–≥–∏–∫—É
* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
  * –º–µ—Ç—Ä–∏–∫–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ serialization failures
  * –∞–ª–µ—Ä—Ç –µ—Å–ª–∏ > 10 –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤ –º–∏–Ω—É—Ç—É

#### R9-3: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞ blockchain monitor'–æ–º

* –°—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–∏ horizontal scaling:
  * –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ blockchain monitor service –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å–∫–∞–Ω–∏—Ä—É—é—Ç –±–ª–æ–∫—á–µ–π–Ω
  * –≤—Å–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç –æ–¥–Ω—É –∏ —Ç—É –∂–µ –Ω–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –¥–µ–ø–æ–∑–∏—Ç–∞
  * —Ä–∏—Å–∫–∏:
    * –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞ –±–∞–ª–∞–Ω—Å (2x, 3x –æ—Ç —Å—É–º–º—ã –¥–µ–ø–æ–∑–∏—Ç–∞)
    * –¥–≤–æ–π–Ω–æ–µ/—Ç—Ä–æ–π–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤
    * –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–æ—Ç–µ—Ä—è –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
* –ó–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ distributed lock (Redis):
  * –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–ø–æ–∑–∏—Ç–∞:
    * –ø–æ–ø—ã—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å lock: `SET processing:deposit:{tx_hash} {worker_id} NX EX 60`
    * `NX` - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    * `EX 60` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥ (–∑–∞—â–∏—Ç–∞ –æ—Ç deadlock)
  * —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω worker –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–∞–µ—Ç lock ‚Üí –æ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç
  * –æ—Å—Ç–∞–ª—å–Ω—ã–µ worker'—ã –≤–∏–¥—è—Ç, —á—Ç–æ lock —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Üí skip —ç—Ç–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  * –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ worker —É–¥–∞–ª—è–µ—Ç lock: `DEL processing:deposit:{tx_hash}`
* Database-level protection –∫–∞–∫ fallback:
  * —É–Ω–∏–∫–∞–ª—å–Ω—ã–π constraint `UNIQUE(blockchain_tx_hash)` –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `deposits`
  * –µ—Å–ª–∏ –¥–≤–∞ worker'–∞ –∫–∞–∫–∏–º-—Ç–æ –æ–±—Ä–∞–∑–æ–º –ø—Ä–æ—à–ª–∏ Redis lock:
    * –ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î
    * –≤—Ç–æ—Ä–æ–π –ø–æ–ª—É—á–∞–µ—Ç `IntegrityError` / `UniqueViolation`
    * graceful handling –∏—Å–∫–ª—é—á–µ–Ω–∏—è –±–µ–∑ –∫—Ä–∞—à–∞
* Idempotency –≤ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è—Ö:
  * –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º `referral_earning`:
    * –ø—Ä–æ–≤–µ—Ä–∫–∞: `SELECT * FROM referral_earnings WHERE deposit_id = :deposit_id AND referrer_id = :referrer_id`
    * –µ—Å–ª–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí skip –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
  * –∏–ª–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π constraint `UNIQUE(deposit_id, referrer_id, referral_level)`
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
  * –∫–∞–∂–¥—ã–π —Å–ª—É—á–∞–π "lock already exists" –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ INFO
  * –∫–∞–∂–¥—ã–π —Å–ª—É—á–∞–π `UniqueViolation` –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ WARNING —Å –∞–ª–µ—Ä—Ç–æ–º
  * –º–µ—Ç—Ä–∏–∫–∞: –µ—Å–ª–∏ >5 UniqueViolation –≤ –º–∏–Ω—É—Ç—É ‚Üí –≤–æ–∑–º–æ–∂–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å Redis locks

---

## 10. R10 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞—É–¥–∏—Ç

### 10.1. Fraud detection

#### R10-1: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (fraud detection)

* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
  * –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ wallet address pattern (–ø–æ—Ö–æ–∂–∏–µ –∞–¥—Ä–µ—Å–∞)
  * —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö/–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö email —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
  * –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:
    * –≤—Å–µ —Ä–µ—Ñ–µ—Ä–∞–ª—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∑–∞ 1 –¥–µ–Ω—å
    * –≤—Å–µ —Ä–µ—Ñ–µ—Ä–∞–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–æ—Ö–æ–∂–∏–µ username –ø–∞—Ç—Ç–µ—Ä–Ω—ã
    * —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–Ω–µ—Ç –¥–µ–ø–æ–∑–∏—Ç–æ–≤)
  * –ø–æ–ø—ã—Ç–∫–∏ –≤—ã–≤–æ–¥–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞ –±–µ–∑ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è ROI
  * –ø–∞—Ç—Ç–µ—Ä–Ω "deposit confirmed ‚Üí immediate maximum withdrawal attempt –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞"
  * –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–≤–æ–¥–∞ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—è (>5 –∑–∞ 10 –º–∏–Ω—É—Ç)
  * –∞–Ω–æ–º–∞–ª—å–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π (>20 –¥–µ–π—Å—Ç–≤–∏–π –≤ –º–∏–Ω—É—Ç—É)
* `FraudDetectionService` –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
  * –ø–æ–¥—Å—á—ë—Ç risk score –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ (0-100)
  * —Ñ–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞:
    * –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç (<24 —á–∞—Å–∞) —Å –∫—Ä—É–ø–Ω—ã–º –¥–µ–ø–æ–∑–∏—Ç–æ–º (+20 points)
    * –Ω–µ—Ç email/—Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö (+10 points)
    * –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (+30 points)
    * –±—ã—Å—Ç—Ä—ã–π –≤—ã–≤–æ–¥ –ø–æ—Å–ª–µ –¥–µ–ø–æ–∑–∏—Ç–∞ (+25 points)
    * –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ñ–∏–Ω–ø–∞—Ä–æ–ª–∏ (+15 points)
  * –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ (risk_score > 80):
    * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–º–µ—Ç–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –∫–∞–∫ `suspicious=True` –≤ –ë–î
    * –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—ã–≤–æ–¥–æ–≤ –¥–æ —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–æ–º (`withdrawal_blocked=True`)
    * —Å–æ–∑–¥–∞–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º breakdown risk score
    * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ—Ö extended_admin –∏ super_admin
* –ê–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç:
  * timeline –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  * —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (–ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º, –ø–æ—Ö–æ–∂–∏–º wallet addresses)
  * evidence –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–∫—Ç–æ—Ä–∞ —Ä–∏—Å–∫–∞
  * —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: review/unblock –∏–ª–∏ ban
* –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç:
  * —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`suspicious=False, withdrawal_blocked=False`)
  * –∑–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é
  * –∑–∞–±–∞–Ω–∏—Ç—å —á–µ—Ä–µ–∑ blacklist

#### R10-2: –ê—É–¥–∏—Ç –≤—Å–µ—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏ reconciliation

* –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ `financial_reconciliation` –≤ 01:00 UTC (–ø–æ—Å–ª–µ ROI distribution)
* –°–≤–µ—Ä–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ñ–æ—Ä–º—É–ª–µ:
  ```
  Total System Balance = 
    SUM(confirmed_deposits) 
    - SUM(confirmed_withdrawals) 
    - SUM(paid_referral_earnings)
  
  Should Equal:
    SUM(users.available_balance) 
    + SUM(users.pending_balance) 
    + SUM(pending_withdrawals.amount)
  ```
* –î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
  * —Å—É–º–º–∞ –≤—Å–µ—Ö `deposits.amount` WHERE `status=CONFIRMED` 
  * –º–∏–Ω—É—Å —Å—É–º–º–∞ –≤—Å–µ—Ö `withdrawals.amount` WHERE `status=CONFIRMED`
  * –º–∏–Ω—É—Å —Å—É–º–º–∞ –≤—Å–µ—Ö `referral_earnings.amount` WHERE `is_paid=True`
  * —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–≤–Ω—è—Ç—å—Å—è —Å—É–º–º–µ –≤—Å–µ—Ö –±–∞–ª–∞–Ω—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π + pending –æ–ø–µ—Ä–∞—Ü–∏–∏
* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π:
  * –¥–ª—è –∫–∞–∂–¥–æ–≥–æ confirmed deposit –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ referral_earnings
  * —Å—É–º–º–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞ = 3% + 2% + 5% = 10% –æ—Ç —Å—É–º–º—ã –¥–µ–ø–æ–∑–∏—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å 3 —É—Ä–æ–≤–Ω—è)
  * –Ω–µ—Ç "—Å–∏—Ä–æ—Ç" earnings –±–µ–∑ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
* –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è (discrepancy > 0.01 USDT):
  * **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–µ—Ä—Ç** –≤—Å–µ–º super_admin —á–µ—Ä–µ–∑ Telegram
  * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è **–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö –≤—ã–≤–æ–¥–æ–≤** (`system_maintenance_mode=True`)
  * —Å–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ `reconciliation_report`:
    * snapshot –≤—Å–µ—Ö –±–∞–ª–∞–Ω—Å–æ–≤ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
    * breakdown –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–∏–ø—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    * —Å–ø–∏—Å–æ–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
    * diff –º–µ–∂–¥—É expected –∏ actual –±–∞–ª–∞–Ω—Å–∞–º–∏
  * –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `audit_log` —Å `severity=CRITICAL`
  * email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–æ—á—Ç—É (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
* –•—Ä–∞–Ω–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö snapshots:
  * —Ç–∞–±–ª–∏—Ü–∞ `daily_balance_snapshots`: –¥–∞—Ç–∞, total_deposits, total_withdrawals, total_user_balances
  * –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∫–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ –ø–æ—è–≤–∏–ª–æ—Å—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ
  * –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º

#### R10-3: –ó–∞—â–∏—Ç–∞ –æ—Ç admin account compromise

* –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π:
  * –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥:
    * >10 ban –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –º–∏–Ω—É—Ç—É
    * >50 –æ–¥–æ–±—Ä–µ–Ω–∏–π –≤—ã–≤–æ–¥–æ–≤ –∑–∞ –º–∏–Ω—É—Ç—É
    * >20 –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ blacklist –∑–∞ –º–∏–Ω—É—Ç—É
  * –ø–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö super_admin'–æ–≤
  * –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã:
    * deposit level —Å—É–º–º—ã –∏–ª–∏ –ª–∏–º–∏—Ç—ã
    * —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏
    * system wallet addresses
  * —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ super_admin –∞–∫–∫–∞—É–Ω—Ç–∞
  * –ø–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ wallet management –±–µ–∑ extended –ø—Ä–∞–≤
* –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `AdminActivityMonitor`:
  * **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**:
    * —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π logout —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
    * –∑–∞–ø—Ä–æ—Å master key –∑–∞–Ω–æ–≤–æ
    * challenge-response –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ª–µ–≥–∏—Ç–∏–º–Ω–æ—Å—Ç–∏
  * **—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö super_admin —á–µ—Ä–µ–∑ Telegram**:
    * "‚ö†Ô∏è SECURITY ALERT: Admin @username —Å–æ–≤–µ—Ä—à–∞–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏"
    * –¥–µ—Ç–∞–ª–∏: —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–π, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–µ—Ä–∏–æ–¥
    * –∫–Ω–æ–ø–∫–∏: "Confirm Legitimate" / "Emergency Block Admin"
  * **–≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** –Ω–∞ 5-10 –º–∏–Ω—É—Ç:
    * –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å –∞–¥–º–∏–Ω–æ–≤
    * –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å system settings
    * –Ω–µ–ª—å–∑—è –æ–¥–æ–±—Ä—è—Ç—å –≤—ã–≤–æ–¥—ã >$1000
    * –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
  * **–¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ `admin_actions`:
    * –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
    * timestamp —Å –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞–º–∏
    * session_id –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
    * –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ (JSON)
* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ä—ã:
  * Rate limiting –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
    * max 5 ban/unban –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –º–∏–Ω—É—Ç—É
    * max 20 withdrawal approvals –≤ –º–∏–Ω—É—Ç—É
    * cooldown 30 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
  * –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ (reason) –¥–ª—è:
    * ban/terminate –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (minimum 20 —Å–∏–º–≤–æ–ª–æ–≤)
    * rejection withdrawal requests
    * —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞
  * Audit trail:
    * –∫–∞–∂–¥–æ–µ admin –¥–µ–π—Å—Ç–≤–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é rollback
    * "–∫—Ç–æ, —á—Ç–æ, –∫–æ–≥–¥–∞, –ø–æ—á–µ–º—É" –¥–ª—è compliance
* –°–∏—Å—Ç–µ–º–∞ 2FA –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è production):
  * –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ super_admin
  * –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ wallet keys/seeds
  * –ø—Ä–∏ –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö (>10 –∑–∞ —Ä–∞–∑)
  * –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: integration —Å authenticator apps

---

## 11. R11 ‚Äî –°–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ disaster recovery

### 11.1. Database failures

#### R11-1: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è PostgreSQL

* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π: PostgreSQL —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
  * server crash –∏–ª–∏ restart
  * network partition –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –ë–î
  * planned maintenance –±–µ–∑ proper notification
  * disk full –Ω–∞ –ë–î —Å–µ—Ä–≤–µ—Ä–µ
* –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –Ω–∞—á–∏–Ω–∞—é—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å connection errors, timeouts, –∏–ª–∏ refused connections
* –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ `DatabaseMiddleware` –∏ exception handlers:
  * –ø–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ—Ö DB exceptions: `OperationalError`, `InterfaceError`, `DatabaseError`
  * graceful response –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:
    * "‚ö†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, —Å–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
    * "–í–∞—à–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
    * "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 5-10 –º–∏–Ω—É—Ç"
  * –≤—Å–µ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è:
    * `roi_distribution_job` ‚Üí pause —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º checkpoint
    * `blockchain_monitor` ‚Üí graceful shutdown —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º last processed block
    * `withdrawal_processor` ‚Üí pause, pending withdrawals –æ—Å—Ç–∞—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏
  * –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Redis –∫–∞–∫ temporary fallback:
    * pending withdrawal requests —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
    * –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã —Å expected amounts
    * user FSM states –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–π
  * health check endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `503 Service Unavailable` —Å details
  * –∞–ª–µ—Ä—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è:
    * –≤—Å–µ–º super_admin —á–µ—Ä–µ–∑ Telegram: "üö® CRITICAL: PostgreSQL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
    * –≤ monitoring —Å–∏—Å—Ç–µ–º—É (Prometheus/Grafana –µ—Å–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞)
    * email –Ω–∞ tech team (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
  * –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î —á–µ—Ä–µ–∑ `SELECT 1`
  * exponential backoff –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
  * max 50 –ø–æ–ø—ã—Ç–æ–∫ –∑–∞ 30 –º–∏–Ω—É—Ç
* –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ PostgreSQL:
  * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏:
    * `PRAGMA integrity_check` –∏–ª–∏ PostgreSQL equivalent
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö critical tables –Ω–∞ corruption
    * –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  * –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑ Redis fallback:
    * pending withdrawals –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ –ë–î
    * user states –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Å–µ—Å—Å–∏–π
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
  * –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ (circuit breaker pattern):
    * **—Ñ–∞–∑–∞ 1 (0-5 –º–∏–Ω)**: read-only —Ä–µ–∂–∏–º, —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
    * **—Ñ–∞–∑–∞ 2 (5-15 –º–∏–Ω)**: —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–µ–ø–æ–∑–∏—Ç—ã, –≤—ã–≤–æ–¥—ã)
    * **—Ñ–∞–∑–∞ 3 (15+ –º–∏–Ω)**: full operations, –≤–∫–ª—é—á–∞—è —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
  * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: "‚úÖ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
  * post-mortem –æ—Ç—á—ë—Ç –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ —Å –¥–µ—Ç–∞–ª—è–º–∏ outage

#### R11-2: –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏–π —Å–±–æ–π blockchain node + –≤—Å–µ fallbacks

* Worst-case —Å—Ü–µ–Ω–∞—Ä–∏–π: –≤—Å–µ RPC endpoints –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
  * DDoS –∞—Ç–∞–∫–∞ –Ω–∞ Binance Smart Chain
  * –≥–ª–æ–±–∞–ª—å–Ω—ã–π network outage –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
  * chain halt –∏–ª–∏ consensus failure
  * –≤—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ RPC nodes down
* –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å blockchain –æ–ø–µ—Ä–∞—Ü–∏–∏:
  * –Ω–µ –º–æ–∂–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤—Ö–æ–¥—è—â–∏–µ –¥–µ–ø–æ–∑–∏—Ç—ã
  * –Ω–µ –º–æ–∂–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å USDT withdrawals
  * –Ω–µ –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å –±–∞–ª–∞–Ω—Å—ã —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
  * –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π gas price
* –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ "Limited Operations Mode":
  * —Ñ–ª–∞–≥ `blockchain_maintenance_mode=True` –≤ system config
  * **–≤—Å–µ –Ω–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    * —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING_NETWORK_RECOVERY`
    * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ: "–î–µ–ø–æ–∑–∏—Ç –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ç–∏ BSC"
    * –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ (–∞–¥—Ä–µ—Å, —Å—É–º–º–∞)
    * —Ö—Ä–∞–Ω–∏–º expected_amount –∏ user_id –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
  * **–≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—ã–≤–æ–¥–∞** –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è:
    * –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–í—ã–≤–æ–¥": 
    * "‚ö†Ô∏è –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã–≤–æ–¥–æ–≤ –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Ç—å—é Binance Smart Chain"
    * "–í–∞—à–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –≤—ã–≤–æ–¥—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
    * "–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –≤ –Ω–∞—à–µ–º –∫–∞–Ω–∞–ª–µ"
  * **read-only –æ–ø–µ—Ä–∞—Ü–∏–∏** –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:
    * –ø—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞ (–∏–∑ –ë–î)
    * –ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    * –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    * –≤—Å–µ –º–µ–Ω—é –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
  * **ROI –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è** –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è:
    * –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π job –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
    * –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ë–î
    * –±–µ–∑ blockchain operations
    * –ø–æ–º–µ—á–∞—é—Ç—Å—è —Ñ–ª–∞–≥–æ–º `blockchain_pending=True` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
* Recovery plan –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ç–∏:
  * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
    * `node_health_monitor` –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å RPC
    * –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö endpoints
    * –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `eth_blockNumber` –∏ `eth_syncing`
  * **batch processing** –≤—Å–µ—Ö pending –¥–µ–ø–æ–∑–∏—Ç–æ–≤:
    * —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ deposits —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING_NETWORK_RECOVERY`
    * –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞–µ–º `searchBlockchainForDeposit()`
    * –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (pool of workers) —Å rate limiting
    * found ‚Üí CONFIRMED, not found ‚Üí –æ—Å—Ç–∞—ë—Ç—Å—è PENDING —Å –Ω–æ–≤—ã–º timeout
  * **—Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö withdrawals**:
    * –∞–¥–º–∏–Ω—ã –ø–æ–ª—É—á–∞—é—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö withdrawal requests –∑–∞ –ø–µ—Ä–∏–æ–¥ outage
    * –¥–µ—Ç–∞–ª—å–Ω—ã–π review –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤—ã–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º (fraud check)
    * batch approval —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
    * –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ —Å—É–º–º–µ: –º–µ–ª–∫–∏–µ (<$100) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫—Ä—É–ø–Ω—ã–µ –≤—Ä—É—á–Ω—É—é
  * **reconciliation** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥ outage:
    * –ø–æ–ª–Ω–∞—è —Å–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–æ–≤ –¥–æ –∏ –ø–æ—Å–ª–µ
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö ROI –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –∑–∞ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –¥–Ω–∏
    * –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Å–µ—Ö —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
    * detailed audit report –¥–ª—è compliance
* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:
  * –ø—Ä–∏ –Ω–∞—á–∞–ª–µ outage: —Ä–∞—Å—Å—ã–ª–∫–∞ "‚ö†Ô∏è –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å BSC —Å–µ—Ç—å—é"
  * –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏: "‚úÖ –°–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –∑–∞–ø—É—â–µ–Ω–∞"
  * –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞

#### R11-3: Redis –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (cache + sessions + locks –ø–æ—Ç–µ—Ä—è–Ω—ã)

* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π: Redis server crash –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
* –ü–æ—Ç–µ—Ä—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Redis:
  * **distributed locks** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è duplicate processing
  * **–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: user profiles, deposit levels, system settings
  * **notification queue** —Å pending —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
  * **rate limiting counters** (registration, withdrawal, admin operations)
  * **FSM states** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–µ–∫—É—â–∏–µ wizard steps)
  * **admin sessions** (—Ç—Ä–µ–±—É–µ—Ç—Å—è re-authentication)
* Graceful degradation - —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ Redis:
  * **fallback –Ω–∞ PostgreSQL advisory locks**:
    * `pg_try_advisory_lock()` –≤–º–µ—Å—Ç–æ Redis SETNX
    * –º–µ–¥–ª–µ–Ω–Ω–µ–µ (DB roundtrip), –Ω–æ –Ω–∞–¥—ë–∂–Ω–æ
    * —Ä–∏—Å–∫: higher DB load, –Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç duplicate processing
  * **FSM states –≤ PostgreSQL**:
    * –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `user_fsm_states` —Å columns: user_id, state, data
    * –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ state –ø–∏—à–µ—Ç—Å—è –≤ –ë–î
    * –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ update –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π state –∏–∑ –ë–î
    * overhead: +1 DB query –Ω–∞ –∫–∞–∂–¥—ã–π handler, –Ω–æ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
  * **rate limiting —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–º**:
    * –≤–º–µ—Å—Ç–æ global counter (Redis) –∏—Å–ø–æ–ª—å–∑—É–µ–º per-process counters (memory)
    * –º–µ–Ω–µ–µ —Ç–æ—á–Ω–æ, –Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ abuse
    * –Ω–∞–ø—Ä–∏–º–µ—Ä: 100 registrations/hour globally ‚Üí ~10-20/hour per process
  * **notification queue –Ω–∞ PostgreSQL**:
    * —Ç–∞–±–ª–∏—Ü–∞ `notification_queue_fallback`
    * worker –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ª–∞–µ—Ç polling –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ Redis pub/sub
    * –º–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–æ—Å—Ç–∞–≤–∫–∞ (–∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 5 —Å–µ–∫), –Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è
  * **–∫—ç—à –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç**:
    * –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ PostgreSQL
    * –Ω–µ—Ç cache hit ‚Üí –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–¥—ë—Ç –≤ –ë–î
    * –∏—Å–ø–æ–ª—å–∑—É–µ–º aggressive DB connection pooling
    * –≤–∫–ª—é—á–∞–µ–º query result caching –Ω–∞ —É—Ä–æ–≤–Ω–µ SQLAlchemy (short TTL)
* Performance impact –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –±–µ–∑ Redis:
  * —É–≤–µ–ª–∏—á–µ–Ω–∏–µ latency –æ–ø–µ—Ä–∞—Ü–∏–π: 2-5x (–æ—Ç ~50ms –¥–æ ~200ms)
  * —Å–Ω–∏–∂–µ–Ω–∏–µ throughput: 50-70% (–º–µ–Ω—å—à–µ concurrent users)
  * —É–≤–µ–ª–∏—á–µ–Ω–∏–µ DB load: +200-300% queries per second
  * –Ω–æ —Å–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∏ –Ω–µ —Ç–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è Redis:
  * –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏: `PING` command
  * –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ health check –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º thread
  * –∞–ª–µ—Ä—Ç—ã –∞–¥–º–∏–Ω–∞–º –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
* –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ Redis:
  * –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –æ–±—Ä–∞—Ç–Ω–æ:
    * **–ø—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞** critical –¥–∞–Ω–Ω—ã—Ö:
      * –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö users –≤ Redis (–ø–æ —á–∞—Å—Ç—è–º, batch 1000)
      * –∑–∞–≥—Ä—É–∑–∫–∞ deposit_levels, system_settings
      * –ø—Ä–æ–≥—Ä–µ–≤ –∑–∞–Ω–∏–º–∞–µ—Ç 2-5 –º–∏–Ω—É—Ç –¥–ª—è 100k+ users
    * **–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ notification queue**:
      * –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ pending notifications –∏–∑ PostgreSQL fallback table –≤ Redis
      * —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ fallback –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
    * **–º–∏–≥—Ä–∞—Ü–∏—è FSM states**:
      * –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ active states –∏–∑ PostgreSQL –≤ Redis
      * cleanup —Å—Ç–∞—Ä—ã—Ö states (>24 —á–∞—Å–∞)
    * **–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ distributed locks**:
      * –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å PostgreSQL locks –Ω–∞ Redis
      * –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è conflicts
  * –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç gracefully:
    * dual-write –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥ (–ø–∏—à–µ–º –≤ –æ–±–∞ –º–µ—Å—Ç–∞)
    * –∑–∞—Ç–µ–º –æ—Ç–∫–ª—é—á–∞–µ–º PostgreSQL fallback
    * monitoring –º–µ—Ç—Ä–∏–∫ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
  * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤: "‚úÖ Redis –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å –∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"

---

## 12. R12 ‚Äî –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –∏ edge cases

### 12.1. Timing edge cases

#### R12-1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ—Å—Ç–∏–≥–∞–µ—Ç 500% ROI —Ä–æ–≤–Ω–æ –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è withdrawal

* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π race condition —Å—Ü–µ–Ω–∞—Ä–∏–π:
  * –¥–µ–ø–æ–∑–∏—Ç User A –Ω–∞ $100, —É–∂–µ –Ω–∞—á–∏—Å–ª–µ–Ω–æ $490 (490% ROI)
  * –≤ 00:00:00 UTC –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ ROI (+$10, –∏—Ç–æ–≥–æ 500%)
  * –≤ 00:00:01 UTC –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í—ã–≤–µ—Å—Ç–∏ –≤—Å—é —Å—É–º–º—É"
  * –≤ 00:00:02 ROI job –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç –¥–µ–ø–æ–∑–∏—Ç
* –ü—Ä–æ–±–ª–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä—ë—Ö –∞—Å–ø–µ–∫—Ç–æ–≤:
  * —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ ROI –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é
  * –¥–µ–ø–æ–∑–∏—Ç –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã—Ç—å—Å—è (`is_roi_completed=True`)
  * withdrawal –¥–æ–ª–∂–µ–Ω —É—á–∏—Ç—ã–≤–∞—Ç—å —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤ —Ä–∞—Å—á—ë—Ç–µ –±–∞–ª–∞–Ω—Å–∞
* –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ proper transaction ordering –∏ isolation:
  * **ROI distribution job**:
    * –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `SELECT * FROM users WHERE id IN (...) FOR UPDATE` –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    * –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏–ª–∏ –≤ –±–∞—Ç—á–∞—Ö
    * –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞ ‚Üí commit
  * **Withdrawal creation**:
    * —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `SELECT * FROM users WHERE id = :id FOR UPDATE`
    * —Ä–∞—Å—á—ë—Ç available_balance –≤–Ω—É—Ç—Ä–∏ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    * —Å–æ–∑–¥–∞–Ω–∏–µ withdrawal request ‚Üí –¥–µ–∫—Ä–µ–º–µ–Ω—Ç –±–∞–ª–∞–Ω—Å–∞ ‚Üí commit
  * **Serialization –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç**:
    * –∫—Ç–æ –ø–µ—Ä–≤—ã–π –∑–∞—Ö–≤–∞—Ç–∏–ª lock –Ω–∞ user record - —Ç–æ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
    * –≤—Ç–æ—Ä–æ–π –∂–¥—ë—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è lock
    * –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è lock –≤–∏–¥–∏—Ç —É–∂–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
* –í–æ–∑–º–æ–∂–Ω—ã–µ outcomes:
  * **ROI first**: –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ $10 ‚Üí –±–∞–ª–∞–Ω—Å $500 ‚Üí –∑–∞—Ç–µ–º withdrawal –Ω–∞ $500 ‚Üí —É—Å–ø–µ—Ö
  * **Withdrawal first**: –≤—ã–≤–æ–¥ –Ω–∞ $490 ‚Üí –±–∞–ª–∞–Ω—Å $0 ‚Üí –∑–∞—Ç–µ–º ROI —Ö–æ—á–µ—Ç –Ω–∞—á–∏—Å–ª–∏—Ç—å ‚Üí –¥–µ–ø–æ–∑–∏—Ç –ø–æ–º–µ—á–µ–Ω completed, –Ω–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏–¥—ë—Ç ‚Üí –±–∞–ª–∞–Ω—Å $10
* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ ROI job:
  * –ø–æ—Å–ª–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∞: `if total_earned >= deposit_amount * 5`
  * —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `is_roi_completed=True`, `completed_at=NOW()`
  * –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–µ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –ø–æ —ç—Ç–æ–º—É –¥–µ–ø–æ–∑–∏—Ç—É
* –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è E2E —Ç–µ—Å—Ç–æ–≤:
  * —Å–æ–∑–¥–∞—Ç—å –¥–µ–ø–æ–∑–∏—Ç $100
  * manually —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `total_earned = $490`
  * —Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ ROI job –∏ withdrawal request
  * –ø—Ä–æ–≤–µ—Ä–∏—Ç—å: –Ω–µ—Ç duplicate –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π, –Ω–µ—Ç –ø–æ—Ç–µ—Ä–∏ —Å—Ä–µ–¥—Å—Ç–≤, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞

#### R12-2: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ —Å —É–¥–∞–ª—ë–Ω–Ω—ã–º–∏/–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

* –°–ª–æ–∂–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Å —á–∞—Å—Ç–∏—á–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–æ–π:
  * **User A (active)** ‚Üí –ø—Ä–∏–≥–ª–∞—Å–∏–ª User B
  * **User B (blocked)** ‚Üí –ø—Ä–∏–≥–ª–∞—Å–∏–ª User C  
  * **User C (terminated)** ‚Üí –ø—Ä–∏–≥–ª–∞—Å–∏–ª User D
  * **User D (active)** ‚Üí –¥–µ–ª–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç $100
* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏:
  * –ö—Ç–æ –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è?
  * –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤ —Ü–µ–ø–æ—á–∫–µ?
  * –°—á–∏—Ç–∞—Ç—å –ª–∏ terminated –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ depth —Ä–∞—Å—á—ë—Ç–µ?
  * –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å gaps –≤ —Ü–µ–ø–æ—á–∫–µ?
* –í–∞—Ä–∏–∞–Ω—Ç—ã –±–∏–∑–Ω–µ—Å-–ø–æ–ª–∏—Ç–∏–∫–∏:
  * **–í–∞—Ä–∏–∞–Ω—Ç 1 (—Å—Ç—Ä–æ–≥–∏–π)**: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤—Å–µ—Ö non-active
    * User C terminated ‚Üí skip, –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ–º
    * User B blocked ‚Üí skip, –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ–º  
    * User A active ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –±–æ–Ω—É—Å –∑–∞ level 3 (–ø—Ä–æ—Ö–æ–¥ —á–µ—Ä–µ–∑ gaps)
    * –∏—Ç–æ–≥–æ: —Ç–æ–ª—å–∫–æ 5% –¥–ª—è User A, 0% –¥–ª—è B –∏ C
  * **–í–∞—Ä–∏–∞–Ω—Ç 2 (–º—è–≥–∫–∏–π)**: blocked –ø–æ–ª—É—á–∞—é—Ç, –Ω–æ –Ω–µ –º–æ–≥—É—Ç –≤—ã–≤–µ—Å—Ç–∏
    * User C terminated ‚Üí skip –ø–æ–ª–Ω–æ—Å—Ç—å—é
    * User B blocked ‚Üí –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏–¥—ë—Ç, –Ω–æ `earnings_blocked=True`
    * User A active ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –±–æ–Ω—É—Å –∑–∞ level 3
    * –∏—Ç–æ–≥–æ: 2% –¥–ª—è B (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω), 5% –¥–ª—è A
  * **–í–∞—Ä–∏–∞–Ω—Ç 3 (compromise)**: –Ω–∞—á–∏—Å–ª—è–µ–º –≤—Å–µ–º, –Ω–æ –ø–æ–º–µ—á–∞–µ–º
    * –≤—Å–µ –ø–æ–ª—É—á–∞—é—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞
    * blocked/terminated –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–º–µ—é—Ç —Ñ–ª–∞–≥ `cannot_withdraw=True`
    * –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å earnings –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `ReferralService.process_deposit_referral_earnings()`:
  * –ø–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ —á–µ—Ä–µ–∑ `get_referral_chain(user_id, depth=3)`
  * –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
    ```python
    if referrer.is_terminated:
        continue  # skip terminated –ø–æ–ª–Ω–æ—Å—Ç—å—é
    
    if referrer.is_blocked:
        # —Å–æ–≥–ª–∞—Å–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–µ
        if POLICY == "strict":
            continue
        elif POLICY == "soft":
            create_earning(blocked=True)
    ```
  * –æ–±—Ä–∞–±–æ—Ç–∫–∞ gaps: –µ—Å–ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω level 2, —Å—á–∏—Ç–∞–µ–º level 3 –æ—Ç level 1
* –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ:
  * –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –ø–æ–ª–∏—Ç–∏–∫–∏
  * –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `REFERRAL_POLICY = "soft"` –≤ config
  * unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π —Å—Ç–∞—Ç—É—Å–æ–≤
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ edge cases:
  * –∫–∞–∂–¥—ã–π —Å–ª—É—á–∞–π skipped referrer –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å –ø—Ä–∏—á–∏–Ω–æ–π
  * –º–µ—Ç—Ä–∏–∫–∏: —Å–∫–æ–ª—å–∫–æ earnings –ø—Ä–æ–ø—É—â–µ–Ω–æ –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
  * –∞—É–¥–∏—Ç –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–π –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –ø—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ

#### R12-3: –î–µ–ø–æ–∑–∏—Ç –Ω–∞ —Ç–æ—á–Ω–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É —Å —É—á—ë—Ç–æ–º gas fees

* –ì—Ä–∞–Ω–∏—á–Ω—ã–π —Å–ª—É—á–∞–π —Å blockchain fees –∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º:
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–æ–≤–Ω–æ $10.00 USDT –¥–ª—è Level 1
  * –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç transaction —Å amount = 10.000000 USDT (6 decimals)
  * blockchain –º–æ–∂–µ—Ç:
    * –æ–∫—Ä—É–≥–ª–∏—Ç—å –∏–∑-–∑–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ä–∞—Å—á—ë—Ç–æ–≤
    * –≤—ã—á–µ—Å—Ç—å tiny amount –∫–∞–∫ internal fee –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö bridges
    * precision loss –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ units
  * —Ä–µ–∞–ª—å–Ω–æ –Ω–∞ system wallet –ø—Ä–∏—Ö–æ–¥–∏—Ç: 9.999998 USDT
* –ü—Ä–æ–±–ª–µ–º–∞: —Å—Ç—Ä–æ–≥–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ `received == expected` –æ—Ç–∫–ª–æ–Ω–∏—Ç –¥–µ–ø–æ–∑–∏—Ç
* –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ tolerance-based comparison –≤ `BlockchainService.process_confirmed_deposit()`:
  * –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ acceptable tolerance:
    * –¥–ª—è –º–µ–ª–∫–∏—Ö —Å—É–º–º (<$100): ¬±$0.01 (1 —Ü–µ–Ω—Ç)
    * –¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö ($100-$1000): ¬±$0.10  
    * –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö (>$1000): ¬±$1.00
  * –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å tolerance:
    ```python
    expected = deposit.expected_amount
    tolerance = 0.01 if expected < 100 else (0.10 if expected < 1000 else 1.00)
    
    if abs(received - expected) <= tolerance:
        # Accept deposit
        actual_level = determine_level(received)
    elif received < (expected - tolerance):
        # Insufficient amount
        deposit.status = FAILED
        reason = "Insufficient amount received"
    elif received > (expected + tolerance):
        # Overpayment - accept and credit bonus
        actual_level = determine_level(received)
        bonus = received - expected
    ```
* –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤:
  * **–í –ø—Ä–µ–¥–µ–ª–∞—Ö tolerance** (9.99 - 10.01 –¥–ª—è $10):
    * –¥–µ–ø–æ–∑–∏—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –Ω–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π level
    * –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Å—É–º–º—ã level ($10)
    * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç —Ä–∞–∑–Ω–∏—Ü—ã
  * **–ú–µ–Ω—å—à–µ tolerance** (< 9.99):
    * —Å—Ç–∞—Ç—É—Å `FAILED` –∏–ª–∏ `PARTIAL`
    * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–ü–æ–ª—É—á–µ–Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤: $9.95 –≤–º–µ—Å—Ç–æ $10.00"
    * –æ–ø—Ü–∏–∏: –≤–µ—Ä–Ω—É—Ç—å (–º–∏–Ω—É—Å fees) –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–æ–ø–ª–∞—Ç–∏—Ç—å
  * **–ë–æ–ª—å—à–µ tolerance** (> 10.01):
    * –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–æ–ª–∏—Ç–∏–∫–∏:
      * **–≤–∞—Ä–∏–∞–Ω—Ç A**: –ø—Ä–∏–Ω—è—Ç—å –∫–∞–∫ –¥–µ–ø–æ–∑–∏—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–≥–æ level (–µ—Å–ª–∏ $20+)
      * **–≤–∞—Ä–∏–∞–Ω—Ç B**: –ø—Ä–∏–Ω—è—Ç—å level 1, –æ—Å—Ç–∞—Ç–æ–∫ = bonus –Ω–∞ –±–∞–ª–∞–Ω—Å
    * –ø—Ä–∏–º–µ—Ä: –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ $25 –≤–º–µ—Å—Ç–æ $10 ‚Üí –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ–º Level 2 ($20) + $5 –Ω–∞ –±–∞–ª–∞–Ω—Å
* Edge case: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª —Å—É–º–º—É –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏:
  * –æ—Ç–ø—Ä–∞–≤–∏–ª $15, –º–µ–∂–¥—É Level 1 ($10) –∏ Level 2 ($20)
  * –ª–æ–≥–∏–∫–∞: –ø—Ä–∏–Ω–∏–º–∞–µ–º –∫–∞–∫ Level 1, –æ—Å—Ç–∞—Ç–æ–∫ $5 –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–ª–∏ –∑–∞—á–∏—Å–ª—è–µ–º –Ω–∞ –±–∞–ª–∞–Ω—Å
  * –∏–ª–∏: –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –¥–æ–ø–ª–∞—Ç–∏—Ç—å –¥–æ Level 2
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö amount mismatches:
  * —Ç–∞–±–ª–∏—Ü–∞ `deposit_amount_discrepancies`
  * columns: deposit_id, expected, received, diff, resolution
  * —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –∞—É–¥–∏—Ç –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
  * –µ—Å–ª–∏ >10% –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –∏–º–µ—é—Ç discrepancy ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å instructions –∏–ª–∏ fees
* –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
  * —Ç–æ—á–Ω–∞—è —Å—É–º–º–∞: 10.000000
  * —á—É—Ç—å –º–µ–Ω—å—à–µ: 9.999998 (–≤ tolerance)
  * –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ: 9.95 (–≤–Ω–µ tolerance)
  * —á—É—Ç—å –±–æ–ª—å—à–µ: 10.000005 (–≤ tolerance)
  * –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–µ: 25.00 (upgrade level)
  * –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏: 15.00 (partial level)

---

## 13. R13 ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π UX –∏ –Ω–µ–æ–±—ã—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 13.1. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

#### R13-1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç –±–æ—Ç–∞ –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ

* –°—Ü–µ–Ω–∞—Ä–∏–π –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞:
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à—ë–ª –ø–æ–ª–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
  * –∏–º–µ–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –Ω–∞ $100 –∏ –±–∞–ª–∞–Ω—Å $50
  * —É–¥–∞–ª—è–µ—Ç –±–æ—Ç–∞ –∏–∑ Telegram (–¥–µ–π—Å—Ç–≤–∏–µ "Delete Chat" —Ç–æ–ª—å–∫–æ —Å–∫—Ä—ã–≤–∞–µ—Ç —á–∞—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –ù–ï —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ)
  * —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é –Ω–∞–∂–∏–º–∞–µ—Ç `/start` —Å–Ω–æ–≤–∞ –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ –Ω–æ–≤–æ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ –¥—Ä—É–≥–∞
* –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:
  * handler `/start` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ user –ø–æ `telegram_id`
  * `UserRepository.get_by_telegram_id()` –Ω–∞—Ö–æ–¥–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
  * –ù–ï —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª–∏–∫–∞—Ç –∞–∫–∫–∞—É–Ω—Ç–∞ (–∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ unique constraint)
  * –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ:
    * "–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, @username! üëã"
    * "–í–∞—à –±–∞–ª–∞–Ω—Å: $50.00"
    * "–ê–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã: 1"
  * –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç FSM –∫–æ–Ω—Ç–µ–∫—Å—Ç:
    * –µ—Å–ª–∏ –±—ã–ª –∞–∫—Ç–∏–≤–Ω—ã–π state —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤ ‚Üí –æ—á–∏—â–∞–µ—Ç (—Å—á–∏—Ç–∞–µ–º abandoned)
    * –µ—Å–ª–∏ –Ω–µ–¥–∞–≤–Ω–∏–π active state ‚Üí –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
  * –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
  * —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ñ–ª–∞–≥ `bot_blocked=False` –µ—Å–ª–∏ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ä–∞–Ω–µ–µ
  * –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ "user_returned" –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ retention
* Edge case: /start —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º —Ä–µ—Ñ–µ—Ä–∞–ª–∞ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ user
  * URL: `t.me/bot?start=ref123456`
  * user —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Å –¥—Ä—É–≥–∏–º referrer
  * –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
    * –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π `referrer_id`, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Ü–µ–ø–æ—á–∫—É
    * –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ: "–í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∞–∫–∫–∞—É–Ω—Ç–∞–º"
    * –∏–ª–∏ –º–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω–æ–µ "–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º"
  * –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–∞–∫—Ä—É—Ç–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è)
* –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π: user –±—ã–ª terminated
  * –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ `/start` –ø—Ä–æ–≤–µ—Ä–∫–∞ blacklist –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `TERMINATED`
  * `BanMiddleware` –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ updates
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç–∞ (–±–æ—Ç –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º)
  * —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è terminated accounts

#### R13-2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –±—ã—Å—Ç—Ä—ã–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –æ–¥–Ω—É –∫–Ω–æ–ø–∫—É (button spam)

* –ü—Ä–æ–±–ª–µ–º–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –∏–ª–∏ —Å–ª—É—á–∞–π–Ω–æ) –±—ã—Å—Ç—Ä–æ –∫–ª–∏–∫–∞–µ—Ç –æ–¥–Ω—É –∫–Ω–æ–ø–∫—É
  * –Ω–∞–ø—Ä–∏–º–µ—Ä: "üìä –ë–∞–ª–∞–Ω—Å" 10 —Ä–∞–∑ –∑–∞ 1 —Å–µ–∫—É–Ω–¥—É
  * –∏–ª–∏ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π —Å–ø–∞–º: "üí∞ –î–µ–ø–æ–∑–∏—Ç" ‚Üí "Level 1" ‚Üí "‚¨Ö –ù–∞–∑–∞–¥" ‚Üí "Level 1" ‚Üí –ø–æ–≤—Ç–æ—Ä–∏—Ç—å
  * –∏–ª–∏ "üí∏ –í—ã–≤–µ—Å—Ç–∏ –≤—Å—é —Å—É–º–º—É" 5 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥
* –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –±–µ–∑ –∑–∞—â–∏—Ç—ã:
  * –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –±–æ—Ç–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ –ë–î
  * race conditions –≤ FSM state (multiple handlers –ø—ã—Ç–∞—é—Ç—Å—è –∏–∑–º–µ–Ω–∏—Ç—å state)
  * –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ (10 –∫–æ–ø–∏–π —Å–æ–æ–±—â–µ–Ω–∏—è –æ –±–∞–ª–∞–Ω—Å–µ)
  * –≤–æ–∑–º–æ–∂–Ω—ã–µ duplicate –æ–ø–µ—Ä–∞—Ü–∏–∏ (multiple withdrawal requests)
  * –ø–ª–æ—Ö–æ–π UX –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–ø–∞–º –≤ —á–∞—Ç–µ)
  * –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π DDoS –≤–µ–∫—Ç–æ—Ä –∞—Ç–∞–∫–∏
* –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞:
  * **Level 1: Telegram built-in throttling**
    * Telegram API —Å–∞–º –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç rate updates –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    * –Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è aggressive clicking
  * **Level 2: Handler-level rate limiting —á–µ—Ä–µ–∑ Redis**
    * middleware –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º handler:
      ```python
      key = f"user:{telegram_id}:last_action:{callback_data}"
      last_time = redis.get(key)
      now = time.time()
      
      if last_time and (now - float(last_time)) < COOLDOWN:
          # Ignore duplicate - too soon
          return
      
      redis.setex(key, COOLDOWN, str(now))
      # Process handler
      ```
    * COOLDOWN: 500ms –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π, 2-3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö
    * –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ throttle:
      * –º–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∫–ª–∏–∫–∏ (no response)
      * –∏–ª–∏ answer callback query —Å alert: "‚è≥ –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ"
  * **Level 3: FSM-based protection**
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π action:
      ```python
      processing_key = f"processing:{user_id}"
      if redis.exists(processing_key):
          # Already processing an action
          return
      
      redis.setex(processing_key, 5, "1")  # Lock for 5 seconds
      try:
          # Process handler
      finally:
          redis.delete(processing_key)
      ```
    * –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç concurrent processing –æ–¥–Ω–æ–≥–æ user
  * **Level 4: Idempotency keys –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**
    * –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ withdrawal/deposit –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º idempotency_key
    * —Ö—Ä–∞–Ω–∏–º –≤ Redis –Ω–∞ 24 —á–∞—Å–∞
    * –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å —Ç–µ–º –∂–µ key ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º cached result
* –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —Å–ø–∞–º–µ—Ä–æ–≤:
  * –µ—Å–ª–∏ user –ø—Ä–µ–≤—ã—à–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π threshold (>50 actions –≤ –º–∏–Ω—É—Ç—É):
    * –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º—è–≥–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 5-10 –º–∏–Ω—É—Ç
    * —Å–æ–æ–±—â–µ–Ω–∏–µ: "–í—ã —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ –Ω–∞–∂–∏–º–∞–µ—Ç–µ –∫–Ω–æ–ø–∫–∏, –ø–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ"
    * –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ security_log –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è abuse patterns
    * –ø—Ä–∏ —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Å–ø–∞–º–µ ‚Üí review –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π ban
* User-friendly feedback:
  * –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ throttle: "‚è≥ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –Ω–∞–∂–∏–º–∞–π—Ç–µ –∫–Ω–æ–ø–∫–∏ —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ"
  * –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö: –º–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º (–Ω–µ —Å–ø–∞–º–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏)
  * –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞..."

#### R13-3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç —è–∑—ã–∫ Telegram –≤–æ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞

* –°—Ü–µ–Ω–∞—Ä–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–∑—ã–∫–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫:
  * –±–æ—Ç –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –æ–±—â–∞–µ—Ç—Å—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –Ω–∞ —Ä—É—Å—Å–∫–æ–º (default)
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Telegram –º–µ–Ω—è–µ—Ç —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
  * –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –±–æ—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
* –û–∂–∏–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è vs —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
  * **–æ–∂–∏–¥–∞–Ω–∏–µ**: –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
  * **—Ç–µ–∫—É—â–µ–µ**: –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º (single language bot)
* –†–µ—à–µ–Ω–∏–µ –¥–ª—è –±—É–¥—É—â–µ–π i18n –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è):
  * **Middleware –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞**:
    ```python
    class LanguageMiddleware:
        async def __call__(self, handler, event, data):
            user = event.from_user
            telegram_lang = user.language_code  # 'ru', 'en', 'es', etc.
            
            # Get user from DB
            db_user = await user_repo.get_by_telegram_id(user.id)
            
            if db_user and db_user.preferred_language != telegram_lang:
                # Language changed
                await user_repo.update_language(db_user.id, telegram_lang)
                
            # Set locale for this request
            data["locale"] = telegram_lang or "ru"
            return await handler(event, data)
    ```
  * **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ i18n —Ñ–∞–π–ª–æ–≤**:
    * `locales/ru/messages.yaml`
    * `locales/en/messages.yaml`
    * –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –∏–∑ –∫–æ–¥–∞ –≤ locale files
  * **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ handlers**:
    ```python
    async def balance_handler(message, locale):
        text = get_text("balance.message", locale, 
                       available=user.available_balance,
                       pending=user.pending_balance)
        await message.answer(text)
    ```
  * **–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Ç–∞–∫–∂–µ –ª–æ–∫–∞–ª–∏–∑—É—é—Ç—Å—è**:
    * –∫–Ω–æ–ø–∫–∏ –±–µ—Ä—É—Ç —Ç–µ–∫—Å—Ç –∏–∑ locale files
    * callback_data –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (–¥–ª—è –∫–æ–¥–∞)
* –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:
  * –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
  * `user.language_code` –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ
  * —ç—Ç–æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –≤–∞–∂–µ–Ω –¥–ª—è roadmap –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è —ç–∫—Å–ø–∞–Ω—Å–∏—è
* –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –±–µ–∑ –ø–æ–ª–Ω–æ–π i18n:
  * –∫–Ω–æ–ø–∫–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö "üåê –Ø–∑—ã–∫ / Language"
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ä—É—á–Ω—É—é –≤—ã–±–∏—Ä–∞–µ—Ç: –†—É—Å—Å–∫–∏–π / English
  * —Ñ–ª–∞–≥ `user.preferred_language` –≤ –ë–î
  * –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

---

## 14. R14 ‚Äî –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –∞–ª–µ—Ä—Ç—ã –∏ observability

### 14.1. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–æ–º–∞–ª–∏–∏

#### R14-1: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫–∞—Ö

* –°–∏—Å—Ç–µ–º–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π (KPI):
  * **Withdrawal metrics**:
    * —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç pending withdrawals: >100 –∑–∞—è–≤–æ–∫ –∑–∞ —á–∞—Å –ø—Ä–æ—Ç–∏–≤ –æ–±—ã—á–Ω—ã—Ö 10-20
    * –Ω–µ–æ–±—ã—á–Ω–æ –≤—ã—Å–æ–∫–∞—è —Å—É–º–º–∞ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –≤—ã–≤–æ–¥–æ–≤: $50k+ –∑–∞ —á–∞—Å –ø—Ä–æ—Ç–∏–≤ –æ–±—ã—á–Ω—ã—Ö $5k
    * spike –≤ rejected withdrawals: >20% rejection rate –ø—Ä–æ—Ç–∏–≤ –æ–±—ã—á–Ω—ã—Ö 2-5%
  * **Deposit metrics**:
    * –∞–Ω–æ–º–∞–ª—å–Ω–æ –Ω–∏–∑–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤: <5 –∑–∞ –¥–µ–Ω—å –ø—Ä–æ—Ç–∏–≤ –æ–±—ã—á–Ω—ã—Ö 50+
    * –Ω–µ–æ–±—ã—á–Ω—ã–µ —Å—É–º–º—ã: –º–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π level ($300) –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    * –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –∞–Ω–æ–º–∞–ª–∏—è: –≤—Å–µ –¥–µ–ø–æ–∑–∏—Ç—ã –∏–∑ –æ–¥–Ω–æ–π timezone (suspicious pattern)
  * **Balance metrics**:
    * –¥–∏—Å–±–∞–ª–∞–Ω—Å: total withdrawals –ø—Ä–µ–≤—ã—à–∞—é—Ç total deposits –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
    * —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç system liabilities (—Å—É–º–º–∞ –≤—Å–µ—Ö user balances)
    * negative trend –≤ platform reserves
  * **Referral metrics**:
    * spike –≤ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è—Ö (–≤–æ–∑–º–æ–∂–Ω–∞—è –Ω–∞–∫—Ä—É—Ç–∫–∞)
    * –∞–Ω–æ–º–∞–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è: –º–Ω–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º, –Ω–æ –Ω–µ—Ç –¥–µ–ø–æ–∑–∏—Ç–æ–≤
* `MetricsMonitor` service (—Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç):
  * —Å–±–æ—Ä current metrics —á–µ—Ä–µ–∑ –∞–≥—Ä–µ–≥–∏—Ä—É—é—â–∏–µ SQL queries
  * –∑–∞–≥—Ä—É–∑–∫–∞ historical baseline:
    * —Å–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
    * –º–µ–¥–∏–∞–Ω–∞ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞ 30 –¥–Ω–µ–π
    * —É—á—ë—Ç —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏: –≤—ã—Ö–æ–¥–Ω—ã–µ vs –±—É–¥–Ω–∏, –ø—Ä–∞–∑–¥–Ω–∏–∫–∏, time zones
  * statistical anomaly detection:
    * —Ä–∞—Å—á—ë—Ç z-score –¥–ª—è –∫–∞–∂–¥–æ–π –º–µ—Ç—Ä–∏–∫–∏
    * `z = (current - mean) / std_deviation`
    * –µ—Å–ª–∏ `|z| > 3` (>3 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π) ‚Üí –∞–Ω–æ–º–∞–ª–∏—è
  * pattern recognition —á–µ—Ä–µ–∑ ML (optional advanced):
    * LSTM model –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è expected values
    * deviation –æ—Ç prediction ‚Üí –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∞–Ω–æ–º–∞–ª–∏—è
* –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∞–Ω–æ–º–∞–ª–∏–∏:
  * **Immediate alert** –≤—Å–µ–º super_admin —á–µ—Ä–µ–∑ Telegram:
    * "üö® ANOMALY DETECTED: Withdrawal requests spike"
    * "Current: 150 requests/hour, Expected: 15¬±5"
    * "Deviation: +900%, Z-score: 8.5"
  * **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π snapshot** —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
    * —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö pending withdrawals –≤ CSV
    * —Å–ø–∏—Å–æ–∫ top 10 users –ø–æ activity –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
    * blockchain wallet balances
    * database backup timestamp
  * **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è** –≤ –∞–ª–µ—Ä—Ç–µ:
    * "Recommended: Review pending withdrawals manually"
    * "Consider: Temporary pause of auto-approvals"
    * "Action: Investigate user #12345 (suspicious activity)"
  * **Real-time dashboard**:
    * —Å—Å—ã–ª–∫–∞ –Ω–∞ Grafana/admin panel —Å live –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
    * drill-down –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
    * historical comparison charts
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ protective actions:
  * –µ—Å–ª–∏ anomaly severity > CRITICAL:
    * –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ auto-approvals –¥–ª—è withdrawals >$1000
    * —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¥–≤—É—Ö super_admin –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è –∫—Ä—É–ø–Ω—ã—Ö –≤—ã–≤–æ–¥–æ–≤
    * —É—Å–∏–ª–µ–Ω–Ω—ã–π fraud detection –¥–ª—è –Ω–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  * –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö decisions –≤ audit trail
* False positive reduction:
  * whitelist expected anomalies: marketing campaign launches, bonus programs
  * admin –º–æ–∂–µ—Ç "acknowledge" –∞–ª–µ—Ä—Ç: "–≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ, –ø—Ä–æ–≤–æ–¥–∏–º –∞–∫—Ü–∏—é"
  * machine learning model —É—á–∏—Ç—Å—è –Ω–∞ feedback

#### R14-2: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ health –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

* –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ health checks –¥–ª—è infrastructure –∏ application services:
  * **PostgreSQL health**:
    * connection pool status: active/idle connections, wait time
    * slow query detection: queries >1 second –≤ slow log
    * database size –∏ disk space available (alert –µ—Å–ª–∏ <20% free)
    * replication lag (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω slave)
    * transaction rate –∏ locks
  * **Redis health**:
    * memory usage: used_memory vs maxmemory (alert –µ—Å–ª–∏ >90%)
    * eviction rate: —Å–∫–æ–ª—å–∫–æ keys –±—ã–ª–æ evicted (alert –µ—Å–ª–∏ >0)
    * connection count: current vs max
    * hit rate: cache effectiveness (warning –µ—Å–ª–∏ <70%)
    * persistence status: last RDB/AOF save
  * **Blockchain nodes health**:
    * RPC endpoint latency –¥–ª—è –∫–∞–∂–¥–æ–≥–æ node (<500ms = good, >2s = bad)
    * sync status: `eth_syncing` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å false (synced)
    * block height comparison: –Ω–∞—à node vs network (lag <10 blocks)
    * peer count: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ connected peers (>5 = healthy)
    * failed requests rate: % requests —Å errors (<5%)
  * **Telegram Bot API health**:
    * webhook status: –∞–∫—Ç–∏–≤–µ–Ω –∏ –ø–æ–ª—É—á–∞–µ—Ç updates
    * message delivery rate: % successful sends (>95%)
    * API response latency (<1s median)
    * rate limit proximity: —Å–∫–æ–ª—å–∫–æ –¥–æ –ª–∏–º–∏—Ç–∞ 30 msg/sec
  * **Background jobs health**:
    * `roi_distribution_job`: last successful run (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å <25 —á–∞—Å–æ–≤)
    * `blockchain_monitor`: processing delay (blocks behind < 3)
    * `withdrawal_processor`: queue size (pending < 50)
    * `notification_sender`: queue size –∏ delivery rate
    * –≤—Å–µ jobs: success rate >95%, average duration tracking
* Unified health check endpoint `GET /health`:
  * –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å overall status:
    ```json
    {
      "status": "healthy|degraded|unhealthy",
      "timestamp": "2025-01-24T12:34:56Z",
      "version": "2.0.0",
      "uptime": "5d 12h 34m",
      "components": {
        "postgresql": {
          "status": "healthy",
          "latency_ms": 5,
          "details": {
            "connections_active": 12,
            "connections_idle": 18,
            "disk_free_percent": 45
          }
        },
        "redis": {
          "status": "healthy",
          "latency_ms": 2,
          "details": {
            "memory_used_percent": 65,
            "hit_rate_percent": 87
          }
        },
        "blockchain_bsc": {
          "status": "degraded",
          "latency_ms": 1500,
          "details": {
            "block_height": 12345678,
            "sync_status": "synced",
            "reason": "High latency on primary RPC"
          }
        }
      },
      "resource_usage": {
        "cpu_percent": 35,
        "memory_percent": 68,
        "disk_percent": 42
      }
    }
    ```
  * HTTP status codes:
    * 200 OK: –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã healthy
    * 503 Service Unavailable: —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω critical component unhealthy
    * 429 Too Many Requests: –µ—Å–ª–∏ maintenance mode
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π self-healing:
  * **Component degradation detected**:
    * –ø–æ–ø—ã—Ç–∫–∞ graceful restart –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    * –Ω–∞–ø—Ä–∏–º–µ—Ä: Redis high memory ‚Üí trigger `MEMORY PURGE` –¥–ª—è expired keys
    * PostgreSQL slow queries ‚Üí kill long-running transactions (>5 min)
  * **Critical failure detected**:
    * automatic failover –Ω–∞ backup –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
    * –Ω–∞–ø—Ä–∏–º–µ—Ä: primary RPC node down ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ secondary
    * notification –∞–¥–º–∏–Ω–∞–º –æ failover
  * **Escalation –ø—Ä–∏ failure auto-recovery**:
    * –ø–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ restart ‚Üí —ç—Å–∫–∞–ª–∞—Ü–∏—è
    * –∞–ª–µ—Ä—Ç –≤—Å–µ–º super_admin: manual intervention required
    * system –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ degraded mode —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
* External monitoring integration:
  * **Prometheus metrics export**:
    * endpoint `/metrics` –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
    * custom metrics: `sigmabot_withdrawals_total`, `sigmabot_deposits_confirmed`, etc.
    * standard metrics: HTTP request duration, DB query latency, etc.
  * **Grafana dashboards**:
    * "Financial Operations" dashboard: deposits, withdrawals, –±–∞–ª–∞–Ω—Å—ã
    * "System Health" dashboard: CPU, memory, disk, DB, Redis
    * "User Activity" dashboard: registrations, active users, sessions
  * **Alerting rules** –≤ Prometheus/Grafana:
    * `sigmabot_withdrawals_pending > 100` ‚Üí alert super_admin
    * `sigmabot_db_connection_errors_total > 10` ‚Üí critical alert
    * `sigmabot_blockchain_rpc_latency > 2000` ‚Üí warning
* Periodic health reports:
  * –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π digest –≤ 09:00 –¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤
  * weekly report —Å —Ç—Ä–µ–Ω–¥–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
  * monthly compliance report –¥–ª—è –∞—É–¥–∏—Ç–∞

#### R14-3: –õ–æ–≥-–∞–≥—Ä–µ–≥–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫

* –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤:
  * **Structured logging** (JSON format) –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
    ```json
    {
      "timestamp": "2025-01-24T12:34:56.789Z",
      "level": "ERROR",
      "service": "withdrawal_service",
      "trace_id": "abc123-def456",
      "user_id": 12345,
      "telegram_id": 67890,
      "message": "Failed to send USDT transaction",
      "error": {
        "type": "InsufficientGasError",
        "message": "Gas price too low",
        "stack_trace": "..."
      },
      "context": {
        "withdrawal_id": 999,
        "amount": 100.0,
        "tx_hash": null
      }
    }
    ```
  * **Log levels** —Å–æ strict usage policy:
    * `DEBUG`: –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–≤—ã–∫–ª—é—á–µ–Ω–æ –≤ production)
    * `INFO`: –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è: user registered, deposit confirmed, withdrawal approved
    * `WARNING`: –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã: high latency, retry triggered, threshold approaching
    * `ERROR`: –æ—à–∏–±–∫–∏ —Ç—Ä–µ–±—É—é—â–∏–µ attention: failed transaction, DB error, API error
    * `CRITICAL`: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ —Ç—Ä–µ–±—É—é—â–∏–µ immediate action: service down, data corruption
  * **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è** –≤ –∫–∞–∂–¥–æ–º log entry:
    * `timestamp`: ISO 8601 —Å milliseconds –∏ timezone
    * `level`: log level
    * `service`: –∏–º—è —Å–µ—Ä–≤–∏—Å–∞/–º–æ–¥—É–ª—è
    * `message`: —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
    * `trace_id`: unique ID –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ request —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É
    * –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: `user_id`, `telegram_id`, `session_id`, `request_id`
* Log aggregation stack:
  * **Collection**: –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã/—Å–µ—Ä–≤–∏—Å—ã –ø–∏—à—É—Ç –≤ stdout
  * **Shipping**: FluentD/Filebeat —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ storage
  * **Storage**: Elasticsearch –¥–ª—è searchable —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–∏–ª–∏ Loki –¥–ª—è lightweight)
  * **Visualization**: Kibana/Grafana –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ error patterns —á–µ—Ä–µ–∑ `ErrorAnalyzer` service:
  * **Error grouping**:
    * –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ –ø–æ `error.type` –∏ `message` fingerprint
    * –ø–æ–¥—Å—á—ë—Ç frequency –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã
    * example: "InsufficientGasError occurred 45 times in last 10 minutes"
  * **Frequency-based alerting**:
    * threshold rules: –µ—Å–ª–∏ –æ–¥–Ω–∞ –æ—à–∏–±–∫–∞ >10 —Ä–∞–∑ –∑–∞ –º–∏–Ω—É—Ç—É ‚Üí WARNING
    * –µ—Å–ª–∏ >50 —Ä–∞–∑ –∑–∞ –º–∏–Ω—É—Ç—É ‚Üí CRITICAL alert
    * if same user causing errors >20 times ‚Üí potential abuse
  * **Cascade failure detection**:
    * correlation –º–µ–∂–¥—É –æ—à–∏–±–∫–∞–º–∏: DB error ‚Üí cascade withdrawal failures
    * temporal correlation: –≤—Å–µ –æ—à–∏–±–∫–∏ –Ω–∞—á–∞–ª–∏—Å—å –ø–æ—Å–ª–µ deployment
    * dependency analysis: Redis down ‚Üí –≤—Å–µ services reporting cache errors
  * **Error impact assessment**:
    * —Å–∫–æ–ª—å–∫–æ users affected
    * financial impact: —Å—É–º–º–∞ failed transactions
    * severity scoring: critical path vs edge case
* Smart alerting system (anti-spam):
  * **Grouping**: –Ω–µ —à–ª—ë–º 100 –∞–ª–µ—Ä—Ç–æ–≤ –¥–ª—è 100 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—à–∏–±–æ–∫
    * –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ: "‚ö†Ô∏è 15 withdrawal failures in last 5 minutes due to blockchain timeout"
  * **Severity-based routing**:
    * CRITICAL ‚Üí instant Telegram notification –≤—Å–µ–º super_admin
    * ERROR ‚Üí email digest –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç (batched)
    * WARNING ‚Üí daily summary report
  * **Rate limiting**:
    * maximum 5 Telegram alerts per —á–∞—Å –¥–ª—è non-critical
    * unlimited –¥–ª—è CRITICAL (–Ω–æ —Å deduplication)
  * **Alert fatigue prevention**:
    * deduplication window: same alert –Ω–µ —á–∞—â–µ —Ä–∞–∑ –≤ 10 –º–∏–Ω—É—Ç
    * auto-resolution: –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–µ–∫—Ä–∞—Ç–∏–ª–∞—Å—å >30 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥ ‚Üí "Resolved" notification
    * snooze option: –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π alert
* Searchable log storage –∏ retention:
  * **Retention policy** –ø–æ levels:
    * DEBUG: –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ production (–∏–ª–∏ 1 –¥–µ–Ω—å –¥–ª—è troubleshooting)
    * INFO: 7 –¥–Ω–µ–π hot (–±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø), 30 –¥–Ω–µ–π warm (slower access)
    * WARNING/ERROR/CRITICAL: 90 –¥–Ω–µ–π hot, 1 –≥–æ–¥ cold archive
  * **Full-text search capabilities**:
    * –ø–æ–∏—Å–∫ –ø–æ –ª—é–±—ã–º –ø–æ–ª—è–º: user_id, error type, time range
    * example query: "–≤—Å–µ errors –æ—Ç user 12345 –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞"
    * regex support –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö patterns
  * **Distributed tracing**:
    * `trace_id` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Å–ª–µ–¥–∏—Ç—å –ø–æ–ª–Ω—ã–π lifecycle request:
      * user clicks "Withdraw" ‚Üí handler invoked ‚Üí FSM updated ‚Üí DB query ‚Üí blockchain call ‚Üí notification sent
    * view all logs for single trace_id –≤ timeline
    * –ø–æ–º–æ–≥–∞–µ—Ç debugging —Å–ª–æ–∂–Ω—ã—Ö multi-service issues
* Log analysis –¥–ª—è business intelligence:
  * most common errors –∑–∞ –Ω–µ–¥–µ–ª—é
  * user journey analysis: –∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏–≤–æ–¥—è—Ç –∫ errors
  * performance bottlenecks: slow operations identification
  * security events: suspicious patterns, –±—Ä—É—Ç—Ñ–æ—Ä—Å –ø–æ–ø—ã—Ç–∫–∏

---

## 15. R15 ‚Äî Cross-role / Cross-status —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Ä–æ–ª–µ–π)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–∂–Ω–æ—Å—Ç—å**: –°–∞–º—ã–µ –æ–ø–∞—Å–Ω—ã–µ –±–∞–≥–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å—Ç—ã–∫–∞—Ö —Ä–æ–ª–µ–π –∏ —Å—Ç–∞—Ç—É—Å–æ–≤, –≥–¥–µ –ª–æ–≥–∏–∫–∞ –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å.

### 15.1. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

#### R15-1: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –¥–µ–ø–æ–∑–∏—Ç–∞–º–∏ –∏ pending-–≤—ã–≤–æ–¥–∞–º–∏

* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ç—Ä–µ–±—É—é—â–∏–π —á–µ—Ç–∫–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏:
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç:
    * –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã —Å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º ROI (–Ω–∞–ø—Ä–∏–º–µ—Ä, 200% –∏–∑ 500%)
    * pending withdrawal –Ω–∞ $500
    * scheduled ROI –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞
    * —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏
  * –∞–¥–º–∏–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`BlacklistActionType.BLOCKED`)
* –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –∫–∞–∂–¥—ã–º –∞—Å–ø–µ–∫—Ç–æ–º:
  * **ROI –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è**:
    * –≤–∞—Ä–∏–∞–Ω—Ç A (—Å—Ç—Ä–æ–≥–∏–π): –ø–æ–ª–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
    * –≤–∞—Ä–∏–∞–Ω—Ç B (–º—è–≥–∫–∏–π): –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ –±–∞–ª–∞–Ω—Å, –Ω–æ –±–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–≤–æ–¥
    * –≤–∞—Ä–∏–∞–Ω—Ç C (–≥–∏–±—Ä–∏–¥–Ω—ã–π): –∑–∞–≤–µ—Ä—à–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥ (–¥–æ –∫–æ–Ω—Ü–∞ –º–µ—Å—è—Ü–∞), –ø–æ—Ç–æ–º —Å—Ç–æ–ø
  * **Pending withdrawals**:
    * –≤–∞—Ä–∏–∞–Ω—Ç A: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π reject –≤—Å–µ—Ö pending —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º –Ω–∞ –±–∞–ª–∞–Ω—Å
    * –≤–∞—Ä–∏–∞–Ω—Ç B: –∞–¥–º–∏–Ω —Ä–µ—à–∞–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞—è–≤–∫–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ
    * –≤–∞—Ä–∏–∞–Ω—Ç C: "–∑–∞–º–æ—Ä–æ–∑–∫–∞" –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å `FROZEN` –¥–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  * **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è**:
    * –æ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ: –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–ª–∏ —Å—Ç–æ–ø?
    * –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–∫ —Ä–µ—Ñ–µ—Ä–µ—Ä –≤ —á—É–∂–∏—Ö —Ü–µ–ø–æ—á–∫–∞—Ö: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–ª–∏ –Ω–∞—á–∏—Å–ª—è–µ–º?
  * **–î–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –¥–∞–Ω–Ω—ã–º**:
    * –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–∏ read-only view –±–∞–ª–∞–Ω—Å–æ–≤ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π?
    * –∏–ª–∏ –ø–æ–ª–Ω—ã–π blackout –∫—Ä–æ–º–µ –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é"?
* –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è):
  * ROI: –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
  * Withdrawals: –ø–µ—Ä–µ–≤–æ–¥ –≤ `FROZEN`, —Ä–µ—à–µ–Ω–∏–µ –ø–æ—Å–ª–µ review
  * Referral: –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (—ç—Ç–æ –¥–µ–Ω—å–≥–∏ —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤, –Ω–µ –Ω–∞—Ä—É—à–∏—Ç–µ–ª—è)
  * History: read-only –¥–æ—Å—Ç—É–ø —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
* –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å blacklist –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö "–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö" –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –∞—É–¥–∏—Ç–∞

#### R15-2: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ BLOCKED ‚Üí TERMINATED

* –≠—Å–∫–∞–ª–∞—Ü–∏—è —Å–∞–Ω–∫—Ü–∏–π –ø–æ—Å–ª–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª `BLOCKED` (–º—è–≥–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
  * –ø–æ–¥–∞–ª –∞–ø–µ–ª–ª—è—Ü–∏—é, –Ω–æ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞–ª–æ —Å–µ—Ä—å–µ–∑–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ
  * super_admin –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ `TERMINATED` (–∂–µ—Å—Ç–∫–∏–π –±–∞–Ω)
* –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏:
  * **–ê–∫—Ç–∏–≤–Ω—ã–µ –∞–ø–µ–ª–ª—è—Ü–∏–∏**:
    * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π reject –≤—Å–µ—Ö appeals —Å –ø—Ä–∏—á–∏–Ω–æ–π "Account terminated"
    * –∑–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö support tickets
  * **BanMiddleware –ø–æ–≤–µ–¥–µ–Ω–∏–µ**:
    * —Ç–µ–ø–µ—Ä—å –≥–ª–æ—Ç–∞–µ—Ç –≤—Å–µ updates –ø–æ–ª–Ω–æ—Å—Ç—å—é
    * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç "–º–µ—Ä—Ç–≤—ã–π" –±–æ—Ç (–Ω–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤)
  * **–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏**:
    * ROI distribution: skip —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    * referral earnings: –ø–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–ø–æ—á–µ–∫ —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º terminated
    * notification queue: –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö pending —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  * **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
    * –≤—Å–µ pending withdrawals ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `REJECTED`
    * —Å—Ä–µ–¥—Å—Ç–≤–∞ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å–µ (–≤–æ–∑–º–æ–∂–Ω–∞—è –∫–æ–Ω—Ñ–∏—Å–∫–∞—Ü–∏—è –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç –ø–æ —Ä–µ—à–µ–Ω–∏—é legal)
  * **–í–∏–¥–∏–º–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
    * –±–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (–∫–∞–∫ –±—É–¥—Ç–æ —É–¥–∞–ª–µ–Ω)
    * –Ω–∏–∫–∞–∫–∏—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π –∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞–ø–µ–ª–ª—è—Ü–∏–∏
* Transition –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–º:
  * –æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç blacklist entry
  * —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏–ª–∏ background job –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –≤—Å–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
* –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –ø–µ—Ä–µ—Ö–æ–¥–∞ –¥–ª—è legal compliance

#### R15-3: –ê–∫—Ç–∏–≤–Ω—ã–π finpass_recovery + –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤—ã–≤–æ–¥–∞

* Race condition –º–µ–∂–¥—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ø–∞—Ä–æ–ª—è –∏ –ø–æ–ø—ã—Ç–∫–æ–π –≤—ã–≤–æ–¥–∞:
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª finpass recovery
  * –∑–∞–ø—Ä–æ—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `PENDING` (–∂–¥–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞)
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å withdrawal (–≤—Å–ø–æ–º–Ω–∏–ª —Å—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å? –∞—Ç–∞–∫–∞?)
* –ü—Ä–∞–≤–∏–ª–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
  * **–í—Å–µ –Ω–æ–≤—ã–µ withdrawal requests –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è**:
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ `FinpassRecoveryService.has_active_recovery(user_id)`
    * –µ—Å–ª–∏ true ‚Üí –æ—Ç–∫–∞–∑ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º:
      * "–£ –≤–∞—Å –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è"
      * "–í—ã–≤–æ–¥—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –¥–æ —Ä–µ—à–µ–Ω–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å—É"
      * "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –µ—Å–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞"
  * **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ PENDING withdrawals**:
    * –≤–∞—Ä–∏–∞–Ω—Ç A: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–æ—Ä–æ–∑–∫–∞ –≤ —Å—Ç–∞—Ç—É—Å `ON_HOLD`
    * –≤–∞—Ä–∏–∞–Ω—Ç B: –æ—Å—Ç–∞—é—Ç—Å—è –≤ PENDING, –Ω–æ –∞–¥–º–∏–Ω –≤–∏–¥–∏—Ç warning –ø—Ä–∏ approve
  * **–ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è**:
    * –ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π withdrawal —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º —Å–Ω–∏–º–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
    * –∏–ª–∏ explicit admin action "unlock withdrawals"
* Security –ª–æ–≥–∏–∫–∞:
  * –µ—Å–ª–∏ –ø–æ–ø—ã—Ç–∫–∞ withdrawal —Å –ü–†–ê–í–ò–õ–¨–ù–´–ú —Å—Ç–∞—Ä—ã–º –ø–∞—Ä–æ–ª–µ–º ‚Üí auto-reject finpass recovery
  * –µ—Å–ª–∏ —Å –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ú ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º risk score (–≤–æ–∑–º–æ–∂–Ω–∞—è –∞—Ç–∞–∫–∞)
* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
  * –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—ã–≤–æ–¥–∞ ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º –æ suspicious activity
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Üí –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∞–∫—Ç–∏–≤–Ω–æ–º recovery –∑–∞–ø—Ä–æ—Å–µ

#### R15-4: –ê–¥–º–∏–Ω, –∫–æ—Ç–æ—Ä—ã–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —è–≤–ª—è–µ—Ç—Å—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º –∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ blacklist

* –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Ä–æ–ª–µ–π –ø—Ä–∏ —Å–∞–Ω–∫—Ü–∏—è—Ö:
  * user –∏–º–µ–µ—Ç —Ñ–ª–∞–≥ `is_admin=True` (–∏–ª–∏ –¥–∞–∂–µ `is_super_admin`)
  * –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —è–≤–ª—è–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º (–¥–µ–ø–æ–∑–∏—Ç—ã $10k, –±–∞–ª–∞–Ω—Å $5k)
  * –Ω–∞—Ä—É—à–∏–ª –ø—Ä–∞–≤–∏–ª–∞ (–∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–º–æ—á–∏—è–º–∏, fraud, etc.)
  * –¥—Ä—É–≥–æ–π super_admin –±–ª–æ–∫–∏—Ä—É–µ—Ç –µ–≥–æ
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤:
  * **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–Ω—è—Ç–∏–µ –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∞–≤**:
    * `is_admin=False`, `is_extended_admin=False`, `is_super_admin=False`
    * –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö `AdminSession`
    * revoke –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
  * **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—É–¥–∏—Ç**:
    * –¥–µ—Ç–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ `admin_actions`: –∫—Ç–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª, –∫–æ–≥–¥–∞, –ø—Ä–∏—á–∏–Ω–∞
    * —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–º–∞—Å—Å–æ–≤—ã–µ approvals, –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤)
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —á–∞—Å—Ç–∏:
  * **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
    * –ø–æ–ª–∏—Ç–∏–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–∏—á–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
      * fraud ‚Üí –ø–æ–ª–Ω–∞—è –∑–∞–º–æ—Ä–æ–∑–∫–∞, –≤–æ–∑–º–æ–∂–Ω–∞—è –∫–æ–Ω—Ñ–∏—Å–∫–∞—Ü–∏—è
      * policy violation ‚Üí –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–≤–æ–¥–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
      * technical breach ‚Üí –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å—Ä–µ–¥—Å—Ç–≤–∞–º
  * **–î–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—Ä–∏–∏**:
    * –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∫–∞–∫ –æ–±—ã—á–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    * –Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
  * **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**:
    * –µ—Å–ª–∏ –±—ã–ª —Ä–µ—Ñ–µ—Ä–∞–ª–æ–º –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–æ–ª—É—á–∞—Ç—å earnings
    * —Å–≤–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å (—ç—Ç–æ –∏—Ö –¥–µ–Ω—å–≥–∏)
* –¶–µ–ª–µ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ (–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ):
  * –∞–¥–º–∏–Ω—Å–∫–∏–µ –ø—Ä–∞–≤–∞ —Å–Ω–∏–º–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏ –±–µ–∑—É—Å–ª–æ–≤–Ω–æ
  * —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø—Ä–∞–≤–∞ –∑–∞–≤–∏—Å—è—Ç –æ—Ç severity –Ω–∞—Ä—É—à–µ–Ω–∏—è
  * –ø–æ–ª–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ admin context –∏ user context –≤ –∫–æ–¥–µ

#### R15-5: –°–º–µ–Ω–∞ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∞ –≤–æ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏

* Dynamic role change –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:
  * `user_123` —è–≤–ª—è–µ—Ç—Å—è `extended_admin` —Å –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–µ–π
  * super_admin –ø–æ–Ω–∏–∂–∞–µ—Ç –µ–≥–æ –¥–æ –æ–±—ã—á–Ω–æ–≥–æ `admin`
  * –∏–ª–∏ –≤–æ–æ–±—â–µ —É–¥–∞–ª—è–µ—Ç –∏–∑ –∞–¥–º–∏–Ω–æ–≤ (`is_admin=False`)
  * —Å–µ—Å—Å–∏—è –µ—â–µ –∞–∫—Ç–∏–≤–Ω–∞ (–Ω–µ –∏—Å—Ç–µ–∫ —Ç–∞–π–º–∞—É—Ç 15 –º–∏–Ω—É—Ç)
* –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:
  * **–ê–∫—Ç–∏–≤–Ω–∞—è AdminSession**:
    * –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º action –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
    * –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è: session.role > user.actual_role
    * —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π logout —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "–í–∞—à–∏ –ø—Ä–∞–≤–∞ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã"
    * —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  * **–ö–Ω–æ–ø–∫–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏**:
    * –¥–æ–ª–∂–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–∞–≤
    * extended-only –∫–Ω–æ–ø–∫–∏ –∏—Å—á–µ–∑–∞—é—Ç –¥–ª—è downgraded –∞–¥–º–∏–Ω–∞
    * –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é inline-–∫–Ω–æ–ø–∫—É ‚Üí error "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤"
  * **–£–∂–µ –Ω–∞—á–∞—Ç—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
    * –µ—Å–ª–∏ –∞–¥–º–∏–Ω –Ω–∞—á–∞–ª approve –∫—Ä—É–ø–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞, –Ω–æ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–æ—Ç–µ—Ä—è–ª –ø—Ä–∞–≤–∞:
      * –æ–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å rollback
      * –∏–ª–∏ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
    * –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç commit, –Ω–µ –Ω–∞ –º–æ–º–µ–Ω—Ç start
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
  * middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –∫–∞–∂–¥—ã–π request
  * –∫—ç—à –ø—Ä–∞–≤ –≤ Redis —Å TTL 60 —Å–µ–∫—É–Ω–¥ (–∫–æ–º–ø—Ä–æ–º–∏—Å—Å –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ security)
  * –ø—Ä–∏ downgrade/—É–¥–∞–ª–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∞ ‚Üí explicit invalidation –∫—ç—à–∞
* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
  * downgraded –∞–¥–º–∏–Ω—É: "–í–∞—à–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∞ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã"
  * super_admin who made change: confirmation —Å –ª–æ–≥–æ–º –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

#### R15-6: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí BLOCKED –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–≤–æ–¥–∞

* Timing attack scenario:
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–ª withdrawal request –≤ 10:00:00
  * –∑–∞–ø—Ä–æ—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `PENDING`
  * –≤ 10:05:00 fraud detection –ø–æ–¥–Ω–∏–º–∞–µ—Ç alarm
  * –≤ 10:10:00 –∞–¥–º–∏–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  * –≤ 10:15:00 –¥—Ä—É–≥–æ–π –∞–¥–º–∏–Ω (–Ω–µ –∑–Ω–∞—è –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ) –æ–¥–æ–±—Ä—è–µ—Ç withdrawal
* –ü—Ä–æ–±–ª–µ–º–∞: race condition –º–µ–∂–¥—É ban –∏ approval
* –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ atomic checks:
  * –ø—Ä–∏ `approve_withdrawal` –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –ø—Ä–æ–≤–µ—Ä–∫–∞:
    ```python
    # Inside transaction
    user = session.query(User).filter_by(id=withdrawal.user_id).with_for_update().first()
    blacklist = BlacklistService.is_blacklisted(user.telegram_id)
    
    if blacklist and blacklist.action_type != BlacklistActionType.NONE:
        # User is blocked/terminated
        withdrawal.status = WithdrawalStatus.REJECTED
        withdrawal.rejection_reason = f"User blocked: {blacklist.reason}"
        # Return funds to balance
        UserService.adjust_balance(user.id, withdrawal.amount, "withdrawal_rejected_user_blocked")
        return Error("Cannot approve withdrawal for blocked user")
    
    # Proceed with approval
    ```
  * –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á—Ç–æ –∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ
  * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `FOR UPDATE` lock –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç concurrent –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
* –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è PENDING withdrawals —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –î–û –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
  * **–≤–∞—Ä–∏–∞–Ω—Ç A (—Å—Ç—Ä–æ–≥–∏–π)**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π reject –≤—Å–µ—Ö pending –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
  * **–≤–∞—Ä–∏–∞–Ω—Ç B (–º—è–≥–∫–∏–π)**: –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä–∏—Ç—å –µ—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è
  * **–≤–∞—Ä–∏–∞–Ω—Ç C (recommended)**: freeze –≤ —Å—Ç–∞—Ç—É—Å `REQUIRES_REVIEW`, explicit —Ä–µ—à–µ–Ω–∏–µ
* –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –≤ –∞—É–¥–∏—Ç–µ:
  * –≤—Å–µ withdrawal operations –¥–ª—è blocked users –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —Ñ–ª–∞–≥–æ–º `user_was_blocked`
  * timestamp –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ vs timestamp withdrawal creation –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
  * reject reason –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É: "User blocked on 2025-01-24 10:10:00"
* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
  * –∞–¥–º–∏–Ω—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ approve ‚Üí warning "User is currently blocked"
  * –≤ —Å–ª—É—á–∞–µ auto-reject ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–µ—Å–ª–∏ –ø–æ–ª–∏—Ç–∏–∫–∞ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç)

#### R15-7: –ü–∞—Ä—Ç–Ω—ë—Ä —Å —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏, –ø–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω—ã–π –≤ TERMINATED

* –ö–∞—Å–∫–∞–¥–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
  * User A (active) ‚Üí User B (terminated) ‚Üí User C (active) ‚Üí User D (active)
  * User B –±—ã–ª –≤–∞–∂–Ω—ã–º –∑–≤–µ–Ω–æ–º –≤ —Ü–µ–ø–æ—á–∫–µ
  * –µ–≥–æ terminat'—è—Ç –∑–∞ fraud
* –í–∞—Ä–∏–∞–Ω—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏:
  * **–í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ —Ü–µ–ø–æ—á–∫–∏**
    * User B "–≤—ã—Ä–µ–∑–∞–µ—Ç—Å—è" –∏–∑ referral chain
    * User C —Ç–µ–ø–µ—Ä—å –Ω–∞–ø—Ä—è–º—É—é –ø—Ä–∏–≤—è–∑–∞–Ω –∫ User A
    * –≤—Å–µ –±—É–¥—É—â–∏–µ earnings –æ—Ç User C –∏–¥—É—Ç User A (level 2 ‚Üí level 1)
    * –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ earnings User B –æ—Å—Ç–∞—é—Ç—Å—è (—É–∂–µ –≤—ã–ø–ª–∞—á–µ–Ω—ã)
  * **–í–∞—Ä–∏–∞–Ω—Ç 2: –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ unpaid earnings**
    * –≤—Å–µ unpaid earnings User B –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –Ω–∞ User A (–µ–≥–æ referrer)
    * –∫–∞–∫ compensation –∑–∞ –ø–æ—Ç–µ—Ä—é –∑–≤–µ–Ω–∞
    * –∏–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  * **–í–∞—Ä–∏–∞–Ω—Ç 3: –ó–∞–º–æ—Ä–æ–∑–∫–∞ —Ü–µ–ø–æ—á–∫–∏**
    * User B –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Ü–µ–ø–æ—á–∫–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏
    * –Ω–æ –≤—Å–µ earnings —á–µ—Ä–µ–∑ –Ω–µ–≥–æ = 0%
    * —Ü–µ–ø–æ—á–∫–∞ "—Ä–∞–∑–æ—Ä–≤–∞–Ω–∞", User C –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç earnings –Ω–∏–∫–æ–º—É –≤—ã—à–µ
  * **–í–∞—Ä–∏–∞–Ω—Ç 4: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö earnings**
    * —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ü–µ–ø–æ—á–∫–∏ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
    * –Ω–æ –æ—Ç –Ω–æ–≤—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤ User B –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç
    * —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –µ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç—å earnings –∫–∞–∫ —Ä–∞–Ω—å—à–µ
* –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ (–Ω—É–∂–Ω–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å –±–∏–∑–Ω–µ—Å–æ–º):
  * **immediate action –ø—Ä–∏ terminate**:
    * stop –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö earnings –¥–ª—è terminated user
    * set —Ñ–ª–∞–≥ `can_earn_referrals=False`
  * **–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ü–µ–ø–æ—á–∫–∏**:
    * –ù–ï –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ü–µ–ø–æ—á–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Å–ª–æ–∂–Ω–æ, —Ä–∏—Å–∫ –æ—à–∏–±–æ–∫)
    * –ø—Ä–æ—Å—Ç–æ skip terminated users –≤ —Ä–∞—Å—á–µ—Ç–∞—Ö
    * earnings –∏–¥—É—Ç –∂–∏–≤—ã–º –∑–≤–µ–Ω—å—è–º, –ø—Ä–æ–ø—É—Å–∫–∞—è terminated
  * **unpaid earnings**:
    * –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å–µ terminated user
    * –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å withdrawal –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–∏—á–∏–Ω—ã terminate
    * –ø—Ä–∏ fraud ‚Üí –∫–æ–Ω—Ñ–∏—Å–∫–∞—Ü–∏—è –∏–ª–∏ legal hold
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `ReferralService.process_deposit_referral_earnings()`:
  * –ø–æ–ª—É—á–µ–Ω–∏–µ chain —Å —Ñ–∏–ª—å—Ç—Ä–æ–º `WHERE is_terminated=False`
  * –∏–ª–∏ manual skip –≤ —Ü–∏–∫–ª–µ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ terminated
  * –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ skipped referrer
* –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
  * terminated user –æ—Å—Ç–∞–µ—Ç—Å—è –≤ `referral_count` —Å–≤–æ–µ–≥–æ referrer'–∞
  * –Ω–æ –Ω–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç –Ω–æ–≤—ã—Ö earnings
  * –º–µ—Ç—Ä–∏–∫–∞ "active referrals" vs "total referrals"

---

## 16. R16 ‚Äî Identity / multi-account —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –í–æ–ø—Ä–æ—Å—ã –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ –Ω–∞–ø—Ä—è–º—É—é —Å–≤—è–∑–∞–Ω—ã —Å –¥–µ–Ω—å–≥–∞–º–∏ –∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º–∏ —Ä–∏—Å–∫–∞–º–∏.

### 16.1. –ú—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–∏–Ω–≥ –∏ –¥—É–±–ª–∏–∫–∞—Ç—ã

#### R16-1: –û–¥–∏–Ω –∫–æ—à–µ–ª—ë–∫ –Ω–∞ –¥–≤–∞ Telegram-–∞–∫–∫–∞—É–Ω—Ç–∞ (multiaccounting)

* –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–∞ –∞–∫–∫–∞—É–Ω—Ç–∞:
  * User A —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Å wallet `0xABC...123`
  * User B (–¥—Ä—É–≥–æ–π telegram_id) –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —Ç–µ–º –∂–µ wallet `0xABC...123`
* –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
  * **–ª–µ–≥–∏—Ç–∏–º–Ω—ã–µ**:
    * –ø–æ—Ç–µ—Ä—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç–∞—Ä–æ–º—É Telegram –∞–∫–∫–∞—É–Ω—Ç—É
    * —Å–º–µ–Ω–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    * —Å–ª—É—á–∞–π–Ω–∞—è –æ—à–∏–±–∫–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±—ã–ª –æ —Å—Ç–∞—Ä–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ)
  * **–º–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–∏–µ**:
    * –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –¥–≤–æ–π–Ω–æ–π referral bonus
    * –æ–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å—Ç–∞—Ä–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
    * farming –±–æ–Ω—É—Å–æ–≤/–∞–∫—Ü–∏–π
* –í–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–ª–∏—Ç–∏–∫–∏:
  * **–í–∞—Ä–∏–∞–Ω—Ç A (–∂—ë—Å—Ç–∫–∏–π –∑–∞–ø—Ä–µ—Ç)**:
    * –í–°–ï–ì–î–ê –æ—Ç–∫–∞–∑ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞ wallet
    * —Å–æ–æ–±—â–µ–Ω–∏–µ: "–≠—Ç–æ—Ç –∫–æ—à–µ–ª—ë–∫ —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –¥—Ä—É–≥–æ–º—É –∞–∫–∫–∞—É–Ω—Ç—É"
    * –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—É—Ç—å: –æ–±—Ä–∞—â–µ–Ω–∏–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å KYC
  * **–í–∞—Ä–∏–∞–Ω—Ç B (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–Ω–æ—Å)**:
    * –µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–π –∞–∫–∫–∞—É–Ω—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω >90 –¥–Ω–µ–π –∏ –±–∞–ª–∞–Ω—Å=0:
      * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–Ω–æ—Å –ø—Ä–∏–≤—è–∑–∫–∏ –Ω–∞ –Ω–æ–≤—ã–π telegram_id
      * —Å—Ç–∞—Ä—ã–π –∞–∫–∫–∞—É–Ω—Ç –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `replaced`
    * –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏–ª–∏ –±–∞–ª–∞–Ω—Å ‚Üí –∂—ë—Å—Ç–∫–∏–π –æ—Ç–∫–∞–∑
  * **–í–∞—Ä–∏–∞–Ω—Ç C (—Ä—É—á–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å —á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É)**:
    * –ª—é–±–æ–π –¥—É–±–ª–∏–∫–∞—Ç ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞–∑ + —Å–æ–∑–¥–∞–Ω–∏–µ support ticket
    * –∞–¥–º–∏–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
      * KYC –æ–±–æ–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å)
      * –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –±–∞–ª–∞–Ω—Å—ã
      * –ø—Ä–∏–∑–Ω–∞–∫–∏ fraud
    * –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –æ –ø–µ—Ä–µ–Ω–æ—Å–µ –∏–ª–∏ –æ—Ç–∫–∞–∑–µ
* –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
  * –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ `UserService.create_user()`:
    ```python
    existing_user = UserRepository.get_by_wallet(wallet_address)
    if existing_user:
        if existing_user.telegram_id == new_telegram_id:
            # Same user, just re-registering - allow
            return existing_user
        else:
            # Different telegram_id - potential fraud
            SecurityService.log_multiaccounting_attempt(
                new_telegram_id, 
                existing_user.telegram_id,
                wallet_address
            )
            raise WalletAlreadyInUseError(
                "This wallet is already registered to another account."
                "Please contact support if you believe this is an error."
            )
    ```
  * –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –í–°–ï–• –ø–æ–ø—ã—Ç–æ–∫ –≤ `multiaccounting_attempts` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
  * metrics: daily count multiaccounting attempts
  * periodic review: –µ—Å–ª–∏ >10 attempts –æ—Ç –æ–¥–Ω–æ–≥–æ telegram ‚Üí ban

#### R16-2: –û–¥–∏–Ω Telegram-–∞–∫–∫–∞—É–Ω—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–æ—à–µ–ª—å–∫–∞–º–∏

* –ü–æ–ø—ã—Ç–∫–∞ —Å–º–µ–Ω—ã –∫–æ—à–µ–ª—å–∫–∞:
  * User –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Å wallet A
  * —Ö–æ—á–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ wallet B (–Ω–æ–≤—ã–π, –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π, lost access, etc.)
* –¢–µ–∫—É—â–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞:
  * –æ–¥–∏–Ω user = –æ–¥–∏–Ω wallet (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞)
  * —Å–º–µ–Ω–∞ –∫–æ—à–µ–ª—å–∫–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
* –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —è–≤–Ω–æ:
  * **–î–æ–ø—É—Å–∫–∞–µ–º –ª–∏ —Å–º–µ–Ω—É –≤–æ–æ–±—â–µ?**
    * –µ—Å–ª–∏ YES ‚Üí —á–µ—Ä–µ–∑ –∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å?
    * –µ—Å–ª–∏ NO ‚Üí –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã?
  * **–ü—Ä–æ—Ü–µ—Å—Å —Å–º–µ–Ω—ã –∫–æ—à–µ–ª—å–∫–∞ (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)**:
    * —Å–æ–∑–¥–∞–Ω–∏–µ wallet change request —á–µ—Ä–µ–∑ support
    * requirements:
      * KYC verification –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
      * –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–ª–∞–¥–µ–Ω–∏—è –û–ë–û–ò–ú–ò –∫–æ—à–µ–ª—å–∫–∞–º–∏:
        * signature –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
        * signature –æ—Ç –Ω–æ–≤–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
      * —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
      * waiting period 7-14 –¥–Ω–µ–π (security cooldown)
    * admin approval –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
  * **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ**:
    * –≤—Å–µ –¥–µ–ø–æ–∑–∏—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ user_id (–Ω–µ –∫ wallet)
    * –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
    * —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ù–ï –º–µ–Ω—è–µ—Ç—Å—è
    * –Ω–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ –Ω–∞ –Ω–æ–≤—ã–π wallet
    * —Å—Ç–∞—Ä—ã–π wallet –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `historical_wallets` –¥–ª—è audit
  * **–†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**:
    * –º–∞–∫—Å–∏–º—É–º N —Å–º–µ–Ω –∑–∞ lifetime (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2)
    * –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –µ—Å–ª–∏ –µ—Å—Ç—å pending withdrawals
    * –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –µ—Å–ª–∏ wallet –≤ blacklist
    * –Ω–æ–≤—ã–π wallet –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –¥—Ä—É–≥–æ–º—É user
* –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–µ—Å–ª–∏ —Å–º–µ–Ω–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–∞):
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–≤–µ—Å—Ç–∏ –≤—Å–µ —Å—Ä–µ–¥—Å—Ç–≤–∞
  * –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç —Å –Ω–æ–≤—ã–º wallet
  * —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –ù–ï –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è
  * —ç—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ completely new user
* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
  * FAQ: "–ú–æ–≥—É –ª–∏ —è —Å–º–µ–Ω–∏—Ç—å –∫–æ—à–µ–ª—ë–∫?"
  * —á–µ—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (security, fraud prevention)
  * –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

#### R16-3: –ü–æ—Ç–µ—Ä—è Telegram-–∞–∫–∫–∞—É–Ω—Ç–∞ (–Ω–æ–º–µ—Ä —É–º–µ—Ä, —Ç–µ–ª–µ–≥–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)

* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞:
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Ç–µ—Ä—è–ª –¥–æ—Å—Ç—É–ø –∫ Telegram:
    * –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
    * Telegram –∞–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª–µ–Ω —Å–∞–º–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    * –≤–∑–ª–æ–º –∏ –ø–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –∞–∫–∫–∞—É–Ω—Ç–æ–º
    * —Ç–µ–ª–µ—Ñ–æ–Ω —É—Ç–µ—Ä—è–Ω –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è 2FA
  * –∏–º–µ–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã
  * —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π Telegram –∞–∫–∫–∞—É–Ω—Ç
  * –ø–∏—à–µ—Ç –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É: "–Ø –ø–æ—Ç–µ—Ä—è–ª –¥–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É, –Ω–æ —ç—Ç–æ –º–æ–∏ –¥–µ–Ω—å–≥–∏!"
* –ü—Ä–æ—Ü–µ—Å—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
  * **–®–∞–≥ 1: Proof of wallet ownership**
    * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–¥–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º –∫–æ—à–µ–ª—å–∫–∞:
      ```
      Message: "I am recovering my SigmaTradeBot account. New Telegram ID: 123456789. Timestamp: 2025-01-24T12:00:00Z"
      Signature: 0x...
      ```
    * –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å –∏–∑–≤–µ—Å—Ç–Ω–æ–π memo
  * **–®–∞–≥ 2: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è**
    * –µ—Å–ª–∏ –±—ã–ª KYC ‚Üí —Å–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    * –µ—Å–ª–∏ –±—ã–ª–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã (email/phone) ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–∏—Ö
    * security questions (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)
    * –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π:
      * –¥–∞—Ç—ã –¥–µ–ø–æ–∑–∏—Ç–æ–≤
      * —Å—É–º–º—ã –¥–µ–ø–æ–∑–∏—Ç–æ–≤
      * –∏–º–µ–Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
  * **–®–∞–≥ 3: Admin review**
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ suspicious activity –Ω–∞ —Å—Ç–∞—Ä–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ –ø–µ—Ä–µ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –Ω–µ –±—ã–ª–æ –Ω–µ–¥–∞–≤–Ω–∏—Ö –≤—ã–≤–æ–¥–æ–≤ (–≤–æ–∑–º–æ–∂–Ω—ã–π theft)
    * scoring —Ä–∏—Å–∫–∞: low/medium/high
  * **–®–∞–≥ 4: –ü–µ—Ä–µ–Ω–æ—Å –∞–∫–∫–∞—É–Ω—Ç–∞**
    * –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ telegram_id (set –≤ blacklist —Å —Ç–∏–ø–æ–º `ACCOUNT_MIGRATED`)
    * –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `users.telegram_id` –Ω–∞ –Ω–æ–≤—ã–π
    * –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `users.username` –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è
    * –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
    * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –æ —Å–º–µ–Ω–µ –¥–æ—Å—Ç—É–ø–∞
* –ß—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è:
  * –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  * –≤—Å–µ –¥–µ–ø–æ–∑–∏—Ç—ã –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å—ã
  * –±–∞–ª–∞–Ω—Å (available + pending)
  * —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–∏ –∫–∞–∫ referrer, –∏ –∫–∞–∫ referee)
  * verification status
  * settings –∏ preferences
* –ß—Ç–æ –ù–ï –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è:
  * —Å—Ç–∞—Ä—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π!)
  * –∞–∫—Ç–∏–≤–Ω—ã–µ FSM states
  * –∞–¥–º–∏–Ω—Å–∫–∏–µ –ø—Ä–∞–≤–∞ (–µ—Å–ª–∏ –±—ã–ª–∏ - —Ç—Ä–µ–±—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
* Security measures:
  * waiting period 48-72 —á–∞—Å–∞ –º–µ–∂–¥—É request –∏ migration
  * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ –í–°–ï –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã (email, —Å—Ç–∞—Ä—ã–π telegram –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
  * –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ waiting period
  * permanent log –≤ audit trail
* Edge case: —á—Ç–æ –µ—Å–ª–∏ –û–ë–û–ò–ú–ò –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ –≤–ª–∞–¥–µ—é—Ç —Ä–∞–∑–Ω—ã–µ –ª—é–¥–∏?
  * –∫—Ä–∞–π–Ω–µ —Å–ª–æ–∂–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è —Ç—Ä–µ–±—É—é—â–∞—è legal involvement
  * wallet signature –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤–ª–∞–¥–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏
  * –Ω–æ telegram –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∫—Ä–∞–¥–µ–Ω
  * solution: KYC —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –¥–ª—è recovery
  * –≤–æ–∑–º–æ–∂–Ω–∞ –∑–∞–º–æ—Ä–æ–∑–∫–∞ –¥–æ –≤—ã—è—Å–Ω–µ–Ω–∏—è

#### R16-4: –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –ø—Ä–æ–¥–∞–∂–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–æ–º

* "–°–µ—Ä—ã–π" —Å—Ü–µ–Ω–∞—Ä–∏–π:
  * User A –ø—Ä–æ–¥–∞–µ—Ç —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç User B:
    * –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ Telegram
    * –ø–µ—Ä–µ–¥–∞–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∫–æ—à–µ–ª—å–∫–∞
    * –ø–µ—Ä–µ–¥–∞–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
  * —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏: telegram_id –∏ wallet –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏
  * –Ω–æ —Ä–µ–∞–ª—å–Ω—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü —Å–º–µ–Ω–∏–ª—Å—è
* –ü–æ–∑–∏—Ü–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (—Ç—Ä–µ–±—É–µ—Ç legal approval):
  * **–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ**: –∞–∫–∫–∞—É–Ω—Ç—ã –ù–ï –ø–æ–¥–ª–µ–∂–∞—Ç –ø—Ä–æ–¥–∞–∂–µ (ToS violation)
  * **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏**: —Å–∏—Å—Ç–µ–º–∞ –ù–ï –º–æ–∂–µ—Ç –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å —Ç–∞–∫—É—é –ø–µ—Ä–µ–¥–∞—á—É
  * **–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏**: –Ω–µ –¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –≥–∞—Ä–∞–Ω—Ç–∏–π
* –ß—Ç–æ –º–æ–∂–µ—Ç –≤—ã—è–≤–∏—Ç—å —Å–º–µ–Ω—É –≤–ª–∞–¥–µ–ª—å—Ü–∞:
  * —Ä–µ–∑–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:
    * –∏–∑–º–µ–Ω–µ–Ω–∏–µ timezone –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    * –∏–∑–º–µ–Ω–µ–Ω–∏–µ language_code –≤ Telegram
    * –Ω–æ–≤—ã–π —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è –≤ support
  * –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
    * immediate withdrawal –≤—Å–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ "–ø—Ä–æ–¥–∞–∂–∏"
    * –∏–∑–º–µ–Ω–µ–Ω–∏–µ wallet address (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)
  * fraud detection —Ç—Ä–∏–≥–≥–µ—Ä—ã:
    * login —Å –Ω–æ–≤–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–µ—Å–ª–∏ —Ç—Ä–µ–∫–∞–µ–º)
    * –∏–∑–º–µ–Ω–µ–Ω–∏–µ email/phone –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–∫—Ü–∏—è –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–∏:
  * –ø–æ–≤—ã—à–µ–Ω–∏–µ risk score (R10-1)
  * —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  * –≤–æ–∑–º–æ–∂–Ω–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—ã–≤–æ–¥–æ–≤ –¥–ª—è review
* –ß—Ç–æ –¥–µ–ª–∞–µ–º –ø—Ä–∏ –≤—ã—è–≤–ª–µ–Ω–∏–∏:
  * –µ—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ —Ñ–∞–∫—Ç –ø—Ä–æ–¥–∞–∂–∏:
    * warning –æ–±–æ–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ ToS
    * –≤–æ–∑–º–æ–∂–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞
    * –ù–û: —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –≤–ª–∞–¥–µ–ª—å—Ü—É wallet (blockchain truth)
  * legal complexity: –∫–æ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ - –ø–æ–∫—É–ø–∞—Ç–µ–ª—é –∏–ª–∏ –ø—Ä–æ–¥–∞–≤—Ü—É?
* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ ToS:
  * —è–≤–Ω—ã–π –∑–∞–ø—Ä–µ—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∂—É/–ø–µ—Ä–µ–¥–∞—á—É –∞–∫–∫–∞—É–Ω—Ç–æ–≤
  * disclaimer: –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ –Ω–µ–ª–µ–≥–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–µ
  * –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö

#### R16-5: –°–∞–º —Å–µ–±–µ —Ä–µ—Ñ–µ—Ä–∞–ª (self-referral schemes)

* –ú–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–∏–µ —Å—Ö–µ–º—ã —Å–∞–º–æ–Ω–∞–∫—Ä—É—Ç–∫–∏:
  * **—Å—Ö–µ–º–∞ 1: –ü—Ä—è–º–æ–π self-referral**
    * User A —Å–æ–∑–¥–∞–µ—Ç –∞–∫–∫–∞—É–Ω—Ç 1
    * —Å–æ–∑–¥–∞–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
    * —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∞–∫–∫–∞—É–Ω—Ç 2 –ø–æ —Å–≤–æ–µ–π –∂–µ —Å—Å—ã–ª–∫–µ
    * –¥–µ–ª–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç —Å –∞–∫–∫–∞—É–Ω—Ç–∞ 2 ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –±–æ–Ω—É—Å –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç 1
  * **—Å—Ö–µ–º–∞ 2: –ö–æ–ª—å—Ü–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
    * User A ‚Üí –∞–∫–∫–∞—É–Ω—Ç 1 (wallet A)
    * User A ‚Üí –∞–∫–∫–∞—É–Ω—Ç 2 (wallet B) referrer = –∞–∫–∫–∞—É–Ω—Ç 1
    * User A ‚Üí –∞–∫–∫–∞—É–Ω—Ç 3 (wallet C) referrer = –∞–∫–∫–∞—É–Ω—Ç 2
    * –∞–∫–∫–∞—É–Ω—Ç 1 –¥–µ–ª–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç ‚Üí earnings –∏–¥—É—Ç –≤—Å–µ–º —Ç—Ä–µ–º –µ–≥–æ –∂–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º
  * **—Å—Ö–µ–º–∞ 3: –°–µ–º–µ–π–Ω–∞—è –Ω–∞–∫—Ä—É—Ç–∫–∞**
    * –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∞–∫–∫–∞—É–Ω—Ç—ã –Ω–∞ –≤—Å–µ—Ö —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏
    * —Å—Ç—Ä–æ–∏—Ç –¥–ª–∏–Ω–Ω—É—é —Ü–µ–ø–æ—á–∫—É
    * –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
    * —Ñ–∞—Ä–º–∏–Ω–≥ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤
* –ß–∞—Å—Ç–∏—á–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –º–µ—Ä–∞–º–∏:
  * R4-8: —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Ü–µ–ø–æ—á–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
  * R10-1: fraud detection –≤—ã—è–≤–ª—è–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è detection:
  * **–æ–¥–∏–Ω –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏–π —Å—É–±—ä–µ–∫—Ç**:
    * –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∏–ª–∏ –ø–æ—Ö–æ–∂–∏–µ email –∞–¥—Ä–µ—Å–∞ (–µ—Å–ª–∏ –≤–≤–æ–¥—è—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã)
    * –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ wallet addresses (0xAAA001, 0xAAA002, ...)
    * —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏ (–≤—Å–µ –∑–∞ 1 –¥–µ–Ω—å)
    * –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π timezone –∏ language_code
  * **–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**:
    * –¥–µ–ø–æ–∑–∏—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∫–∏
    * –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    * withdrawals —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ minimum ROI period
  * **–≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–ª–∞—Å—Ç–µ—Ä—ã**:
    * –µ—Å–ª–∏ –ø–æ–ª—É—á–∏—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å general location (—á–µ—Ä–µ–∑ Telegram API metadata)
    * –≤—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã –∏–∑ –æ–¥–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
* Automated detection –≤ `FraudDetectionService`:
  * –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ referral connection:
    * check: –µ—Å—Ç—å –ª–∏ —É–∂–µ N (–Ω–∞–ø—Ä–∏–º–µ—Ä 5+) —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —Å –ø–æ—Ö–æ–∂–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏
    * check: —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –≥–ª—É–±–∂–µ 3 —É—Ä–æ–≤–Ω–µ–π —Å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
    * check: –≤—Å–µ –¥–µ–ø–æ–∑–∏—Ç—ã –≤ —Ü–µ–ø–æ—á–∫–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ ($10)
  * risk scoring –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
  * –ø—Ä–∏ score > threshold:
    * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö earnings
    * –∞–ª–µ—Ä—Ç –∞–¥–º–∏–Ω–∞–º –¥–ª—è manual review
* –ß—Ç–æ –¥–µ–ª–∞–µ–º –ø—Ä–∏ –≤—ã—è–≤–ª–µ–Ω–∏–∏:
  * **confirmed self-referral scheme**:
    * –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö earnings –≤ —Ü–µ–ø–æ—á–∫–µ
    * –≤–æ–∑–≤—Ä–∞—Ç –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
    * ban –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
    * wallet addresses –≤ blacklist
  * **–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è, –Ω–æ –Ω–µ –¥–æ–∫–∞–∑–∞–Ω–Ω–∞—è**:
    * –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö earnings –¥–æ review
    * —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ KYC –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ü–µ–ø–æ—á–∫–∏
    * –µ—Å–ª–∏ KYC –ø—Ä–æ–π–¥–µ–Ω –∏ —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è ‚Üí —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
* –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã:
  * –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤:
    * –¥–µ–ø–æ–∑–∏—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–∫—Ç–∏–≤–µ–Ω >30 –¥–Ω–µ–π
    * –º–∏–Ω–∏–º—É–º N —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–Ω–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –¥–µ–ø–æ–∑–∏—Ç)
    * –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤ –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö earnings
  * caps –Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ earnings:
    * –º–∞–∫—Å–∏–º—É–º X USDT –≤ –º–µ—Å—è—Ü —Å –æ–¥–Ω–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞
    * –º–∞–∫—Å–∏–º—É–º Y –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –±–µ–∑ KYC
    * –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ ‚Üí –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

---

## 17. R17 ‚Äî Product / policy change —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–í–∞–∂–Ω–æ—Å—Ç—å**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª —Ç—Ä–µ–±—É—é—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ legacy –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏–π.

### 17.1. –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–µ–ø–æ–∑–∏—Ç–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π

#### R17-1: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –¥–µ–ø–æ–∑–∏—Ç–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

* –°—Ü–µ–Ω–∞—Ä–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è —ç–∫–æ–Ω–æ–º–∏–∫–∏:
  * —Ç–µ–∫—É—â–∏–µ —É—Å–ª–æ–≤–∏—è: Level 1 = $10, ROI 2% daily, cap 500%
  * –Ω–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è: Level 1 = $15, ROI 1.5% daily, cap 400%
  * –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç: —É–ª—É—á—à–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–Ω—Ü–∏–ø: **–≥—Ä–∞–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —É—Å–ª–æ–≤–∏–π**
  * —Å—Ç–∞—Ä—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –î–û–õ–ñ–ù–´ –∂–∏—Ç—å –ø–æ —Å—Ç–∞—Ä—ã–º –ø—Ä–∞–≤–∏–ª–∞–º (–∑–∞—â–∏—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
  * –Ω–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã ‚Äî –ø–æ –Ω–æ–≤—ã–º –ø—Ä–∞–≤–∏–ª–∞–º
  * –Ω–µ–ª—å–∑—è –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å `deposit_levels.amount` –≤ –ë–î!
* –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
  * **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ deposit conditions**:
    * –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è `deposit_levels.version` –∏–ª–∏ `effective_from` date
    * –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `deposit_level_versions`:
      ```sql
      CREATE TABLE deposit_level_versions (
        id SERIAL PRIMARY KEY,
        level_number INT NOT NULL,
        amount DECIMAL(10,2) NOT NULL,
        roi_percent DECIMAL(5,2) NOT NULL,
        roi_cap_percent INT NOT NULL,
        effective_from TIMESTAMP NOT NULL,
        effective_until TIMESTAMP,
        created_by_admin_id INT
      );
      ```
    * –∫–∞–∂–¥—ã–π –¥–µ–ø–æ–∑–∏—Ç —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é —É—Å–ª–æ–≤–∏–π
  * **–ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç**:
    * —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ deposit level conditions
    * –ù–ï —Ç—Ä–æ–≥–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ records
    * –≤—Å–µ –Ω–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç latest version
  * **ROI distribution –ª–æ–≥–∏–∫–∞**:
    * –ø—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ ROI: `deposit.roi_percent` from deposit's version
    * –Ω–µ –±–µ—Ä–µ–º –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ `deposit_levels` config
    * –∫–∞–∂–¥—ã–π deposit —Ö—Ä–∞–Ω–∏—Ç snapshot —É—Å–ª–æ–≤–∏–π –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è
* –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:
  * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –º–∏–Ω–∏–º—É–º –∑–∞ 7 –¥–Ω–µ–π
  * —á–µ—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ: "–Ω–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤"
  * FAQ: "–ò–∑–º–µ–Ω—è—Ç—Å—è –ª–∏ —É—Å–ª–æ–≤–∏—è –º–æ–∏—Ö —Ç–µ–∫—É—â–∏—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤?" ‚Üí –ù–ï–¢
* UI –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
  * –≤ –º–µ–Ω—é –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è
  * –≤ "–ú–æ–∏ –¥–µ–ø–æ–∑–∏—Ç—ã" –∫–∞–∂–¥—ã–π –¥–µ–ø–æ–∑–∏—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ–∏ —É—Å–ª–æ–≤–∏—è
  * –≤–æ–∑–º–æ–∂–Ω–æ badge "Legacy plan" vs "Current plan"
* Edge case: —á—Ç–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç "upgrade" —Å—Ç–∞—Ä—ã–π –¥–µ–ø–æ–∑–∏—Ç?
  * –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ: –Ω–µ–ª—å–∑—è, —É—Å–ª–æ–≤–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
  * –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –∑–∞–∫—Ä—ã—Ç—å —Å—Ç–∞—Ä—ã–π (–≤—ã–≤–µ—Å—Ç–∏), –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–π
  * –Ω–æ –ø–æ—Ç–µ—Ä—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å ROI

#### R17-2: –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è

* –ü—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–ª—é—á–µ–Ω–∏—è level:
  * **—Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç**: —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Å–ø—Ä–æ—Å, –Ω—É–∂–Ω–∞ –ø–∞—É–∑–∞
  * **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è**: –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∫—Ä—É–ø–Ω—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤
  * **—Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω–∞—è**: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ—Ç authorities
  * **–ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å**: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —É—Ä–æ–≤–Ω—è
* –ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:
  * **–Ω–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è**:
    * —Ñ–ª–∞–≥ `deposit_levels.is_active=False`
    * –∏–ª–∏ `deposit_levels.is_available=False` (–±–æ–ª–µ–µ —è–≤–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
    * –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å –¥–µ–ø–æ–∑–∏—Ç:
      * –ø—Ä–æ–≤–µ—Ä–∫–∞ `if not level.is_active`
      * –æ—à–∏–±–∫–∞: "–≠—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
  * **–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å**:
    * ROI –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∏–¥—É—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
    * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å
    * withdrawals —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
  * **UI –∏–∑–º–µ–Ω–µ–Ω–∏—è**:
    * –∫–Ω–æ–ø–∫–∞ level –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–º–æ—á–µ–∫ üîí
    * —Ç–µ–∫—Å—Ç: "Level 3 –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
    * –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: estimated time of reopening
    * —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
* –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
  * –∫–Ω–æ–ø–∫–∞ "Deactivate Level" –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
  * –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ "Reason" –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  * –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: planned reactivation date
  * –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å warning –æ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è—Ö
* –†–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è:
  * –∫–Ω–æ–ø–∫–∞ "Reactivate Level"
  * –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π:
    * –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏?
    * –Ω–µ—Ç –ª–∏ –¥—Ä—É–≥–∏—Ö –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö issues?
  * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º: "Level X —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–µ–Ω!"
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
  * –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ `is_active` –≤ `admin_actions`
  * timestamp, admin_id, reason
  * –¥–ª—è compliance –∏ –∞—É–¥–∏—Ç–∞

#### R17-3: –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å—Ç–æ–ø –Ω–∞ –≤—ã–≤–æ–¥—ã (emergency brake)

* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π emergency response:
  * **—Ç—Ä–∏–≥–≥–µ—Ä—ã**:
    * –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –≤–∑–ª–æ–º —Å–∏—Å—Ç–µ–º—ã
    * –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –±–∞–≥–∞ –≤ withdrawal logic
    * –ø—Ä–æ–±–ª–µ–º—ã —Å –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å—é (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –≤ hot wallet)
    * –∞—Ç–∞–∫–∞ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É (mass withdrawal attack)
    * —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ (court order, investigation)
  * —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –í–°–ï–• –≤—ã–≤–æ–¥–æ–≤
* –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
  * **–≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥** –≤ system config:
    * `system_settings.withdrawals_enabled=False`
    * –∏–ª–∏ feature flag: `WITHDRAWALS_EMERGENCY_STOP`
    * —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Redis –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ + DB –¥–ª—è persistence
  * **–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ withdrawal flow**:
    ```python
    if not SystemConfig.get('withdrawals_enabled'):
        raise WithdrawalsDisabledError(
            "Withdrawals are temporarily disabled due to maintenance.\n"
            "Your funds are safe. Please try again later or contact support."
        )
    ```
  * **–æ–±—Ä–∞–±–æ—Ç–∫–∞ existing PENDING withdrawals**:
    * –≤–∞—Ä–∏–∞–Ω—Ç A: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –≤ —Å—Ç–∞—Ç—É—Å `ON_HOLD`
    * –≤–∞—Ä–∏–∞–Ω—Ç B: –∑–∞–ø—Ä–µ—Ç approve/reject, –æ–Ω–∏ "–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞—é—Ç—Å—è"
    * –≤–∞—Ä–∏–∞–Ω—Ç C: –æ—Å—Ç–∞–≤–ª—è–µ–º PENDING, –Ω–æ –∞–¥–º–∏–Ω –≤–∏–¥–∏—Ç emergency banner
* UI –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
  * –∫–Ω–æ–ø–∫–∞ "–í—ã–≤–æ–¥" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç banner:
    * "‚ö†Ô∏è –í—ã–≤–æ–¥—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    * "–í–∞—à–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
    * "–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ —Ä–µ—à–µ–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã"
    * —Å—Å—ã–ª–∫–∞ –Ω–∞ status page –∏–ª–∏ announcement
  * –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –Ω–∞—á–∞—Ç—å withdrawal ‚Üí —á–µ—Å—Ç–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
  * –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–∏–∫—É: "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã" –≤–º–µ—Å—Ç–æ "EMERGENCY!"
* –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
  * –±–æ–ª—å—à–∞—è –∫—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "EMERGENCY STOP WITHDRAWALS"
  * —Ç—Ä–µ–±—É–µ—Ç:
    * admin confirmation (repeat master key)
    * –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ "Reason" (minimum 50 characters)
    * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ—Ö super_admins
  * –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
    * –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ affected pending withdrawals
    * total amount in pending withdrawals
    * estimated impact
* –ü—Ä–æ—Ü–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
  * –∫–Ω–æ–ø–∫–∞ "Resume Withdrawals"
  * —Ç—Ä–µ–±—É–µ—Ç:
    * verification —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞
    * review –≤—Å–µ—Ö ON_HOLD withdrawals
    * –≤–æ–∑–º–æ–∂–Ω–æ manual approval –ø–µ—Ä–≤—ã—Ö N withdrawals –ø–æ—Å–ª–µ resume
  * –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
    * –ø–µ—Ä–≤—ã–µ 10 withdrawals —Ç—Ä–µ–±—É—é—Ç manual approval
    * –ø–æ—Ç–æ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
    * –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
* –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è:
  * –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ official channel
  * regular updates –∫–∞–∂–¥—ã–µ 2-4 —á–∞—Å–∞
  * transparent –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã (–Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω–æ)
  * estimated time to resolution

#### R17-4: –í—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–æ–ø –Ω–∞ –¥–µ–ø–æ–∑–∏—Ç—ã

* –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤:
  * **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ**: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ smart contract, migration —Å–∏—Å—Ç–µ–º—ã
  * **—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ**: –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç TVL (Total Value Locked)
  * **–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ**: –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
  * **—Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã–µ**: compliance review, audit period
* –ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:
  * **—Ñ–ª–∞–≥** `system_settings.deposits_enabled=False`
  * **–Ω–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã**:
    * –∫–Ω–æ–ø–∫–∏ "–ü–æ–ø–æ–ª–Ω–∏—Ç—å Level N" disabled –∏–ª–∏ —Å–∫—Ä—ã—Ç—ã
    * –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ: "–î–µ–ø–æ–∑–∏—Ç—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    * —á–µ—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –∏ estimated duration
  * **—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–µ–ø–æ–∑–∏—Ç—ã –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã**:
    * ROI –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∏–¥—É—Ç –ø–æ –ø–ª–∞–Ω—É
    * withdrawals –¥–æ—Å—Ç—É–ø–Ω—ã
    * –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫—Ä–æ–º–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤
  * **pending –¥–µ–ø–æ–∑–∏—Ç—ã** (—É–∂–µ —Å–æ–∑–¥–∞–Ω—ã, –Ω–æ –µ—â–µ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã):
    * –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è
    * blockchain monitor –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É
    * —ç—Ç–∏ –¥–µ–ø–æ–∑–∏—Ç—ã –±—É–¥—É—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –¥–∞–∂–µ –ø—Ä–∏ –æ–±—â–µ–º —Å—Ç–æ–ø–µ
* UI –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
  * banner –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é: "–ù–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"
  * —Ä–∞–∑–¥–µ–ª "–î–µ–ø–æ–∑–∏—Ç—ã" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
  * countdown –¥–æ reopening (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–∞ –¥–∞—Ç–∞)
  * –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

#### R17-5: –ü–µ—Ä–µ–µ–∑–¥ –Ω–∞ –Ω–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –∫–æ—à–µ–ª—ë–∫ / smart contract

* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
  * –ø—Ä–∏—á–∏–Ω—ã —Å–º–µ–Ω—ã:
    * security: –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
    * upgrade: –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
    * scaling: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ multiple wallets
    * regulatory: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å custodial solution
* –°–ª–æ–∂–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:
  * **—Å—Ç–∞—Ä—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –≤ –ø—É—Ç–∏**:
    * —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç–∞—Ä—ã–π –∞–¥—Ä–µ—Å
    * –µ—â–µ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
    * –º–æ–∂–µ—Ç –±—ã—Ç—å pending –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤
  * **–¥–≤–æ–π–Ω–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
    * –Ω—É–∂–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –æ–±–∞ –∞–¥—Ä–µ—Å–∞
    * —Å—Ç–∞—Ä—ã–π: –¥–æ –ø–æ–ª–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö pending
    * –Ω–æ–≤—ã–π: –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤
  * **risk –ø–æ—Ç–µ—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**:
    * –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è critical
    * —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ –≤ "gap"
* –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏:
  * **–§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (T-7 –¥–Ω–µ–π)**
    * —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
    * deploy –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (–µ—Å–ª–∏ applicable)
    * —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ testnet
    * –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è –¥–≤—É—Ö –∞–¥—Ä–µ—Å–æ–≤
    * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–π —Å–º–µ–Ω–µ
  * **–§–∞–∑–∞ 2: Dual monitoring (T-1 –¥–µ–Ω—å –¥–æ T+7 –¥–Ω–µ–π)**
    * –≤ –¥–µ–Ω—å X –≤–∫–ª—é—á–∞–µ–º –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å –≤ UI
    * –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∞–¥—Ä–µ—Å
    * –≤—Å–µ –Ω–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –∏–¥—É—Ç –Ω–∞ –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å
    * —Å—Ç–∞—Ä—ã–µ pending –¥–µ–ø–æ–∑–∏—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å–æ —Å—Ç–∞—Ä–æ–≥–æ
    * duration: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–ª–≥–æ —á—Ç–æ–±—ã –ø–æ–π–º–∞—Ç—å –≤—Å–µ slow transactions
  * **–§–∞–∑–∞ 3: Graceful cutoff —Å—Ç–∞—Ä–æ–≥–æ –∞–¥—Ä–µ—Å–∞**
    * –ø–æ—Å–ª–µ T+7 –¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ–º:
      * –Ω–µ—Ç –ª–∏ pending –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –Ω–∞ —Å—Ç–∞—Ä—ã–π –∞–¥—Ä–µ—Å
      * –ø–æ—Å–ª–µ–¥–Ω—è—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –±—ã–ª–∞ >48 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥
    * –ø–µ—Ä–µ–≤–æ–¥–∏–º –æ—Å—Ç–∞—Ç–∫–∏ —Å–æ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞ –Ω–∞ –Ω–æ–≤—ã–π
    * –æ—Ç–∫–ª—é—á–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ä–æ–≥–æ –∞–¥—Ä–µ—Å–∞
  * **–§–∞–∑–∞ 4: Cleanup**
    * –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    * –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∞–¥—Ä–µ—Å–∞
    * post-mortem: –±—ã–ª–∏ –ª–∏ –ø—Ä–æ–±–ª–µ–º—ã?
* –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:
  * **Config —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
    * `DEPOSIT_WALLET_ADDRESS_PRIMARY=0x...NEW`
    * `DEPOSIT_WALLET_ADDRESS_LEGACY=0x...OLD` (temporary)
    * —Ñ–ª–∞–≥ `MONITOR_LEGACY_WALLET=True` (–ø–µ—Ä–∏–æ–¥ dual monitoring)
  * **Blockchain monitor –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**:
    * –ø–æ–¥–¥–µ—Ä–∂–∫–∞ multiple –∞–¥—Ä–µ—Å–æ–≤
    * –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è: –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å —á–∞—â–µ
    * –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ source address –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
  * **UI –∏–∑–º–µ–Ω–µ–Ω–∏—è**:
    * –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
    * warning: "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å, —Å—Ç–∞—Ä—ã–π —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω"
    * countdown –¥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Å—Ç–∞—Ä–æ–≥–æ
* Recovery plan:
  * –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ ‚Üí –º–æ–∂–µ–º rollback –Ω–∞ —Å—Ç–∞—Ä—ã–π –∞–¥—Ä–µ—Å
  * –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥–∏ –≤ config files/env, –Ω–µ hardcoded
  * ability to quickly switch back

---

## 18. R18 ‚Äî Threat model / –∞—Ç–∞–∫—É—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Ç–∞–∫–∏ —Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞—â–∏—Ç—ã, –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–π.

### 18.1. Blockchain –∏ DDoS –∞—Ç–∞–∫–∏

#### R18-1: –°–ø–∞–º-–¥–µ–ø–æ–∑–∏—Ç—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏ (dust attack)

* –ê—Ç–∞–∫—É—é—â–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
  * –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ —Å–æ–∑–¥–∞–µ—Ç —Ç—ã—Å—è—á–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –ø–æ $0.01 USDT
  * —Ü–µ–ª–∏ –∞—Ç–∞–∫–∏:
    * **–∑–∞–±–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** –æ–≥—Ä–æ–º–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–ø–∏—Å–µ–π
    * **–Ω–∞–≥—Ä—É–∑–∏—Ç—å blockchain monitor** –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –º–∏–∫—Ä–æ—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    * **–∏—Å—Ç–æ—â–∏—Ç—å RPC quota** –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤
    * **–∑–∞–º–µ–¥–ª–∏—Ç—å UI** –¥–ª—è —á–µ—Å—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    * **—Å–æ–∑–¥–∞—Ç—å —à—É–º** –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–π –∞—Ç–∞–∫–∏
* –ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ä—ã:
  * **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–µ–ø–æ–∑–∏—Ç–∞**:
    * —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å floor: –Ω–∞–ø—Ä–∏–º–µ—Ä $5 –∏–ª–∏ $10
    * –æ—Ç–∫–ª–æ–Ω—è—Ç—å –¥–µ–ø–æ–∑–∏—Ç—ã –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º—É–º–∞
    * –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `MIN_DEPOSIT_AMOUNT`
  * **dust filter –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**:
    * blockchain monitor –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ <$1
    * –ª–æ–≥–∏—Ä—É–µ—Ç –∏—Ö –∫–∞–∫ `dust_transaction` –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    * –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ –ë–î
    * –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–æ–±–∏—Ä–∞–µ—Ç dust –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
  * **rate limiting –ø–æ –∫–æ—à–µ–ª—å–∫—É –∏—Å—Ç–æ—á–Ω–∏–∫—É**:
    * –µ—Å–ª–∏ –æ–¥–∏–Ω wallet –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç >10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ —á–∞—Å ‚Üí blacklist
    * –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ `suspicious_wallets` —Ç–∞–±–ª–∏—Ü—É
    * –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤ —Å —ç—Ç–æ–≥–æ wallet
  * **aggregation –∏ batching**:
    * –≤–º–µ—Å—Ç–æ N –æ—Ç–¥–µ–ª—å–Ω—ã—Ö queries –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ N —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    * batch –æ–±—Ä–∞–±–æ—Ç–∫–∞: —Å–æ–±—Ä–∞—Ç—å –∑–∞ period, –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
    * —É–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ë–î –∏ RPC
* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã:
  * –º–µ—Ç—Ä–∏–∫–∞: `dust_transactions_per_hour`
  * –µ—Å–ª–∏ >100 –∑–∞ —á–∞—Å ‚Üí –∞–ª–µ—Ä—Ç –∞–¥–º–∏–Ω–∞–º
  * dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç top –∏—Å—Ç–æ—á–Ω–∏–∫–∏ dust
  * –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ blacklist wallet —á–µ—Ä–µ–∑ UI
* Cost analysis:
  * dust attack —Å—Ç–æ–∏—Ç –∞—Ç–∞–∫—É—é—â–µ–º—É: gas fees * –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  * –Ω–æ –º–æ–∂–µ—Ç —Å—Ç–æ–∏—Ç—å –Ω–∞–º: RPC costs, DB storage, processing time
  * —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–µ–ª–∞–µ—Ç –∞—Ç–∞–∫—É —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏ –Ω–µ—Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ–π

#### R18-2: –ú–∞—Å—Å–æ–≤—ã–π –±–æ—Ç-—Å–ø–∞–º –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

* –ê—Ç–∞–∫—É—é—â–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
  * –±–æ—Ç–Ω–µ—Ç —Å–æ–∑–¥–∞–µ—Ç —Ç—ã—Å—è—á–∏ Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–≤
  * –º–∞—Å—Å–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –±–æ—Ç–µ
  * —Ü–µ–ª–∏:
    * **–∑–∞–±–∏—Ç—å –±–∞–∑—É** —Ñ–µ–π–∫–æ–≤—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
    * **–Ω–∞–≥—Ä—É–∑–∏—Ç—å –±–æ—Ç–∞** –æ–±—Ä–∞–±–æ—Ç–∫–æ–π updates
    * **—Ñ–∞—Ä–º–∏—Ç—å –±–æ–Ω—É—Å—ã** –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ rewards
    * **—Å–ø–∞–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫** –¥–ª—è –Ω–∞–∫—Ä—É—Ç–∫–∏
* –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞—â–∏—Ç—ã (–æ–ø–∏—Å–∞—Ç—å –∫–∞–∫ —Å—Ü–µ–Ω–∞—Ä–∏–π):
  * `OperationRateLimiter.check_registration_limit()`:
    * –ª–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥
    * –Ω–∞–ø—Ä–∏–º–µ—Ä: 100 —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π/—á–∞—Å globally
    * per-bot instance –∏–ª–∏ global —á–µ—Ä–µ–∑ Redis
  * `BlacklistService` pre-registration checks:
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ telegram_id –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    * –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–∞–∑ –¥–ª—è blacklisted
* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã:
  * **CAPTCHA / proof-of-work challenges**:
    * –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–∏ –Ω–∞ –±–æ—Ç–∞: –ø—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∫–∞
    * "–†–µ—à–∏ –ø—Ä–∏–º–µ—Ä: 5 + 3 = ?"
    * –∏–ª–∏ "–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É —Å —Ü–∏—Ñ—Ä–æ–π 7"
    * lightweight, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–æ—Ç–∏–≤ –ø—Ä–æ—Å—Ç—ã—Ö –±–æ—Ç–æ–≤
  * **behavioral analysis**:
    * —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–±–æ—Ç = —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ)
    * –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤–≤–æ–¥–∞ (–±–æ—Ç = –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ç–∞–π–º–∏–Ω–≥–∏)
    * –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ "—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö" –æ—à–∏–±–æ–∫
  * **wallet verification**:
    * —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ valid wallet address —Å—Ä–∞–∑—É
    * –ø—Ä–æ–≤–µ—Ä–∫–∞ wallet –Ω–∞ blockchain (–µ—Å—Ç—å –ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏?)
    * –Ω–æ–≤—ã–π –ø—É—Å—Ç–æ–π wallet = –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ
  * **gradual onboarding**:
    * –Ω–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
      * –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –¥–µ–ø–æ–∑–∏—Ç –ø–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞
      * –Ω–µ–ª—å–∑—è –ø—Ä–∏–≥–ª–∞—à–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –ø–µ—Ä–≤—É—é –Ω–µ–¥–µ–ª—é
    * —Å–Ω–∏–∂–∞–µ—Ç value –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
  * spike detection: –µ—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π >X –≤ –º–∏–Ω—É—Ç—É
  * analysis: geographic/temporal clustering
  * dashboard: real-time —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å details
* Response:
  * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ stricter rate limits
  * —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ CAPTCHA –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
  * –≤—Ä–µ–º–µ–Ω–Ω—ã–π stop —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –≤ –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ

#### R18-3: –ê—Ç–∞–∫–∞ —á–µ—Ä–µ–∑ Telegram API (rate-limit / flood)

* –ê—Ç–∞–∫—É—é—â–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
  * –±–æ—Ç–Ω–µ—Ç –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–≤
  * –º–∞—Å—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ updates –∫ –±–æ—Ç—É
  * spam —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ–º–∞–Ω–¥, button clicks
  * —Ü–µ–ª—å: –∏—Å—á–µ—Ä–ø–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã, –ø–æ–ª–æ–∂–∏—Ç—å –±–æ—Ç–∞
* –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞—â–∏—Ç—ã (–æ—Ñ–æ—Ä–º–∏—Ç—å –∫–∞–∫ —Å—Ü–µ–Ω–∞—Ä–∏–π):
  * `RateLimitMiddleware`:
    * –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ actions per user per period
    * –Ω–∞–ø—Ä–∏–º–µ—Ä: 30 actions/minute per user
  * `OperationRateLimiter`:
    * —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    * withdrawal, deposits, registrations
* Telegram-level protection:
  * Telegram Bot API —Å–∞–º –∏–º–µ–µ—Ç rate limiting
  * –Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è sophisticated attack
* Application-level defense:
  * **per-user throttling** (—É–∂–µ –µ—Å—Ç—å):
    * Redis counter: `rate_limit:{user_id}:{action}`
    * exponential backoff –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏
  * **global throttling**:
    * –µ—Å–ª–∏ total load >threshold ‚Üí degraded mode
    * disable non-essential features
    * priority queue: critical operations first
  * **fallback to read-only mode**:
    * –ø—Ä–∏ extreme load –æ—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ write operations
    * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ:
      * –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å
      * –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é
      * —á–∏—Ç–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
    * –≤—Å–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ queued for later
* Detection:
  * –º–µ—Ç—Ä–∏–∫–∏ requests per second (RPS)
  * –∞–Ω–æ–º–∞–ª–∏—è detection: spike >3œÉ
  * breakdown –ø–æ —Ç–∏–ø–∞–º operations
* Recovery:
  * gradually restore write operations
  * monitor for repeated attack
  * permanent ban –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö attackers

#### R18-4: –ó–ª–æ–Ω–∞–º–µ—Ä–µ–Ω–Ω—ã–π –∞–¥–º–∏–Ω (insider threat)

* –°—Ü–µ–Ω–∞—Ä–∏–π –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ (R10-3):
  * —ç—Ç–æ –ù–ï –≤–∑–ª–æ–º - –∞–¥–º–∏–Ω –¥–µ–π—Å—Ç–≤—É–µ—Ç –ª–µ–≥–∏—Ç–∏–º–Ω–æ
  * –Ω–æ —Å –º–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–∏–º–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è–º–∏
  * "—Ä–µ—à–∏–ª —É–∫—Ä–∞—Å—Ç—å" –¥–µ–Ω—å–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
* –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
  * –º–∞—Å—Å–æ–≤—ã–µ approve –≤—ã–≤–æ–¥–æ–≤ –Ω–∞ —Å–≤–æ–∏ –∫–æ—à–µ–ª—å–∫–∏:
    * —Å–æ–∑–¥–∞–µ—Ç —Ñ–µ–π–∫–æ–≤—ã–µ withdrawal requests
    * –∏–ª–∏ –æ–¥–æ–±—Ä—è–µ—Ç —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ
  * –ø—Ä—è–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤:
    * –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä—è–º–æ–π DB access (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å!)
    * –∏–ª–∏ —á–µ—Ä–µ–∑ admin functions
  * —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–µ–π–∫–æ–≤—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤:
    * —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
  * –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è ROI calculations:
    * –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–≤–æ–∏—Ö earnings
* –ó–∞—â–∏—Ç—ã –ø—Ä–æ—Ç–∏–≤ insider threat:
  * **–ø—Ä–∏–Ω—Ü–∏–ø "—á–µ—Ç—ã—Ä–µ—Ö –≥–ª–∞–∑" (dual control)**:
    * –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç approval –¥–≤—É—Ö –∞–¥–º–∏–Ω–æ–≤
    * –æ—Å–æ–±–µ–Ω–Ω–æ: withdrawals >$1000, balance adjustments
    * —Å–∏—Å—Ç–µ–º–∞ escrow: –ø–µ—Ä–≤—ã–π –∞–¥–º–∏–Ω initiate, –≤—Ç–æ—Ä–æ–π approve
  * **—Å—Ç—Ä–æ–≥–∏–µ –ª–∏–º–∏—Ç—ã –Ω–∞ –∞–¥–º–∏–Ω—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
    * –º–∞–∫—Å–∏–º—É–º $X withdrawals per day per admin
    * –º–∞–∫—Å–∏–º—É–º N balance adjustments per week
    * –ª—é–±–æ–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ ‚Üí automatic block + alert
  * **immutable audit log**:
    * –≤—Å–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ append-only log
    * –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å
    * —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ (–Ω–µ –≤ main DB)
    * —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
  * **anomaly detection —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤**:
    * unusual timing (3am operations)
    * geographical anomalies
    * sudden spike –≤ activity
    * pattern deviation –æ—Ç normal behavior
  * **separation of duties**:
    * –∞–¥–º–∏–Ω—ã –ù–ï –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –ø—Ä—è–º–æ–π DB access
    * –≤—Å–µ —á–µ—Ä–µ–∑ application layer —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    * —Ä–∞–∑–Ω—ã–µ –∞–¥–º–∏–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:
      * withdrawal approver
      * user manager
      * config manager
  * **regular audits**:
    * –≤–Ω–µ—à–Ω–∏–π –∞—É–¥–∏—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç admin actions
    * random sampling withdrawals for verification
    * blockchain verification: claimed vs actual
* Detection –ø—Ä–∏–º–µ—Ä—ã:
  * –∞–¥–º–∏–Ω –æ–¥–æ–±—Ä–∏–ª 50 withdrawals –∑–∞ —á–∞—Å (normal: 5-10)
  * –≤—Å–µ withdrawals –∏–¥—É—Ç –Ω–∞ 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö wallet
  * balance adjustment –±–µ–∑ clear reason/ticket
  * approval withdrawn –±–µ–∑ user request
* Response:
  * immediate suspension –∞–¥–º–∏–Ω–∞
  * freeze –≤—Å–µ—Ö –µ–≥–æ recent actions (if possible)
  * investigation: –∫–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ legitimate, –∫–∞–∫–∏–µ fraud
  * legal action –µ—Å–ª–∏ confirmed theft

#### R18-5: Long-tail –∞—Ç–∞–∫–∏ –Ω–∞ RPC / node infrastructure

* –ê—Ç–∞–∫—É—é—â–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
  * —Ü–µ–ª—å: –∏—Å—Ç–æ—â–∏—Ç—å RPC quota —É QuickNode –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã—Ö
  * —Å–ø–æ—Å–æ–±: –∑–∞—Å—Ç–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–µ–ª–∞—Ç—å –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤
  * —Ä–µ–∑—É–ª—å—Ç–∞—Ç: —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ —Å–µ–±—è DDoS'–∏—Ç
* –í–µ–∫—Ç–æ—Ä—ã –∞—Ç–∞–∫–∏:
  * **—Å–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ pending –¥–µ–ø–æ–∑–∏—Ç–æ–≤**:
    * –∫–∞–∂–¥—ã–π –¥–µ–ø–æ–∑–∏—Ç ‚Üí periodic checks –≤ blockchain
    * 1000 pending –¥–µ–ø–æ–∑–∏—Ç–æ–≤ = 1000 RPC calls –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
  * **—Å–ø–∞–º wallet balance checks**:
    * –µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç balances —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ
  * **inefficient blockchain queries**:
    * –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
    * repeated calls –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ
* –ó–∞—â–∏—Ç—ã:
  * **–∂—ë—Å—Ç–∫–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ª–∏–º–∏—Ç—ã –Ω–∞ RPC**:
    * maximum N calls per minute per service
    * hard cap –¥–∞–∂–µ –µ—Å–ª–∏ quota –≤—ã—à–µ
    * rate limiter –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º RPC call
    * –Ω–∞–ø—Ä–∏–º–µ—Ä: `BlockchainRateLimiter.acquire()` before `web3.eth.*`
  * **aggressive caching**:
    * cache block data for 30 seconds
    * cache transaction receipts permanently
    * cache wallet balances for 60 seconds
  * **smart batching**:
    * –≤–º–µ—Å—Ç–æ N –æ—Ç–¥–µ–ª—å–Ω—ã—Ö calls: batch request
    * example: –ø—Ä–æ–≤–µ—Ä–∫–∞ multiple tx receipts –æ–¥–Ω–∏–º call
    * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `eth_getLogs` –≤–º–µ—Å—Ç–æ individual queries
  * **degraded mode –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –ª–∏–º–∏—Ç—É**:
    * –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ RPC usage: current vs quota
    * –µ—Å–ª–∏ >80% quota ‚Üí degrade:
      * –æ—Ç–∫–ª—é—á–∏—Ç—å non-critical blockchain operations
      * —É–≤–µ–ª–∏—á–∏—Ç—å cache TTL
      * —Å–Ω–∏–∑–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É polling
    * –µ—Å–ª–∏ >95% quota ‚Üí emergency mode:
      * —Ç–æ–ª—å–∫–æ critical operations (withdrawals processing)
      * –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤ queue "–¥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
  * **fallback nodes —Å shared quota**:
    * primary node exhausted ‚Üí switch to secondary
    * –Ω–æ –æ–±—â–∏–π cap –Ω–∞ –≤—Å–µ nodes together
* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
  * dashboard: RPC calls per minute
  * quota usage: current vs limit
  * cost tracking: $ spent on RPC
  * alert –µ—Å–ª–∏ approaching limit
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–∫—Ü–∏—è:
  * gradual degradation –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ
  * —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º
  * automatic switching to backup providers

---

## 8. –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏

### 7.1. –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –≤ –º–∞—Ç—Ä–∏—Ü—É ¬´–†–æ–ª—å √ó –ö–Ω–æ–ø–∫–∞ √ó –°—Ü–µ–Ω–∞—Ä–∏–π¬ª

–ü—Ä—è–º–æ –ø–æ ID —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ R1-1‚Ä¶R6-15 —Å–¥–µ–ª–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –∏ –ø–æ—Ç–æ–º –ø–æ –∫–æ–¥—É/—Ç–µ—Å—Ç–∞–º –æ—Ç–º–µ—á–∞—Ç—å:

* —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ / –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
* –µ—Å—Ç—å –ª–∏ —Ç–µ—Å—Ç—ã
* –µ—Å—Ç—å –ª–∏ UX-–æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

### 7.2. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–û—Ç–¥–µ–ª—å–Ω–æ –≤—ã–ø–∏—Å–∞—Ç—å:

* –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –∞–¥–º–∏–Ω–∞ –∏ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
* –º–∞—Å—Å–æ–≤—ã–π DDoS —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏
* —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ –∫–æ—à–µ–ª—å–∫—É –¥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
* –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—ã–ø–ª–∞—Ç –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ñ–∏–Ω–ø–∞—Ä–æ–ª—è

### 7.3. –§–æ—Ä–º–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

–ò–∑ —ç—Ç–æ–≥–æ –∫–∞—Ä–∫–∞—Å–∞ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å:

* **–ì–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω Markdown-—Ç–∞–±–ª–∏—Ü—ã** –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
* **–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞** –ø–æ —Ä–æ–ª—è–º (—á—Ç–æ –∫–ª–∏–∫–Ω—É—Ç—å, —á—Ç–æ –æ–∂–∏–¥–∞—Ç—å)
* **–ú–∞—Ç—Ä–∏—Ü—É –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-01-24  
**–°—Ç–∞—Ç—É—Å**: –ë–∞–∑–æ–≤—ã–π –∫–∞—Ä–∫–∞—Å –≥–æ—Ç–æ–≤ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏

